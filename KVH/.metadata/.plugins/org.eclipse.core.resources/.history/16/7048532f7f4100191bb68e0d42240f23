<apex:page id="pg"  controller="CatalogAddProductController" tabStyle="KVH_Portal_Admin__tab" showHeader="true" sidebar="false" title="Add to Catalog" >
 
  <link rel="stylesheet" href="{!URLFOR($Resource.documentupload, 'css/jquery-ui.css')}"/>
  <style>
      .ui-autocomplete-loading {
        background: white url("{!URLFOR($Resource.documentupload, 'images/ui-anim_basic_16x16.gif')}") right center no-repeat;
      }
      .overlay {
        width: 100%;
        height: 100%;
        background: #fff;
        opacity: 0.7;
        top: 0px;
        left: 0px;
        position: fixed;
        z-index: 500;
    }
    
    .status {
        cursor: pointer;
        -moz-box-shadow: 0 0 15px 5px #DDDDDD;
        -webkit-box-shadow: 0 0 15px 5px #DDDDDD;
        box-shadow: 0 0 15px 5px #DDDDDD;  
        opacity: 1;
        height: auto;
        position: fixed;
        left: 50%;
        margin-top: 5%;
        padding: 15px;
        z-index: 1000;
        display: block;
    }
   
  </style>
        <apex:define name="body">  
         <apex:sectionHeader title="Product Management" subtitle="Setup New Product"/>
          <div id="load-status" style="display:none;">
                <div class="overlay"></div>
                <div class="status">                               
                    <img src="{!URLFOR($Resource.documentupload, 'images/Cursor_Windows_Vista.gif')}"/>
                    <span id="load-statustext"></span>
                </div>
           </div>
           <apex:actionStatus id="actionstatus">
               <apex:facet name="start">
                   <div >
                        <div class="overlay"></div>
                        <div class="status">                               
                            <img src="{!URLFOR($Resource.documentupload, 'images/Cursor_Windows_Vista.gif')}"/>
                            <span id="load-statustext">Please wait...</span>
                        </div>
                   </div>
               </apex:facet>
           </apex:actionStatus>
   
<apex:form id="frm" >
  
    <apex:actionFunction name="saveRecords" status="actionstatus" action="{!createProduct}" oncomplete="adminTool();"/>
	<apex:actionFunction name="addtoTable" status="actionstatus" action="{!addProdToTable}" reRender="ptable" oncomplete="hidestatus();">
        <apex:param name="pid" value=""/>
    </apex:actionFunction>
 
  <apex:pageBlock id="pgb"  >
      <apex:outputPanel id="messagepannel">
          <apex:pageMessages ></apex:pageMessages>
      </apex:outputPanel>
      <div id="results"></div>
          <apex:pageBlockSection collapsible="false" title="Product Detail" columns="2">
              <apex:inputField required="true" value="{!prod.name}"/>
              <apex:inputField value="{!prod.IsActive}"/>
              <apex:inputField required="true" value="{!prod.Catalog_Display_Name__c}"/>                            
              <apex:inputField required="true" value="{!prod.Display_Product__c}"/>  
              <apex:inputField required="true" value="{!prod.Product_Line1__c}"/>
              <apex:inputField value="{!prod.Product_Group__c}"/>
              <apex:inputField required="true" value="{!prod.Product_Series__c}"/>
          </apex:pageBlockSection>          
      <apex:pageBlockSection id="Catalog_Long_Description"  columns="1">
          <apex:inputField value="{!prod.Catalog_Long_Description__c}"/>
      </apex:pageBlockSection>
      
      <apex:outputPanel layout="none" id="marketsectortable" >
          <apex:variable value="{!0}" var="count"/>
          <apex:pageBlockSection collapsible="false" title="Product Market Sector" columns="1">
              <apex:pageBlockTable value="{!marketSectorlst}" var="ms">             
                  <apex:column headerValue="Market">
                      <apex:inputField id="market" value="{!ms.Market__c}"/>
                  </apex:column>
                  <apex:column headerValue="Sector">
                      <apex:inputField id="sector" value="{!ms.Sector__c}"/>
                  </apex:column>
                  <apex:column headerValue="Portal View">
                      <apex:inputField value="{!ms.Portal_View__c}"/>
                      <apex:variable value="{!count+1}" var="count"/>
                  </apex:column> 
                  <apex:column headerValue="">
                      <apex:commandLink value="Remove" immediate="true" action="{!removeMarketsector}" status="actionstatus" reRender="marketsectortable">
                          <apex:param value="{!count}" assignTo="{!rownumber}" name="rownumber"/>
                      </apex:commandLink>
                  </apex:column> 
              </apex:pageBlockTable>    
              <apex:commandLink value="Add New" immediate="true" action="{!addnewMarketsector}" status="actionstatus" reRender="marketsectortable"/>
          </apex:pageBlockSection> 
      </apex:outputPanel>
      <apex:pageBlockSection collapsible="true" columns="2" title="Partner Association">
          <apex:pageBlockSectionItem >
              <apex:inputCheckbox value="{!apply}"/>
              <apex:outputLabel value="Apply to all Partners currently selling the following product: "/>
          </apex:pageBlockSectionItem>
          <apex:pageBlockSectionItem >
               <apex:outputLabel value="Product Name or Part Number" ></apex:outputLabel>
              <apex:outputPanel >
                  <input id="filename"/>
                  <span id="productname" style="display:none"></span>  
              </apex:outputPanel>    
          </apex:pageBlockSectionItem>
      </apex:pageBlockSection>
      <apex:pageBlockTable value="{!relprods}" var="rel" id="ptable">
              <apex:column value="{!rel.Catalog_Display_Name__c}"/>
          </apex:pageBlockTable>
      <apex:pageBlockButtons location="bottom">
          <input type="button" id="upload-button"  style="float: right;" value="Create Product" onclick="saveRecords();"/>             
          &nbsp;
          <input type="button" id="upload-button"  style="float: right;margin-right:10px" onclick="backbuttonclick('{!$CurrentPage.parameters.retURL}')" value="Back"/>             
      </apex:pageBlockButtons>
  </apex:pageBlock>
 
</apex:form> 
</apex:define> 
  
  <script src="{!URLFOR($Resource.documentupload, 'js/jquery-1.12.4.js')}"></script>
  <script src="{!URLFOR($Resource.documentupload, 'js/jquery-ui.js')}"></script>
  
  <script src="{!URLFOR($Resource.documentupload, 'js/aws-sdk-2.21.0.min.js')}"></script>

  <script>
    $( function() {   

    $( "#filename" ).autocomplete({
      source: function( request, response ) {
        $.ajax( {
          url: "/apex/createBundleSearch",         
          data: {
            term: request.term
          },
          success: function( data ) {
            response( data );
          }
        } );
      },
      minLength: 2,
        select: function( event, ui ) {
            var productlink = '<a href="/' + ui.item.data + '" target="_blank">' + ui.item.value + '</a>'; 
            $('[id*="productname"]').html(productlink);          
            $('[id*="productname"]').show();
            $('[id*="filename"]').hide();   
            $('[id*="closeicon"]').show(); 
            $('[id*="filename"]').addClass("error");    
            $('[id*="filenameerrormsg"]').remove(); 
            showstatusmessage('Fetching product details.');
            console.log(ui.item.data);
            addtoTable(ui.item.data);
            $('[id*="filename"]').val('');
            $('[id*="productname"]').hide();
            $('[id*="filename"]').show(); 
            $('[id*="closeicon"]').hide();
            
        }
    });
        
    } );


function showstatusmessage(msg){
    $("#load-statustext").text(msg);
    $("#load-status").show();
}

	function showsearchinput(){
        $('[id*="filename"]').val('');
        $('[id*="productname"]').hide();
        $('[id*="filename"]').show(); 
        $('[id*="closeicon"]').hide();
        $("#load-statustext").text("Refreshing...");
        $("#load-status").show();
        location.href = '/apex/CreateNewBundle';        
    }
 
  function adminTool(){
      location.href = '/apex/adminlandingpage';
  }
  
  function hidestatus(){
      $("#load-status").hide();
      $("#load-statustext").text("");
  }

    function backbuttonclick(returl){
        location.href = returl;
    }
    
    
  </script>
</apex:page>