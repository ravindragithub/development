<apex:page id="page" standardController="Opportunity" extensions="AgilePlans_attachSiteSurveyCtrl" >
  <apex:sectionHeader title="Opportunity" subtitle="Attach AgilePlans Site Survey(s)"/>
  <apex:form id="frm">
  <apex:actionFunction name="submitaction" action="{!submit}"/>
     
  <apex:pageBlock rendered="{!!showform}">
      <apex:pageMessage severity="WARNING" strength="2" summary="There are no related vessels pending a Site Survey attachment." ></apex:pageMessage>
      <apex:commandButton immediate="true" value="Back" action="{!back}"/>
  </apex:pageBlock>
  <apex:pageBlock rendered="{!showform}">
      <apex:pageMessages ></apex:pageMessages>
      <apex:pageBlockButtons location="bottom">
          <apex:commandButton value="Back" immediate="true" action="{!back}"/>
          <apex:commandButton value="Submit" onclick="submitForm(); return false;"/>
      </apex:pageBlockButtons>
      <apex:outputLabel value="To associate the AgilePlans Site Survey with the correct installation, please select from the following :"></apex:outputLabel>
      <apex:pageBlockSection columns="1">
          <apex:pageBlockTable value="{!caselist}" var="c">
              <apex:column >
                  <input type="radio" name="case" value="{!c.Id}"/>
              </apex:column>
              <apex:column headerValue="Vessel Name">
                  <apex:outputLink target="blank" value="/{!c.id}" >{!c.New_Vessel_or_Platform__c}</apex:outputLink>
              </apex:column>
              <apex:column headerValue="Status">
                  <apex:outputText value="{!c.status}"></apex:outputText>
              </apex:column>            
          </apex:pageBlockTable>          
      </apex:pageBlockSection>
      <apex:pageBlockSection collapsible="false" title="Attach AgilePlans Site Survey">
          <apex:pageBlockSectionItem >
              <apex:outputLabel value="Site Survey"></apex:outputLabel>
              <apex:inputFile value="{!sitesurvey.body}" fileName="{!sitesurvey.name}"></apex:inputFile>
          </apex:pageBlockSectionItem>          
      </apex:pageBlockSection>
  </apex:pageBlock>
  <apex:inputHidden id="caseid" value="{!caseObj.Id}"/>
  </apex:form>
  <script>
      function getRadioVal(form, name) {
        var val;
        // get list of radio buttons with specified name
        var radios = form.elements[name];
        console.log(radios);
        if(radios.length == undefined && radios.checked){
            return radios.value;
        }else{            
            // loop through list of radio buttons
            for (var i=0, len=radios.length; i<=len; i++) {
                if ( radios[i].checked ) { // radio checked?
                    val = radios[i].value; // if so, hold its value in val
                    break; // and break out of for loop
                }
            }
        }
        return val; // return value of checked radio or undefined if none checked
    }
    
    function submitForm(){
        var val = getRadioVal( document.getElementById('page:frm'), 'case' );
        document.getElementById('page:frm:caseid').value = val;
        //alert(val);
        submitaction(val);
    }
  </script>
</apex:page>