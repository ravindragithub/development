<apex:page id="pg" standardcontroller="Case" showheader="false" extensions="myKVH_ReportProblem" standardstylesheets="false" cache="false">
    <apex:form id="form">
        <apex:stylesheet value="{!URLFOR($Resource.partner_portal_0817)}" />
        <style>   
        .picklist {
            padding: 5px;
            width:380px; 
        }
    </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script>         
        var valueSelect; 
        function setSelectionLocal(x) 
        {
            valueSelect = x;        
        }
        
        function setIt()
        {
            setSelection(valueSelect);
        }
        
        function goB()
        {
            goBack();
        }
        
        </script>
        <apex:pagemessages />
        
        <apex:actionFunction name="setSelection" action="{!setSelection}" rerender="form">
            <apex:param name="valueSelect" value="valueSelect" assignTo="{!valueSelected}" />
        </apex:actionFunction>
        <apex:actionFunction name="goBack" action="{!backButton}" />
        
        <apex:pageblock id="pgb">
            
            <style>
            body {
            background-color:#f3f3f3;
            }
            </style>
            
            <div class="partner_portal">
                
                <div class="width-20 left">
                    <ul class="support-sidenav">
                       
                        <li><a href="{!$Site.BaseUrl}/s/mykvh-support-landing" target="_parent">Support Main</a></li>
                        <li ><a href="{!$Site.BaseUrl}/s/mykvh-airtime-support" target="_parent">Airtime Services Support</a></li>
                        <li class="active"><a href="{!$Site.BaseUrl}/s/mykvh-technical-support" target="_parent">Technical Support</a></li>
                    </ul>
                </div>
                <div class="width-75 right">
                    <a href="{!$Site.BaseUrl}/s/mykvh-support-landing" class="button right">BACK</a>
                    <h1>Technical Support</h1>
                    <p>We're sorry you are having a problem with your KVH product or service. With the information you provide to create a case below, our Technical Support department will work quickly to troubleshoot and fix your problem.</p>
                   <!-- <h3>Case Type:</h3>-->
                    <apex:actionRegion >
                        <apex:outputPanel id="thePanel">             
                           <!-- <apex:selectRadio value="{!valueSelected}" layout="pageDirection" >
                                <apex:selectOptions value="{!radio6}"/>
                                <apex:actionSupport action="{!recordTypeSet}" event="onclick" reRender="thePanel"/>
                            </apex:selectRadio>-->
                            
                            <h3 class="pad-top">Case Details:</h3>
                            <p class="width-70"><strong>Product or Service Type:</strong>
                            <!--<apex:selectlist value="{!serviceSelected}" size="1" styleClass="picklist" html-placeholder="--Select One--">
                                <apex:selectOptions value="{!radio8}"/>
                            </apex:selectlist>-->
                            <apex:inputField styleClass="picklist" value="{!srvCase.Web_Product_or_Service_Type__c}"/>
                            </p>
                        </apex:outputPanel>       
                    </apex:actionRegion>
                    
                    <p class="width-70"><strong>Vessel or Installation Platform:</strong>
                    <apex:inputfield value="{!srvCase.New_Vessel_or_Platform__c }" />
                    </p>
                    
                    <p class="width-70"><strong>Case Subject:</strong>
                    <apex:inputfield value="{!srvCase.Subject}" />
                    </p>
                    
                    <p class="width-70"><strong>Problem/Case Description:</strong>
                    <apex:inputfield value="{!srvCase.Description}"/>
                    </p>
                    
                    <apex:outputpanel id="filepannel">
                        Attach File  <span style="font-style: italic; font-size: smaller;"> (attachments must be less than 25 MB)</span>:
                        <br/>
                        <br/>
                        <apex:inputFile id="file" value="{!attach.body}" filename="{!attach.name}"/>
                        <br/>
                        
                        <span id="filesizeerror" style="display:none;color:red;font-size:12px;font-weight:bold;"></span>
                        <br/>
                        
                        <apex:actionRegion id="region">
                            <div class="button-bar">
                                <apex:commandButton value="Submit"  styleClass="button button-blue right" onclick="validateForm(); return false;"/>
                                <apex:actionFunction name="CreateCasePartner" action="{!CreateCasePartner}"/>
                            </div>
                        </apex:actionRegion>
                        
                        <apex:actionStatus for="region">
                                <apex:facet name="start">
                                    <apex:outputPanel >
                                        <img src="/img/loading32.gif" width="25" height="25" />
                                        <apex:outputLabel value="Loading..."/>
                                    </apex:outputPanel> 
                                </apex:facet>
                            </apex:actionStatus>
                    </apex:outputpanel>
                </div>
            </div>
        </apex:pageblock>
       
    </apex:form>
    <c:spinner ></c:spinner>
    <script>
       
        var childNodeElms = window.parent.document.getElementById('containerdiv').childNodes;
       
        childNodeElms[0].childNodes[0].childNodes[2].childNodes[2].style.height = childNodeElms[0].childNodes[0].childNodes[2].childNodes[2].contentWindow.document.body.offsetHeight + 'px';
        //alert(containerdiv);
        
        function GetFileSize() {
           var isError = false;
           $("#filesizeerror").hide();
            var fi = document.getElementById('pg:form:pgb:file'); // GET THE FILE INPUT.
    
            // VALIDATE OR CHECK IF ANY FILE IS SELECTED.
            if (fi.files.length > 0) {
                // RUN A LOOP TO CHECK EACH SELECTED FILE.
                for (var i = 0; i <= fi.files.length - 1; i++) {
    
                    var fsize = fi.files.item(i).size;      // THE SIZE OF THE FILE.
                   
                    var filesize = fsize*0.00000095367432;
                    filesize = filesize.toFixed(2);
                    if(filesize > 25){
                        
                        $("#filesizeerror").show();
                        $("#filesizeerror").text("File is "+filesize + "MB, attachments must be less than 25 MB");
                        $("#filesizeerror").val();
                        isError = true;
                    }
                }
            }
            return isError;
        }
        
        function validateForm(){
            var isError = GetFileSize();
            if(!isError){
                submitclick('CreateCasePartner()');                
            }
        }
        
    </script>
</apex:page>