function dtmlXMLLoaderObject(e,t,i,n){return this.xmlDoc="","undefined"!=typeof i?this.async=i:this.async=!0,this.onloadAction=e||null,this.mainObject=t||null,this.waitCall=null,this.rSeed=n||!1,this}function callerFunction(e,t){return this.handler=function(i){return i||(i=window.event),e(i,t),!0},this.handler}function getAbsoluteLeft(e){return getOffset(e).left}function getAbsoluteTop(e){return getOffset(e).top}function getOffsetSum(e){for(var t=0,i=0;e;)t+=parseInt(e.offsetTop),i+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:i}}function getOffsetRect(e){var t=e.getBoundingClientRect(),i=0,n=0;if(/Mobi/.test(navigator.userAgent)){var a=document.createElement("div");a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.width="1px",a.style.height="1px",document.body.appendChild(a);var r=a.getBoundingClientRect();i=t.top-r.top,n=t.left-r.left,a.parentNode.removeChild(a)}else{var s=document.body,l=document.documentElement,o=window.pageYOffset||l.scrollTop||s.scrollTop,d=window.pageXOffset||l.scrollLeft||s.scrollLeft,h=l.clientTop||s.clientTop||0,_=l.clientLeft||s.clientLeft||0;i=t.top+o-h,n=t.left+d-_}return{top:Math.round(i),left:Math.round(n)}}function getOffset(e){return e.getBoundingClientRect?getOffsetRect(e):getOffsetSum(e)}function convertStringToBoolean(e){switch("string"==typeof e&&(e=e.toLowerCase()),e){case"1":case"true":case"yes":case"y":case 1:case!0:return!0;default:return!1}}function getUrlSymbol(e){return-1!=e.indexOf("?")?"&":"?"}function dhtmlDragAndDropObject(){return window.dhtmlDragAndDrop?window.dhtmlDragAndDrop:(this.lastLanding=0,this.dragNode=0,this.dragStartNode=0,this.dragStartObject=0,this.tempDOMU=null,this.tempDOMM=null,this.waitDrag=0,window.dhtmlDragAndDrop=this,this)}function _dhtmlxError(e,t,i){return this.catches||(this.catches=[]),this}function dhtmlXHeir(e,t){for(var i in t)"function"==typeof t[i]&&(e[i]=t[i]);return e}function dataProcessor(e){return this.serverProcessor=e,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhtmlxEventable(this),this}function dtmlXMLLoaderObject(e,t,i,n){return this.xmlDoc="","undefined"!=typeof i?this.async=i:this.async=!0,this.onloadAction=e||null,this.mainObject=t||null,this.waitCall=null,this.rSeed=n||!1,this}function callerFunction(e,t){return this.handler=function(i){return i||(i=window.event),e(i,t),!0},this.handler}function getAbsoluteLeft(e){return getOffset(e).left}function getAbsoluteTop(e){return getOffset(e).top}function getOffsetSum(e){for(var t=0,i=0;e;)t+=parseInt(e.offsetTop),i+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:i}}function getOffsetRect(e){var t=e.getBoundingClientRect(),i=document.body,n=document.documentElement,a=window.pageYOffset||n.scrollTop||i.scrollTop,r=window.pageXOffset||n.scrollLeft||i.scrollLeft,s=n.clientTop||i.clientTop||0,l=n.clientLeft||i.clientLeft||0,o=t.top+a-s,d=t.left+r-l;return{top:Math.round(o),left:Math.round(d)}}function getOffset(e){return e.getBoundingClientRect?getOffsetRect(e):getOffsetSum(e)}function convertStringToBoolean(e){switch("string"==typeof e&&(e=e.toLowerCase()),e){case"1":case"true":case"yes":case"y":case 1:case!0:return!0;default:return!1}}function getUrlSymbol(e){return-1!=e.indexOf("?")?"&":"?"}function dhtmlDragAndDropObject(){return window.dhtmlDragAndDrop?window.dhtmlDragAndDrop:(this.lastLanding=0,this.dragNode=0,this.dragStartNode=0,this.dragStartObject=0,this.tempDOMU=null,this.tempDOMM=null,this.waitDrag=0,window.dhtmlDragAndDrop=this,this)}function _dhtmlxError(e,t,i){return this.catches||(this.catches=new Array),this}function dhtmlXHeir(e,t){for(var i in t)"function"==typeof t[i]&&(e[i]=t[i]);return e}function dhtmlxEvent(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)}function dhtmlXMenuObject(e,t){var i=this;if(this.conf={skin:t||window.dhx4.skin||("undefined"!=typeof dhtmlx?dhtmlx.skin:null)||window.dhx4.skinDetect("dhxmenu")||"dhx_skyblue",mode:"web",align:"left",is_touched:!1,selected:-1,last_click:-1,fixed_pos:!1,rtl:!1,icons_path:"",arrow_ff_fix:navigator.userAgent.indexOf("MSIE")>=0&&"BackCompat"==document.compatMode,live_id:window.dhx4.newId(),tags:{root:"menu",item:"item",text_ext:"itemtext",userdata:"userdata",tooltip:"tooltip",hotkey:"hotkey",href:"href"},autoload:{},hide_tm:{},top_mode:!0,top_tmtime:200,v_enabled:!1,v:{x1:null,x2:null,y1:null,y2:null},dir_toplv:"bottom",dir_sublv:"right",auto_overflow:!1,overflow_limit:0,of_utm:null,of_utime:20,of_ustep:3,of_dtm:null,of_dtime:20,of_dstep:3,tm_sec:400,tm_handler:null,dload:!1,dload_url:"",dload_icon:!1,dload_params:{action:"loadMenu"},dload_pid:"parentId",tl_botmarg:1,tl_rmarg:0,tl_ofsleft:1,context:!1,ctx_zoneid:!1,ctx_autoshow:!0,ctx_autohide:!0,ctx_hideall:!0,ctx_zones:{},ctx_baseid:null,selected_sub:[],opened_poly:[]},"object"==typeof e&&null!=e&&"undefined"==typeof e.tagName){(null!=e.icons_path||null!=e.icon_path)&&(this.conf.icons_path=e.icons_path||e.icon_path),null!=e.skin&&(this.conf.skin=e.skin),e.visible_area&&(this.conf.v_enabled=!0,this.conf.v={x1:e.visible_area.x1,x2:e.visible_area.x2,y1:e.visible_area.y1,y2:e.visible_area.y2});for(var n in{json:1,xml:1,items:1,top_text:1,align:1,open_mode:1,overflow:1,dynamic:1,dynamic_icon:1,context:1,onload:1,onclick:1,oncheckboxclick:1,onradioclick:1})null!=e[n]&&(this.conf.autoload[n]=e[n]);e=e.parent}if(null==e)this.base=document.body;else{var a="string"==typeof e?document.getElementById(e):e;null!=a?(this.base=a,this.base.id||(this.base.id=(new Date).valueOf()),this.base.className+=" dhtmlxMenu_"+this.conf.skin+"_Middle dir_left",this.base._autoSkinUpdate=!0,this.base.oncontextmenu&&(this.base._oldContextMenuHandler=this.base.oncontextmenu),this.conf.ctx_baseid=this.base.id,this.base.onselectstart=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1},this.base.oncontextmenu=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1}):this.base=document.body}this.idPrefix="",this.topId="dhxWebMenuTopId",this.idPull={},this.itemPull={},this.userData={},this.radio={},this.setSkin=function(e){var t=this.conf.skin;switch(this.conf.skin=e,this.conf.skin){case"dhx_skyblue":case"dhx_web":this.conf.tl_botmarg=2,this.conf.tl_rmarg=1,this.conf.tl_ofsleft=1;break;case"dhx_terrace":this.conf.tl_botmarg=0,this.conf.tl_rmarg=0,this.conf.tl_ofsleft=0}this.base._autoSkinUpdate&&(this.base.className=this.base.className.replace("dhtmlxMenu_"+t+"_Middle","")+" dhtmlxMenu_"+this.conf.skin+"_Middle");for(var i in this.idPull)this.idPull[i].className=String(this.idPull[i].className).replace(t,this.conf.skin)},this.setSkin(this.conf.skin),this._addSubItemToSelected=function(e,t){for(var i=!0,n=0;n<this.conf.selected_sub.length;n++)this.conf.selected_sub[n][0]==e&&this.conf.selected_sub[n][1]==t&&(i=!1);return 1==i&&this.conf.selected_sub.push(new Array(e,t)),i},this._removeSubItemFromSelected=function(e,t){for(var i=new Array,n=!1,a=0;a<this.conf.selected_sub.length;a++)this.conf.selected_sub[a][0]==e&&this.conf.selected_sub[a][1]==t?n=!0:i[i.length]=this.conf.selected_sub[a];return 1==n&&(this.conf.selected_sub=i),n},this._getSubItemToDeselectByPolygon=function(e){for(var t=new Array,i=0;i<this.conf.selected_sub.length;i++)if(this.conf.selected_sub[i][1]==e){t[t.length]=this.conf.selected_sub[i][0],t=t.concat(this._getSubItemToDeselectByPolygon(this.conf.selected_sub[i][0]));for(var n=!0,a=0;a<this.conf.opened_poly.length;a++)this.conf.opened_poly[a]==this.conf.selected_sub[i][0]&&(n=!1);1==n&&(this.conf.opened_poly[this.conf.opened_poly.length]=this.conf.selected_sub[i][0]),this.conf.selected_sub[i][0]=-1,this.conf.selected_sub[i][1]=-1}return t},this._hidePolygon=function(e){if(null!=this.idPull["polygon_"+e]){if(null!=this.idPull["polygon_"+e]._zId&&window.dhx4.zim.clear(this.idPull["polygon_"+e]._zId),"undefined"!=typeof this._menuEffect&&this._menuEffect!==!1)this._hidePolygonEffect("polygon_"+e);else{if("none"==this.idPull["polygon_"+e].style.display)return;this.idPull["polygon_"+e].style.display="none",null!=this.idPull["arrowup_"+e]&&(this.idPull["arrowup_"+e].style.display="none"),null!=this.idPull["arrowdown_"+e]&&(this.idPull["arrowdown_"+e].style.display="none"),this._updateItemComplexState(e,!0,!1),window.dhx4.isIE6&&null!=this.idPull["polygon_"+e+"_ie6cover"]&&(this.idPull["polygon_"+e+"_ie6cover"].style.display="none")}e=String(e).replace(this.idPrefix,""),e==this.topId&&(e=null),this.callEvent("onHide",[e]),null!=e&&"dhx_terrace"==this.conf.skin&&this.itemPull[this.idPrefix+e].parent==this.idPrefix+this.topId&&this._improveTerraceButton(this.idPrefix+e,!0)}},this._showPolygon=function(e,t){var i=this._countVisiblePolygonItems(e);if(0!=i){var n="polygon_"+e;if(null!=this.idPull[n]&&null!=this.idPull[e]){if(this.conf.top_mode&&"web"==this.conf.mode&&!this.conf.context&&!this.idPull[e]._mouseOver&&t==this.conf.dir_toplv)return;this.conf.fixed_pos||this._autoDetectVisibleArea();var a=0,r=0,s=null,l=null;if(null==this.idPull[n]._zId&&(this.idPull[n]._zId=window.dhx4.newId()),this.idPull[n]._zInd=window.dhx4.zim.reserve(this.idPull[n]._zId),this.idPull[n].style.visibility="hidden",this.idPull[n].style.left="0px",this.idPull[n].style.top="0px",this.idPull[n].style.display="",this.idPull[n].style.zIndex=this.idPull[n]._zInd,this.conf.auto_overflow)if(this.idPull[n].firstChild.offsetHeight>this.conf.v.y1+this.conf.v.y2){var o=Math.floor((this.conf.v.y2-this.conf.v.y1-35)/24);this.conf.overflow_limit=o}else this.conf.overflow_limit=0,null!=this.idPull["arrowup_"+e]&&this._removeUpArrow(String(e).replace(this.idPrefix,"")),null!=this.idPull["arrowdown_"+e]&&this._removeDownArrow(String(e).replace(this.idPrefix,""));if(this.conf.overflow_limit>0&&this.conf.overflow_limit<i&&(null==this.idPull["arrowup_"+e]&&this._addUpArrow(String(e).replace(this.idPrefix,"")),null==this.idPull["arrowdown_"+e]&&this._addDownArrow(String(e).replace(this.idPrefix,"")),s=this.idPull["arrowup_"+e],s.style.display="none",l=this.idPull["arrowdown_"+e],l.style.display="none"),this.conf.overflow_limit>0&&(this.conf.overflow_limit<i?(this.idPull[n].childNodes[1].style.height=24*this.conf.overflow_limit+"px",s.style.width=l.style.width=this.idPull[n].childNodes[1].style.width=this.idPull[n].childNodes[1].childNodes[0].offsetWidth+"px",this.idPull[n].childNodes[1].scrollTop=0,s.style.display="",a=s.offsetHeight,l.style.display="",r=l.offsetHeight):(this.idPull[n].childNodes[1].style.height="",this.idPull[n].childNodes[1].style.width="")),null!=this.itemPull[e]){"polygon_"+this.itemPull[e].parent}else if(this.conf.context){this.idPull[this.idPrefix+this.topId]}var d=null!=this.idPull[e].tagName?window.dhx4.absLeft(this.idPull[e]):this.idPull[e][0],h=null!=this.idPull[e].tagName?window.dhx4.absTop(this.idPull[e]):this.idPull[e][1],_=null!=this.idPull[e].tagName?this.idPull[e].offsetWidth:0,c=null!=this.idPull[e].tagName?this.idPull[e].offsetHeight:0,u=0,f=0,m=this.idPull[n].offsetWidth,p=this.idPull[n].childNodes[1].offsetHeight+a+r;if("bottom"==t&&(u=this.conf.rtl?d+(null!=_?_:0)-m:"right"==this.conf.align?d+_-m:d-1+(t==this.conf.dir_toplv?this.conf.tl_rmarg:0),f=h-1+c+this.conf.tl_botmarg),"right"==t&&(u=d+_-1,f=h+2),"left"==t&&(u=d-this.idPull[n].offsetWidth+2,f=h+2),"top"==t&&(u=d-1,f=h-p+2),this.conf.fixed_pos)var g=65536,v=65536;else{var g=null!=this.conf.v.x2?this.conf.v.x2:0,v=null!=this.conf.v.y2?this.conf.v.y2:0;0==g&&(window.innerWidth?(g=window.innerWidth,v=window.innerHeight):(g=document.body.offsetWidth,v=document.body.scrollHeight))}if(u+m>g&&!this.conf.rtl&&(u=d-m+2),u<this.conf.v.x1&&this.conf.rtl&&(u=d+_-2),0>u&&(u=0),f+p>v&&null!=this.conf.v.y2&&(f=Math.max(h+c-p+2,this.conf.v_enabled?this.conf.v.y1+2:2),this.conf.context&&this.idPrefix+this.topId==e&&null!=l&&(f-=2),null==this.itemPull[e]||this.conf.context||this.itemPull[e].parent==this.idPrefix+this.topId&&(f-=this.base.offsetHeight)),this.idPull[n].style.left=u+"px",this.idPull[n].style.top=f+"px","undefined"!=typeof this._menuEffect&&this._menuEffect!==!1)this._showPolygonEffect(n);else if(this.idPull[n].style.visibility="",this.conf.overflow_limit>0&&this.conf.overflow_limit<i&&(this.idPull[n].childNodes[1].scrollTop=0,this._checkArrowsState(e)),window.dhx4.isIE6){var x=n+"_ie6cover";if(null==this.idPull[x]){var y=document.createElement("IFRAME");y.className="dhtmlxMenu_IE6CoverFix_"+this.conf.skin,y.frameBorder=0,y.setAttribute("src","javascript:false;"),document.body.insertBefore(y,document.body.firstChild),this.idPull[x]=y}this.idPull[x].style.left=u+"px",this.idPull[x].style.top=f+"px",this.idPull[x].style.width=this.idPull[n].offsetWidth+"px",this.idPull[x].style.height=this.idPull[n].offsetHeight+"px",this.idPull[x].style.zIndex=this.idPull[n].style.zIndex-1,this.idPull[x].style.display=""}e=String(e).replace(this.idPrefix,""),e==this.topId&&(e=null),this.callEvent("onShow",[e]),null!=e&&"dhx_terrace"==this.conf.skin&&this.itemPull[this.idPrefix+e].parent==this.idPrefix+this.topId&&this._improveTerraceButton(this.idPrefix+e,!1)}}},this._redistribSubLevelSelection=function(e,t){for(;this.conf.opened_poly.length>0;)this.conf.opened_poly.pop();var i=this._getSubItemToDeselectByPolygon(t);this._removeSubItemFromSelected(-1,-1);for(var n=0;n<i.length;n++)null!=this.idPull[i[n]]&&i[n]!=e&&"enabled"==this.itemPull[i[n]].state&&(this.idPull[i[n]].className="sub_item");for(var n=0;n<this.conf.opened_poly.length;n++)this.conf.opened_poly[n]!=t&&this._hidePolygon(this.conf.opened_poly[n]);if("enabled"==this.itemPull[e].state){if(this.idPull[e].className="sub_item_selected",this.itemPull[e].complex&&this.conf.dload&&"no"==this.itemPull[e].loaded){1==this.conf.dload_icon&&this._updateLoaderIcon(e,!0),this.itemPull[e].loaded="get";var a=e.replace(this.idPrefix,"");this._dhxdataload.onBeforeXLS=function(){var e={params:{}};e.params[this.conf.dload_pid]=a;for(var t in this.conf.dload_params)e.params[t]=this.conf.dload_params[t];return e},this.loadStruct(this.conf.dload_url)}(this.itemPull[e].complex||this.conf.dload&&"yes"==this.itemPull[e].loaded)&&this.itemPull[e].complex&&null!=this.idPull["polygon_"+e]&&(this._updateItemComplexState(e,!0,!0),this._showPolygon(e,this.conf.dir_sublv)),this._addSubItemToSelected(e,t),this.conf.selected=e}},this._doOnClick=function(e,t,i){if(this.conf.last_click=e,null!=this.itemPull[this.idPrefix+e].href_link&&"enabled"==this.itemPull[this.idPrefix+e].state){var n=document.createElement("FORM"),a=String(this.itemPull[this.idPrefix+e].href_link).split("?");if(n.action=a[0],null!=a[1])for(var r=String(a[1]).split("&"),s=0;s<r.length;s++){var l=String(r[s]).split("="),o=document.createElement("INPUT");o.type="hidden",o.name=l[0]||"",o.value=l[1]||"",n.appendChild(o)}return null!=this.itemPull[this.idPrefix+e].href_target&&(n.target=this.itemPull[this.idPrefix+e].href_target),n.style.display="none",document.body.appendChild(n),n.submit(),void(null!=n&&(document.body.removeChild(n),n=null))}if("c"!=t.charAt(0)&&"d"!=t.charAt(1)&&"s"!=t.charAt(2)){if(this.checkEvent("onClick"))this.callEvent("onClick",[e,this.conf.ctx_zoneid,i]);else if("d"==t.charAt(1)||"win"==this.conf.mode&&"t"==t.charAt(2))return;this.conf.context&&this._isContextMenuVisible()&&this.conf.ctx_autohide?this._hideContextMenu():this._clearAndHide&&this._clearAndHide()}},this._doOnTouchMenu=function(e){0==this.conf.is_touched&&(this.conf.is_touched=!0,this.checkEvent("onTouch")&&this.callEvent("onTouch",[e]))},this._searchMenuNode=function(e,t){for(var i=new Array,n=0;n<t.length;n++)if("object"==typeof t[n]){5==t[n].length&&"object"!=typeof t[n][0]&&t[n][0].replace(this.idPrefix,"")==e&&0==n&&(i=t);var a=this._searchMenuNode(e,t[n]);a.length>0&&(i=a)}return i},this._getMenuNodes=function(e){var t=new Array;for(var i in this.itemPull)this.itemPull[i].parent==e&&(t[t.length]=i);return t},this._genStr=function(e){for(var t="",i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=0;e>n;n++)t+=i.charAt(Math.round(Math.random()*(i.length-1)));return t},this.getItemType=function(e){return e=this.idPrefix+e,null==this.itemPull[e]?null:this.itemPull[e].type},this.forEachItem=function(e){for(var t in this.itemPull)e(String(t).replace(this.idPrefix,""))},this._clearAndHide=function(){for(i.conf.selected=-1,i.conf.last_click=-1;i.conf.opened_poly.length>0;)i.conf.opened_poly.pop();for(var e=0;e<i.conf.selected_sub.length;e++){var t=i.conf.selected_sub[e][0];null!=i.idPull[t]&&"enabled"==i.itemPull[t].state&&("sub_item_selected"==i.idPull[t].className&&(i.idPull[t].className="sub_item"),i.idPull[t].className=="dhtmlxMenu_"+i.conf.skin+"_TopLevel_Item_Selected"&&(null!=i.itemPull[t].cssNormal?i.idPull[t].className=i.itemPull[t].cssNormal:i.idPull[t].className="dhtmlxMenu_"+i.conf.skin+"_TopLevel_Item_Normal")),i._hidePolygon(t)}i.conf.is_touched=!1,i.conf.context&&i.conf.ctx_hideall&&i._hidePolygon(i.idPrefix+i.topId)},this._showSubLevelItem=function(e,t){null!=document.getElementById("arrow_"+this.idPrefix+e)&&(document.getElementById("arrow_"+this.idPrefix+e).style.display=t?"none":""),null!=document.getElementById("image_"+this.idPrefix+e)&&(document.getElementById("image_"+this.idPrefix+e).style.display=t?"none":""),null!=document.getElementById(this.idPrefix+e)&&(document.getElementById(this.idPrefix+e).style.display=t?"":"none")},this._hideSubLevelItem=function(e){this._showSubLevelItem(e,!0)},this.idPrefix=this._genStr(12)+"_",this._bodyClick=function(e){e=e||event,2==e.button||window.dhx4.isOpera&&1==e.ctrlKey||(i.conf.context?i.conf.ctx_autohide&&(!window.dhx4.isOpera||i._isContextMenuVisible()&&window.dhx4.isOpera)&&i._hideContextMenu():i._clearAndHide&&i._clearAndHide())},this._bodyContext=function(e){e=e||event;var t=String((e.srcElement||e.target).className);if(-1==t.search("dhtmlxMenu")||-1==t.search("SubLevelArea")){for(var n=!0,a=e.target||e.srcElement;null!=a;)null!=a.id&&i.isContextZone(a.id)&&(n=!1),a==document.body&&(n=!1),a=a.parentNode;n&&i.hideContextMenu()}},"undefined"!=typeof window.addEventListener?(window.addEventListener("click",this._bodyClick,!1),window.addEventListener("contextmenu",this._bodyContext,!1)):(document.body.attachEvent("onclick",this._bodyClick),document.body.attachEvent("oncontextmenu",this._bodyContext)),this.unload=function(){window.dhx4._eventable(this,"clear"),dhtmlXMenuObject.prototype.liveInst[this.conf.live_id]=null;try{delete dhtmlXMenuObject.prototype.liveInst[this.conf.live_id]}catch(e){}if(this.conf.live_id=null,"function"==typeof window.addEventListener?(window.removeEventListener("click",this._bodyClick,!1),window.removeEventListener("contextmenu",this._bodyContext,!1)):(document.body.detachEvent("onclick",this._bodyClick),document.body.detachEvent("oncontextmenu",this._bodyContext)),this._bodyClick=null,this._bodyContext=null,this.removeItem(this.idPrefix+this.topId,!0),this.itemPull=null,this.idPull=null,this.conf.context)for(var t in this.conf.ctx_zones)this.removeContextZone(t);null!=this.cont&&(this.cont.className="",this.cont.parentNode.removeChild(this.cont),this.cont=null),null!=this.base&&(this.base.className="",this.conf.context||(this.base.oncontextmenu=this.base._oldContextMenuHandler||null),this.base.onselectstart=null,this.base=null);for(var t in this)this[t]=null;i=null},dhtmlXMenuObject.prototype.liveInst[this.conf.live_id]=this,window.dhx4._enableDataLoading(this,"_initObj","_xmlToJson",this.conf.tags.root,{struct:!0}),window.dhx4._eventable(this),1==window.dhx4.s2b(this.conf.autoload.context)&&this.renderAsContextMenu(),null!=this.conf.autoload.dynamic?this.enableDynamicLoading(this.conf.autoload.dynamic,window.dhx4.s2b(this.conf.autoload.dynamic_icon)):null!=this.conf.autoload.items?this.loadStruct(this.conf.autoload.items,this.conf.autoload.onload):null!=this.conf.autoload.json?this.loadStruct(this.conf.autoload.json,this.conf.autoload.onload):null!=this.conf.autoload.xml&&this.loadStruct(this.conf.autoload.xml,this.conf.autoload.onload);for(var n in{onclick:1,oncheckboxclick:1,onradioclick:1})null!=this.conf.autoload[n]&&("function"==typeof this.conf.autoload[n]?this.attachEvent(n,this.conf.autoload[n]):"function"==typeof window[this.conf.autoload[n]]&&this.attachEvent(n,window[this.conf.autoload[n]]));null!=this.conf.autoload.top_text&&this.setTopText(this.conf.autoload.top_text),null!=this.conf.autoload.align&&this.setAlign(this.conf.autoload.align),null!=this.conf.autoload.open_mode&&this.setOpenMode(this.conf.autoload.open_mode),null!=this.conf.autoload.overflow&&this.setOverflowHeight(this.conf.autoload.overflow);for(var n in this.conf.autoload)this.conf.autoload[n]=null,delete this.conf.autoload[n];return this.conf.autoload=null,this}window.dhtmlXScheduler=window.scheduler={version:"4.4.9"},window.dhtmlx||(dhtmlx=function(e){for(var t in e)dhtmlx[t]=e[t];return dhtmlx}),dhtmlx.extend_api=function(e,t,i){var n=window[e];n&&(window[e]=function(e){var i;if(e&&"object"==typeof e&&!e.tagName){i=n.apply(this,t._init?t._init(e):arguments);for(var a in dhtmlx)t[a]&&this[t[a]](dhtmlx[a]);for(var a in e)t[a]?this[t[a]](e[a]):0===a.indexOf("on")&&this.attachEvent(a,e[a])}else i=n.apply(this,arguments);return t._patch&&t._patch(this),i||this},window[e].prototype=n.prototype,i&&dhtmlXHeir(window[e].prototype,i))},dhtmlxAjax={get:function(e,t){var i=new dtmlXMLLoaderObject(!0);return i.async=arguments.length<3,i.waitCall=t,i.loadXML(e),i},post:function(e,t,i){var n=new dtmlXMLLoaderObject(!0);return n.async=arguments.length<4,n.waitCall=i,n.loadXML(e,!0,t),n},getSync:function(e){return this.get(e,null,!0)},postSync:function(e,t){return this.post(e,t,null,!0)}},dtmlXMLLoaderObject.count=0,dtmlXMLLoaderObject.prototype.waitLoadFunction=function(e){var t=!0;return this.check=function(){if(e&&e.onloadAction&&(!e.xmlDoc.readyState||4==e.xmlDoc.readyState)){if(!t)return;t=!1,dtmlXMLLoaderObject.count++,"function"==typeof e.onloadAction&&e.onloadAction(e.mainObject,null,null,null,e),e.waitCall&&(e.waitCall.call(this,e),e.waitCall=null)}},this.check},dtmlXMLLoaderObject.prototype.getXMLTopNode=function(e,t){var i;if(this.xmlDoc.responseXML){var n=this.xmlDoc.responseXML.getElementsByTagName(e);if(0===n.length&&-1!=e.indexOf(":"))var n=this.xmlDoc.responseXML.getElementsByTagName(e.split(":")[1]);i=n[0]}else i=this.xmlDoc.documentElement;if(i)return this._retry=!1,i;if(!this._retry&&_isIE){this._retry=!0;var t=this.xmlDoc;return this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(e,t)}return dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),document.createElement("DIV")},dtmlXMLLoaderObject.prototype.loadXMLString=function(e,t){if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(e);else{var i=new DOMParser;this.xmlDoc=i.parseFromString(e,"text/xml")}t||(this.onloadAction&&this.onloadAction(this.mainObject,null,null,null,this),this.waitCall&&(this.waitCall(),this.waitCall=null))},dtmlXMLLoaderObject.prototype.loadXML=function(e,t,i,n){this.rSeed&&(e+=(-1!=e.indexOf("?")?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf()),this.filePath=e,!_isIE&&window.XMLHttpRequest?this.xmlDoc=new XMLHttpRequest:this.xmlDoc=new ActiveXObject("Microsoft.XMLHTTP"),this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this)),"string"==typeof t?this.xmlDoc.open(t,e,this.async):this.xmlDoc.open(t?"POST":"GET",e,this.async),n?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type","text/xml")):t&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xmlDoc.send(i),this.async||new this.waitLoadFunction(this)()},dtmlXMLLoaderObject.prototype.destructor=function(){return this._filterXPath=null,this._getAllNamedChilds=null,this._retry=null,this.async=null,this.rSeed=null,this.filePath=null,this.onloadAction=null,this.mainObject=null,this.xmlDoc=null,this.doXPath=null,this.doXPathOpera=null,this.doXSLTransToObject=null,this.doXSLTransToString=null,this.loadXML=null,this.loadXMLString=null,this.doSerialization=null,this.xmlNodeToJSON=null,this.getXMLTopNode=null,this.setXSLParamValue=null,null},dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(e){for(var t={},i=0;i<e.attributes.length;i++)t[e.attributes[i].name]=e.attributes[i].value;t._tagvalue=e.firstChild?e.firstChild.nodeValue:"";for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i].tagName;n&&(t[n]||(t[n]=[]),t[n].push(this.xmlNodeToJSON(e.childNodes[i])))}return t},dhtmlDragAndDropObject.prototype.removeDraggableItem=function(e){e.onmousedown=null,e.dragStarter=null,e.dragLanding=null},dhtmlDragAndDropObject.prototype.addDraggableItem=function(e,t){e.onmousedown=this.preCreateDragCopy,e.dragStarter=t,this.addDragLanding(e,t)},dhtmlDragAndDropObject.prototype.addDragLanding=function(e,t){e.dragLanding=t},dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){return!e&&!window.event||2!=(e||event).button?window.dhtmlDragAndDrop.waitDrag?(window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1):(window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(e),window.dhtmlDragAndDrop.waitDrag=1,window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup,window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove,window.dhtmlDragAndDrop.dragStartNode=this,window.dhtmlDragAndDrop.dragStartObject=this.dragStarter,document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy,document.body.onmousemove=window.dhtmlDragAndDrop.callDrag,window.dhtmlDragAndDrop.downtime=(new Date).valueOf(),e&&e.preventDefault?(e.preventDefault(),!1):!1):void 0},dhtmlDragAndDropObject.prototype.callDrag=function(e){e||(e=window.event);var t=window.dhtmlDragAndDrop;if(!((new Date).valueOf()-t.downtime<100)){if(!t.dragNode){if(!t.waitDrag)return t.stopDrag(e,!0);if(t.dragNode=t.dragStartObject._createDragNode(t.dragStartNode,e),!t.dragNode)return t.stopDrag();t.dragNode.onselectstart=function(){return!1},t.gldragNode=t.dragNode,document.body.appendChild(t.dragNode),document.body.onmouseup=t.stopDrag,t.waitDrag=0,t.dragNode.pWindow=window,t.initFrameRoute()}if(t.dragNode.parentNode!=window.document.body&&t.gldragNode){var i=t.gldragNode;t.gldragNode.old&&(i=t.gldragNode.old),i.parentNode.removeChild(i);var n=t.dragNode.pWindow;if(i.pWindow&&i.pWindow.dhtmlDragAndDrop.lastLanding&&i.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(i.pWindow.dhtmlDragAndDrop.lastLanding),_isIE){var a=document.createElement("Div");a.innerHTML=t.dragNode.outerHTML,t.dragNode=a.childNodes[0]}else t.dragNode=t.dragNode.cloneNode(!0);t.dragNode.pWindow=window,t.gldragNode.old=t.dragNode,document.body.appendChild(t.dragNode),n.dhtmlDragAndDrop.dragNode=t.dragNode}t.dragNode.style.left=e.clientX+15+(t.fx?-1*t.fx:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px",t.dragNode.style.top=e.clientY+3+(t.fy?-1*t.fy:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px";var r;r=e.srcElement?e.srcElement:e.target,t.checkLanding(r,e)}},dhtmlDragAndDropObject.prototype.calculateFramePosition=function(e){if(window.name){for(var t=parent.frames[window.name].frameElement.offsetParent,i=0,n=0;t;)i+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;if(parent.dhtmlDragAndDrop){var a=parent.dhtmlDragAndDrop.calculateFramePosition(1);i+=1*a.split("_")[0],n+=1*a.split("_")[1]}if(e)return i+"_"+n;this.fx=i,this.fy=n}return"0_0"},dhtmlDragAndDropObject.prototype.checkLanding=function(e,t){e&&e.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=e,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,t.clientX,t.clientY,t),this.lastLanding_scr=_isIE?t.srcElement:t.target):e&&"BODY"!=e.tagName?this.checkLanding(e.parentNode,t):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,t.clientX,t.clientY,t),this.lastLanding=0,this._onNotFound&&this._onNotFound())},dhtmlDragAndDropObject.prototype.stopDrag=function(e,t){var i=window.dhtmlDragAndDrop;if(!t){i.stopFrameRoute();var n=i.lastLanding;i.lastLanding=null,n&&n.dragLanding._drag(i.dragStartNode,i.dragStartObject,n,_isIE?event.srcElement:e.target)}i.lastLanding=null,i.dragNode&&i.dragNode.parentNode==document.body&&i.dragNode.parentNode.removeChild(i.dragNode),i.dragNode=0,i.gldragNode=0,i.fx=0,i.fy=0,i.dragStartNode=0,i.dragStartObject=0,document.body.onmouseup=i.tempDOMU,document.body.onmousemove=i.tempDOMM,i.tempDOMU=null,i.tempDOMM=null,i.waitDrag=0},dhtmlDragAndDropObject.prototype.stopFrameRoute=function(e){e&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var t=0;t<window.frames.length;t++)try{window.frames[t]!=e&&window.frames[t].dhtmlDragAndDrop&&window.frames[t].dhtmlDragAndDrop.stopFrameRoute(window)}catch(i){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(i){}},dhtmlDragAndDropObject.prototype.initFrameRoute=function(e,t){e&&(window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=e.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=e.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=e.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=e.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&t&&(!_isFF||_FFrv<1.8)&&window.dhtmlDragAndDrop.calculateFramePosition());try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(i){}for(var n=0;n<window.frames.length;n++)try{window.frames[n]!=e&&window.frames[n].dhtmlDragAndDrop&&window.frames[n].dhtmlDragAndDrop.initFrameRoute(window,!e||t?1:0)}catch(i){}},_isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,-1==navigator.appVersion.indexOf("MSIE 8.0")&&-1==navigator.appVersion.indexOf("MSIE 9.0")&&-1==navigator.appVersion.indexOf("MSIE 10.0")||"BackCompat"==document.compatMode||(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),dtmlXMLLoaderObject.prototype.doXPath=function(e,t,i,n){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(e,t);if(_isIE)return t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),i&&t.setProperty("SelectionNamespaces","xmlns:xsl='"+i+"'"),"single"==n?t.selectSingleNode(e):t.selectNodes(e)||new Array(0);var a=t;t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),-1!=t.nodeName.indexOf("document")?a=t:(a=t,
t=t.ownerDocument);var r=XPathResult.ANY_TYPE;"single"==n&&(r=XPathResult.FIRST_ORDERED_NODE_TYPE);var s=[],l=t.evaluate(e,a,function(e){return i},r,null);if(r==XPathResult.FIRST_ORDERED_NODE_TYPE)return l.singleNodeValue;for(var o=l.iterateNext();o;)s[s.length]=o,o=l.iterateNext();return s},_dhtmlxError.prototype.catchError=function(e,t){this.catches[e]=t},_dhtmlxError.prototype.throwError=function(e,t,i){return this.catches[e]?this.catches[e](e,t,i):this.catches.ALL?this.catches.ALL(e,t,i):(window.alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]),null)},window.dhtmlxError=new _dhtmlxError,dtmlXMLLoaderObject.prototype.doXPathOpera=function(e,t){var i=e.replace(/[\/]+/gi,"/").split("/"),n=null,a=1;if(!i.length)return[];if("."==i[0])n=[t];else{if(""!==i[0])return[];n=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(i[a].replace(/\[[^\]]*\]/g,"")),a++}for(a;a<i.length;a++)n=this._getAllNamedChilds(n,i[a]);return-1!=i[a-1].indexOf("[")&&(n=this._filterXPath(n,i[a-1])),n},dtmlXMLLoaderObject.prototype._filterXPath=function(e,t){for(var i=[],t=t.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),n=0;n<e.length;n++)e[n].getAttribute(t)&&(i[i.length]=e[n]);return i},dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(e,t){var i=[];_isKHTML&&(t=t.toUpperCase());for(var n=0;n<e.length;n++)for(var a=0;a<e[n].childNodes.length;a++)_isKHTML?e[n].childNodes[a].tagName&&e[n].childNodes[a].tagName.toUpperCase()==t&&(i[i.length]=e[n].childNodes[a]):e[n].childNodes[a].tagName==t&&(i[i.length]=e[n].childNodes[a]);return i},"undefined"==typeof window.dhtmlxEvent&&(window.dhtmlxEvent=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)}),dtmlXMLLoaderObject.prototype.xslDoc=null,dtmlXMLLoaderObject.prototype.setXSLParamValue=function(e,t,i){i||(i=this.xslDoc),i.responseXML&&(i=i.responseXML);var n=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+e+"']",i,"http://www.w3.org/1999/XSL/Transform","single");n&&(n.firstChild.nodeValue=t)},dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(e,t){e||(e=this.xslDoc),e.responseXML&&(e=e.responseXML),t||(t=this.xmlDoc),t.responseXML&&(t=t.responseXML);var i;if(_isIE){i=new ActiveXObject("Msxml2.DOMDocument.3.0");try{t.transformNodeToObject(e,i)}catch(n){i=t.transformNode(e)}}else this.XSLProcessor||(this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(e)),i=this.XSLProcessor.transformToDocument(t);return i},dtmlXMLLoaderObject.prototype.doXSLTransToString=function(e,t){var i=this.doXSLTransToObject(e,t);return"string"==typeof i?i:this.doSerialization(i)},dtmlXMLLoaderObject.prototype.doSerialization=function(e){if(e||(e=this.xmlDoc),e.responseXML&&(e=e.responseXML),_isIE)return e.xml;var t=new XMLSerializer;return t.serializeToString(e)},dhtmlxEventable=function(obj){obj.attachEvent=function(e,t,i){return e="ev_"+e.toLowerCase(),this[e]||(this[e]=new this.eventCatcher(i||this)),e+":"+this[e].addEvent(t)},obj.callEvent=function(e,t){return e="ev_"+e.toLowerCase(),this[e]?this[e].apply(this,t):!0},obj.checkEvent=function(e){return!!this["ev_"+e.toLowerCase()]},obj.eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var e=!0,t=0;t<dhx_catch.length;t++)if(dhx_catch[t]){var i=dhx_catch[t].apply(obj,arguments);e=e&&i}return e};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),ev?dhx_catch.push(ev)-1:!1},z.removeEvent=function(e){dhx_catch[e]=null},z},obj.detachEvent=function(e){if(e){var t=e.split(":");this[t[0]].removeEvent(t[1])}},obj.detachAllEvents=function(){for(var e in this)0===e.indexOf("ev_")&&(this.detachEvent(e),this[e]=null)},obj=null},window.dhtmlx||(window.dhtmlx={}),function(){function e(e,t){setTimeout(function(){if(e.box){var n=e.callback;i(!1),e.box.parentNode.removeChild(e.box),dhtmlx.callEvent("onAfterMessagePopup",[e.box]),c=e.box=null,n&&n(t)}},1)}function t(t){if(c){t=t||event;var i=t.which||event.keyCode,n=!1;if(dhtmlx.message.keyboard){if(13==i||32==i){var a=t.target||t.srcElement;scheduler._getClassName(a).indexOf("dhtmlx_popup_button")>-1&&a.click?a.click():(e(c,!0),n=!0)}27==i&&(e(c,!1),n=!0)}if(n)return t.preventDefault&&t.preventDefault(),!(t.cancelBubble=!0)}}function i(e){i.cover||(i.cover=document.createElement("DIV"),i.cover.onkeydown=t,i.cover.className="dhx_modal_cover",document.body.appendChild(i.cover)),document.body.scrollHeight,i.cover.style.display=e?"inline-block":"none"}function n(e,t,i){var n=scheduler._waiAria.messageButtonAttrString(e),a=i?i:e||"",r="dhtmlx_"+a.toLowerCase().replace(/ /g,"_")+"_button";return"<div "+n+"class='dhtmlx_popup_button "+r+"' result='"+t+"' ><div>"+e+"</div></div>"}function a(e){u.area||(u.area=document.createElement("DIV"),u.area.className="dhtmlx_message_area",u.area.style[u.position]="5px",document.body.appendChild(u.area)),u.hide(e.id);var t=document.createElement("DIV");return t.innerHTML="<div>"+e.text+"</div>",t.className="dhtmlx-info dhtmlx-"+e.type,t.onclick=function(){u.hide(e.id),e=null},scheduler._waiAria.messageInfoAttr(t),"bottom"==u.position&&u.area.firstChild?u.area.insertBefore(t,u.area.firstChild):u.area.appendChild(t),e.expire>0&&(u.timers[e.id]=window.setTimeout(function(){u.hide(e.id)},e.expire)),u.pull[e.id]=t,t=null,e.id}function r(t,i,a){var r=document.createElement("DIV");r.className=" dhtmlx_modal_box dhtmlx-"+t.type,r.setAttribute("dhxbox",1);var s=scheduler.uid();scheduler._waiAria.messageModalAttr(r,s);var l="",o=!1;if(t.width&&(r.style.width=t.width),t.height&&(r.style.height=t.height),t.title&&(l+='<div class="dhtmlx_popup_title" id="'+s+'">'+t.title+"</div>",o=!0),l+='<div class="dhtmlx_popup_text" '+(o?"":' id="'+s+'" ')+"><span>"+(t.content?"":t.text)+'</span></div><div  class="dhtmlx_popup_controls">',i){var d=t.ok||scheduler.locale.labels.message_ok;void 0===d&&(d="OK"),l+=n(d,!0,"ok")}if(a){var h=t.cancel||scheduler.locale.labels.message_cancel;void 0===h&&(h="Cancel"),l+=n(h,!1,"cancel")}if(t.buttons)for(var _=0;_<t.buttons.length;_++)l+=n(t.buttons[_],_);if(l+="</div>",r.innerHTML=l,t.content){var u=t.content;"string"==typeof u&&(u=document.getElementById(u)),"none"==u.style.display&&(u.style.display=""),r.childNodes[t.title?1:0].appendChild(u)}return r.onclick=function(i){i=i||event;var n=i.target||i.srcElement,a=scheduler._getClassName(n);if(a||(n=n.parentNode),a=scheduler._getClassName(n),"dhtmlx_popup_button"==a.split(" ")[0]){var r=n.getAttribute("result");r="true"==r||("false"==r?!1:r),e(t,r)}},t.box=r,c=t,r}function s(e,n,a){var s=e.tagName?e:r(e,n,a);e.hidden||i(!0),document.body.appendChild(s);var l=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-s.offsetWidth)/2)),o=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-s.offsetHeight)/2));return"top"==e.position?s.style.top="-3px":s.style.top=o+"px",s.style.left=l+"px",s.onkeydown=t,dhtmlx.modalbox.focus(s),e.hidden&&dhtmlx.modalbox.hide(s),dhtmlx.callEvent("onMessagePopup",[s]),s}function l(e){return s(e,!0,!1)}function o(e){return s(e,!0,!0)}function d(e){return s(e)}function h(e,t,i){return"object"!=typeof e&&("function"==typeof t&&(i=t,t=""),e={text:e,type:t,callback:i}),e}function _(e,t,i,n){return"object"!=typeof e&&(e={text:e,type:t,expire:i,id:n}),e.id=e.id||u.uid(),e.expire=e.expire||u.expire,e}var c=null;document.attachEvent?document.attachEvent("onkeydown",t):document.addEventListener("keydown",t,!0),dhtmlx.alert=function(){var e=h.apply(this,arguments);return e.type=e.type||"confirm",l(e)},dhtmlx.confirm=function(){var e=h.apply(this,arguments);return e.type=e.type||"alert",o(e)},dhtmlx.modalbox=function(){var e=h.apply(this,arguments);return e.type=e.type||"alert",d(e)},dhtmlx.modalbox.hide=function(e){for(;e&&e.getAttribute&&!e.getAttribute("dhxbox");)e=e.parentNode;e&&(e.parentNode.removeChild(e),i(!1))},dhtmlx.modalbox.focus=function(e){setTimeout(function(){var t=scheduler._getFocusableNodes(e);t.length&&t[0].focus&&t[0].focus()},1)};var u=dhtmlx.message=function(e,t,i,n){e=_.apply(this,arguments),e.type=e.type||"info";var r=e.type.split("-")[0];switch(r){case"alert":return l(e);case"confirm":return o(e);case"modalbox":return d(e);default:return a(e)}};u.seed=(new Date).valueOf(),u.uid=function(){return u.seed++},u.expire=4e3,u.keyboard=!0,u.position="top",u.pull={},u.timers={},u.hideAll=function(){for(var e in u.pull)u.hide(e)},u.hide=function(e){var t=u.pull[e];t&&t.parentNode&&(window.setTimeout(function(){t.parentNode.removeChild(t),t=null},2e3),t.className+=" hidden",u.timers[e]&&window.clearTimeout(u.timers[e]),delete u.pull[e])}}(),dhtmlx.attachEvent||dhtmlxEventable(dhtmlx),dataProcessor.prototype={setTransactionMode:function(e,t){this._tMode=e,this._tSend=t,"REST"==e&&(this._tSend=!1,this._endnm=!0)},escape:function(e){return this._utf?encodeURIComponent(e):escape(e)},enableUTFencoding:function(e){this._utf=convertStringToBoolean(e)},setDataColumns:function(e){this._columns="string"==typeof e?e.split(","):e},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(e){this._endnm=convertStringToBoolean(e)},enablePartialDataSend:function(e){this._changed=convertStringToBoolean(e)},setUpdateMode:function(e,t){this.autoUpdate="cell"==e,this.updateMode=e,this.dnd=t},ignore:function(e,t){this._silent_mode=!0,e.call(t||window),this._silent_mode=!1},setUpdated:function(e,t,i){if(!this._silent_mode){var n=this.findRow(e);i=i||"updated";var a=this.obj.getUserData(e,this.action_param);a&&"updated"==i&&(i=a),t?(this.set_invalid(e,!1),this.updatedRows[n]=e,this.obj.setUserData(e,this.action_param,i),this._in_progress[e]&&(this._in_progress[e]="wait")):this.is_invalid(e)||(this.updatedRows.splice(n,1),this.obj.setUserData(e,this.action_param,"")),t||this._clearUpdateFlag(e),this.markRow(e,t,i),t&&this.autoUpdate&&this.sendData(e)}},_clearUpdateFlag:function(e){},markRow:function(e,t,i){var n="",a=this.is_invalid(e);if(a&&(n=this.styles[a],t=!0),this.callEvent("onRowMark",[e,t,i,a])&&(n=this.styles[t?i:"clear"]+n,this.obj[this._methods[0]](e,n),a&&a.details)){n+=this.styles[a+"_cell"];for(var r=0;r<a.details.length;r++)a.details[r]&&this.obj[this._methods[1]](e,r,n)}},getState:function(e){return this.obj.getUserData(e,this.action_param)},is_invalid:function(e){return this._invalid[e]},set_invalid:function(e,t,i){i&&(t={value:t,details:i,toString:function(){return this.value.toString()}}),this._invalid[e]=t},checkBeforeUpdate:function(e){return!0},sendData:function(e){return!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2?(this.obj.editStop&&this.obj.editStop(),"undefined"==typeof e||this._tSend?this.sendAllData():this._in_progress[e]?!1:(this.messages=[],!this.checkBeforeUpdate(e)&&this.callEvent("onValidationError",[e,this.messages])?!1:void this._beforeSendData(this._getRowData(e),e))):void 0},_beforeSendData:function(e,t){return this.callEvent("onBeforeUpdate",[t,this.getState(t),e])?void this._sendData(e,t):!1},serialize:function(e,t){if("string"==typeof e)return e;if("undefined"!=typeof t)return this.serialize_one(e,"");var i=[],n=[];for(var a in e)e.hasOwnProperty(a)&&(i.push(this.serialize_one(e[a],a+this.post_delim)),n.push(a));return i.push("ids="+this.escape(n.join(","))),dhtmlx.security_key&&i.push("dhx_security="+dhtmlx.security_key),i.join("&")},serialize_one:function(e,t){if("string"==typeof e)return e;var i=[];for(var n in e)if(e.hasOwnProperty(n)){if(("id"==n||n==this.action_param)&&"REST"==this._tMode)continue;i.push(this.escape((t||"")+n)+"="+this.escape(e[n]))}return i.join("&")},_sendData:function(e,t){if(e){if(!this.callEvent("onBeforeDataSending",t?[t,this.getState(t),e]:[null,null,e]))return!1;t&&(this._in_progress[t]=(new Date).valueOf());var i=new dtmlXMLLoaderObject(function(i,n,a,r,s){var l=[];if(t)l.push(t);else if(e)for(var o in e)l.push(o);return i.afterUpdate(i,s,l)},this,!0),n=this.serverProcessor+(this._user?getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");if("GET"==this._tMode)i.loadXML(n+(-1!=n.indexOf("?")?"&":"?")+this.serialize(e,t));else if("POST"==this._tMode)i.loadXML(n,!0,this.serialize(e,t));else if("REST"==this._tMode){var a=this.getState(t),r=n.replace(/(\&|\?)editing\=true/,"");"inserted"==a?i.loadXML(r+t,"POST",this.serialize(e,t)):"deleted"==a?i.loadXML(r+t,"DELETE",""):i.loadXML(r+t,"PUT",this.serialize(e,t))}this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var e=!0,t=0;t<this.updatedRows.length;t++)e&=this.checkBeforeUpdate(this.updatedRows[t]);if(!e&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(var t=0;t<this.updatedRows.length;t++)if(!this._in_progress[this.updatedRows[t]]){if(this.is_invalid(this.updatedRows[t]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[t]),this.updatedRows[t]),this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(e){for(var t={},i=!1,n=0;n<this.updatedRows.length;n++){var a=this.updatedRows[n];this._in_progress[a]||this.is_invalid(a)||this.callEvent("onBeforeUpdate",[a,this.getState(a),this._getRowData(a)])&&(t[a]=this._getRowData(a,a+this.post_delim),i=!0,this._in_progress[a]=(new Date).valueOf())}return i?t:null},setVerificator:function(e,t){this.mandatoryFields[e]=t||function(e){return""!==e}},clearVerificator:function(e){this.mandatoryFields[e]=!1},findRow:function(e){var t=0;for(t=0;t<this.updatedRows.length&&e!=this.updatedRows[t];t++);return t},defineAction:function(e,t){this._uActions||(this._uActions=[]),this._uActions[e]=t},afterUpdateCallback:function(e,t,i,n){var a=e,r="error"!=i&&"invalid"!=i;if(r||this.set_invalid(e,i),this._uActions&&this._uActions[i]&&!this._uActions[i](n))return delete this._in_progress[a];"wait"!=this._in_progress[a]&&this.setUpdated(e,!1);var s=e;switch(i){case"inserted":case"insert":t!=e&&(this.setUpdated(e,!1),this.obj[this._methods[2]](e,t),e=t);break;case"delete":case"deleted":return this.obj.setUserData(e,this.action_param,"true_deleted"),this.obj[this._methods[3]](e,t),delete this._in_progress[a],this.callEvent("onAfterUpdate",[e,i,t,n])}"wait"!=this._in_progress[a]?(r&&this.obj.setUserData(e,this.action_param,""),delete this._in_progress[a]):(delete this._in_progress[a],this.setUpdated(t,!0,this.obj.getUserData(e,this.action_param))),this.callEvent("onAfterUpdate",[s,i,t,n])},afterUpdate:function(e,t,i){if(window.JSON)try{var n=JSON.parse(t.xmlDoc.responseText),a=n.action||this.getState(i)||"updated",r=n.sid||i[0],s=n.tid||i[0];return e.afterUpdateCallback(r,s,a,n),void e.finalizeUpdate()}catch(l){}if(t.getXMLTopNode("data"),!t.xmlDoc.responseXML)return this.obj&&this.obj.callEvent&&this.obj.callEvent("onSaveError",[i,t.xmlDoc]),this.cleanUpdate(i);var o=t.doXPath("//data/action");if(!o.length)return this.cleanUpdate(i);for(var d=0;d<o.length;d++){var h=o[d],a=h.getAttribute("type"),r=h.getAttribute("sid"),s=h.getAttribute("tid");e.afterUpdateCallback(r,s,a,h)}e.finalizeUpdate()},cleanUpdate:function(e){if(e)for(var t=0;t<e.length;t++)delete this._in_progress[e[t]]},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(e){this.obj=e,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(e){this.attachEvent("onAfterUpdate",e)},enableDebug:function(e){},setOnBeforeUpdateHandler:function(e){this.attachEvent("onBeforeDataSending",e)},setAutoUpdate:function(e,t){e=e||2e3,this._user=t||(new Date).valueOf(),this._need_update=!1,this._loader=null,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(e,t,i,n){this.afterAutoUpdate(e,t,i,n)}),this.attachEvent("onFullSync",function(){this.fullSync()});var i=this;window.setInterval(function(){i.loadUpdate()},e)},afterAutoUpdate:function(e,t,i,n){return"collision"==t?(this._need_update=!0,!1):!0},fullSync:function(){return this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(e,t){return this._update_busy?!1:(this._update_busy=!0,this._loader=this._loader||new dtmlXMLLoaderObject(!0),this._loader.async=!0,this._loader.waitCall=t,void this._loader.loadXML(e))},_v:function(e){return e.firstChild?e.firstChild.nodeValue:""},_a:function(e){for(var t=[],i=0;i<e.length;i++)t[i]=this._v(e[i]);return t},loadUpdate:function(){var e=this,t=this.obj.getUserData(0,"version"),i=this.serverProcessor+getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+t].join("&");i=i.replace("editing=true&",""),this.getUpdates(i,function(){var t;try{t=e._loader.doXPath("//userdata")}catch(i){return void(e._update_busy=!1)}e.obj.setUserData(0,"version",e._v(t[0]));var n=e._loader.doXPath("//update");if(n.length){e._silent_mode=!0;for(var a=0;a<n.length;a++){var r=n[a].getAttribute("status"),s=n[a].getAttribute("id"),l=n[a].getAttribute("parent");switch(r){case"inserted":e.callEvent("insertCallback",[n[a],s,l]);break;case"updated":e.callEvent("updateCallback",[n[a],s,l]);break;case"deleted":e.callEvent("deleteCallback",[n[a],s,l])}}e._silent_mode=!1}e._update_busy=!1,e=null})}},window.dataProcessor&&!dataProcessor.prototype.init_original&&(dataProcessor.prototype.init_original=dataProcessor.prototype.init,dataProcessor.prototype.init=function(e){this.init_original(e),e._dataprocessor=this,this.setTransactionMode("POST",!0),this.serverProcessor+=(-1!=this.serverProcessor.indexOf("?")?"&":"?")+"editing=true"}),dhtmlxError.catchError("LoadXML",function(e,t,i){var n=i[0].responseText;switch(scheduler.config.ajax_error){case"alert":window.alert(n);break;case"console":window.console.log(n)}}),window.Scheduler={_seed:0},Scheduler.plugin=function(e){this._schedulerPlugins.push(e),e(window.scheduler)},Scheduler._schedulerPlugins=[],Scheduler.getSchedulerInstance=function(){var scheduler={version:"4.4.9"};dhtmlxEventable(scheduler),scheduler._detachDomEvent=function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)},scheduler._init_once=function(){function e(e){for(var t=document.body;e&&e!=t;)e=e.parentNode;return!(t!=e)}function t(){return{w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight}}function i(e,t){return e.w==t.w&&e.h==t.h}var n=t();dhtmlxEvent(window,"resize",function(){e(scheduler._obj)&&(window.clearTimeout(scheduler._resize_timer),scheduler._resize_timer=window.setTimeout(function(){var a=t();if(!i(n,a)){if(!e(scheduler._obj))return;scheduler.callEvent("onSchedulerResize",[])&&(scheduler.update_view(),scheduler.callEvent("onAfterSchedulerResize",[]))}n=a},20))}),scheduler._init_once=function(){}},scheduler.init=function(e,t,i){t=t||scheduler._currentDate(),i=i||"week",this._obj&&this.unset_actions(),this._obj="string"==typeof e?document.getElementById(e):e,this.$container=this._obj,this.config.wai_aria_attributes&&this.config.wai_aria_application_role&&this.$container.setAttribute("role","application"),this._skin_init&&scheduler._skin_init(),scheduler.date.init(),this._els=[],this._scroll=!0,this._quirks=_isIE&&"BackCompat"==document.compatMode,this._quirks7=_isIE&&-1==navigator.appVersion.indexOf("MSIE 8"),this.get_elements(),this.init_templates(),this.set_actions(),this._init_once(),this._init_touch_events(),this.set_sizes(),scheduler.callEvent("onSchedulerReady",[]),this.setCurrentView(t,i)},scheduler.xy={min_event_height:40,scale_width:50,scroll_width:18,scale_height:20,month_scale_height:20,menu_width:25,margin_top:0,margin_left:0,editor_width:140,month_head_height:22},scheduler.keys={edit_save:13,edit_cancel:27},scheduler.set_sizes=function(){var e=this._x=this._obj.clientWidth-this.xy.margin_left,t=this._y=this._obj.clientHeight-this.xy.margin_top,i=this._table_view?0:this.xy.scale_width+this.xy.scroll_width,n=this._table_view?-1:this.xy.scale_width;this.set_xy(this._els.dhx_cal_navline[0],e,this.xy.nav_height,0,0),this.set_xy(this._els.dhx_cal_header[0],e-i,this.xy.scale_height,n,this.xy.nav_height+(this._quirks?-1:1));var a=this._els.dhx_cal_navline[0].offsetHeight;a>0&&(this.xy.nav_height=a);var r=this.xy.scale_height+this.xy.nav_height+(this._quirks?-2:0);this.set_xy(this._els.dhx_cal_data[0],e,t-(r+2),0,r+2)},scheduler.set_xy=function(e,t,i,n,a){e.style.width=Math.max(0,t)+"px",e.style.height=Math.max(0,i)+"px",arguments.length>3&&(e.style.left=n+"px",e.style.top=a+"px")},scheduler.get_elements=function(){for(var e=this._obj.getElementsByTagName("DIV"),t=0;t<e.length;t++){var i=scheduler._getClassName(e[t]),n=e[t].getAttribute("name")||"";i&&(i=i.split(" ")[0]),this._els[i]||(this._els[i]=[]),this._els[i].push(e[t]);var a=scheduler.locale.labels[n||i];"string"!=typeof a&&n&&!e[t].innerHTML&&(a=n.split("_")[0]),a&&(this._waiAria.labelAttr(e[t],a),e[t].innerHTML=a)}},scheduler.unset_actions=function(){for(var e in this._els)if(this._click[e])for(var t=0;t<this._els[e].length;t++)this._els[e][t].onclick=null;this._obj.onselectstart=null,this._obj.onmousemove=null,this._obj.onmousedown=null,this._obj.onmouseup=null,this._obj.ondblclick=null,this._obj.oncontextmenu=null},scheduler.set_actions=function(){for(var e in this._els)if(this._click[e])for(var t=0;t<this._els[e].length;t++)this._els[e][t].onclick=scheduler._click[e];this._obj.onselectstart=function(e){return!1},this._obj.onmousemove=function(e){scheduler._temp_touch_block||scheduler._on_mouse_move(e||event)},this._obj.onmousedown=function(e){scheduler._ignore_next_click||scheduler._on_mouse_down(e||event)},this._obj.onmouseup=function(e){scheduler._ignore_next_click||scheduler._on_mouse_up(e||event)},this._obj.ondblclick=function(e){scheduler._on_dbl_click(e||event)},this._obj.oncontextmenu=function(e){var t=e||event,i=t.target||t.srcElement,n=scheduler.callEvent("onContextMenu",[scheduler._locate_event(i),t]);return n}},scheduler.select=function(e){this._select_id!=e&&(scheduler._close_not_saved(),this.editStop(!1),this.unselect(),this._select_id=e,this.updateEvent(e))},scheduler.unselect=function(e){if(!e||e==this._select_id){var t=this._select_id;this._select_id=null,t&&this.getEvent(t)&&this.updateEvent(t)}},scheduler.getState=function(){return{mode:this._mode,date:new Date(this._date),min_date:new Date(this._min_date),max_date:new Date(this._max_date),editor_id:this._edit_id,lightbox_id:this._lightbox_id,new_event:this._new_event,select_id:this._select_id,expanded:this.expanded,drag_id:this._drag_id,drag_mode:this._drag_mode}},scheduler._click={dhx_cal_data:function(e){if(scheduler._ignore_next_click)return e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._ignore_next_click=!1,!1;var t=e?e.target:event.srcElement,i=scheduler._locate_event(t);if(e=e||event,i){if(!scheduler.callEvent("onClick",[i,e])||scheduler.config.readonly)return}else scheduler.callEvent("onEmptyClick",[scheduler.getActionData(e).date,e]);if(i&&scheduler.config.select){scheduler.select(i);var n=scheduler._getClassName(t);-1!=n.indexOf("_icon")&&scheduler._click.buttons[n.split(" ")[1].replace("icon_","")](i)}else scheduler._close_not_saved(),(new Date).valueOf()-(scheduler._new_event||0)>500&&scheduler.unselect()},dhx_cal_prev_button:function(){scheduler._click.dhx_cal_next_button(0,-1)},dhx_cal_next_button:function(e,t){scheduler.setCurrentView(scheduler.date.add(scheduler.date[scheduler._mode+"_start"](scheduler._date),t||1,scheduler._mode))},dhx_cal_today_button:function(){scheduler.callEvent("onBeforeTodayDisplayed",[])&&scheduler.setCurrentView(scheduler._currentDate())},dhx_cal_tab:function(){var e=this.getAttribute("name"),t=e.substring(0,e.search("_tab"));scheduler.setCurrentView(scheduler._date,t)},buttons:{"delete":function(e){var t=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(t,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(e)})},edit:function(e){scheduler.edit(e)},save:function(e){scheduler.editStop(!0)},details:function(e){scheduler.showLightbox(e)},cancel:function(e){scheduler.editStop(!1)}}},scheduler._dhtmlx_confirm=function(e,t,i){if(!e)return i();var n={text:e};t&&(n.title=t),i&&(n.callback=function(e){e&&i()}),dhtmlx.confirm(n)},scheduler.addEventNow=function(e,t,i){var n={};e&&null!==e.constructor.toString().match(/object/i)&&(n=e,e=null);var a=6e4*(this.config.event_duration||this.config.time_step);e||(e=n.start_date||Math.round(scheduler._currentDate().valueOf()/a)*a);var r=new Date(e);if(!t){var s=this.config.first_hour;s>r.getHours()&&(r.setHours(s),e=r.valueOf()),t=e.valueOf()+a}var l=new Date(t);r.valueOf()==l.valueOf()&&l.setTime(l.valueOf()+a),n.start_date=n.start_date||r,n.end_date=n.end_date||l,n.text=n.text||this.locale.labels.new_event,n.id=this._drag_id=n.id||this.uid(),this._drag_mode="new-size",this._loading=!0;var o=this.addEvent(n);return this.callEvent("onEventCreated",[this._drag_id,i]),this._loading=!1,this._drag_event={},this._on_mouse_up(i),o},scheduler._on_dbl_click=function(e,t){if(t=t||e.target||e.srcElement,!this.config.readonly){var i=scheduler._getClassName(t).split(" ")[0];switch(i){case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_wa_day_data":if(!scheduler.config.dblclick_create)break;this.addEventNow(this.getActionData(e).date,null,e);break;case"dhx_cal_event":case"dhx_wa_ev_body":case"dhx_agenda_line":case"dhx_grid_event":case"dhx_cal_event_line":case"dhx_cal_event_clear":var n=this._locate_event(t);if(!this.callEvent("onDblClick",[n,e]))return;this.config.details_on_dblclick||this._table_view||!this.getEvent(n)._timed||!this.config.select?this.showLightbox(n):this.edit(n);break;case"dhx_time_block":case"dhx_cal_container":return;default:var a=this["dblclick_"+i];if(a)a.call(this,e);else if(t.parentNode&&t!=this)return scheduler._on_dbl_click(e,t.parentNode)}}},scheduler._get_column_index=function(e){var t=0;if(this._cols){for(var i=0,n=0;i+this._cols[n]<e&&n<this._cols.length;)i+=this._cols[n],n++;if(t=n+(this._cols[t]?(e-i)/this._cols[t]:0),this._ignores){for(var n=0;t>=n;n++)this._ignores[n]&&t++;if(t>=this._cols.length)for(;t>=1&&this._ignores[Math.floor(t)];)t--}}return t},scheduler._week_indexes_from_pos=function(e){if(this._cols){var t=this._get_column_index(e.x);return e.x=Math.min(this._cols.length-1,Math.max(0,Math.ceil(t)-1)),e.y=Math.max(0,Math.ceil(60*e.y/(this.config.time_step*this.config.hour_size_px))-1)+this.config.first_hour*(60/this.config.time_step),e}return e},scheduler._mouse_coords=function(e){var t,i=document.body,n=document.documentElement;t=_isIE||!e.pageX&&!e.pageY?{x:e.clientX+(i.scrollLeft||n.scrollLeft||0)-i.clientLeft,y:e.clientY+(i.scrollTop||n.scrollTop||0)-i.clientTop}:{x:e.pageX,y:e.pageY},t.x-=getAbsoluteLeft(this._obj)+(this._table_view?0:this.xy.scale_width),t.y-=getAbsoluteTop(this._obj)+this.xy.nav_height+(this._dy_shift||0)+this.xy.scale_height-this._els.dhx_cal_data[0].scrollTop,t.ev=e;var a=this["mouse_"+this._mode];if(a)t=a.call(this,t);else if(this._table_view){var r=this._get_column_index(t.x);if(!this._cols||!this._colsS)return t;var s=0;for(s=1;s<this._colsS.heights.length&&!(this._colsS.heights[s]>t.y);s++);t.y=Math.ceil(24*(Math.max(0,r)+7*Math.max(0,s-1))*60/this.config.time_step),(scheduler._drag_mode||"month"==this._mode)&&(t.y=24*(Math.max(0,Math.ceil(r)-1)+7*Math.max(0,s-1))*60/this.config.time_step),"move"==this._drag_mode&&scheduler._ignores_detected&&scheduler.config.preserve_length&&(t._ignores=!0,this._drag_event._event_length||(this._drag_event._event_length=this._get_real_event_length(this._drag_event.start_date,this._drag_event.end_date,{x_step:1,x_unit:"day"}))),t.x=0}else t=this._week_indexes_from_pos(t);return t.timestamp=+new Date,t},scheduler._close_not_saved=function(){if((new Date).valueOf()-(scheduler._new_event||0)>500&&scheduler._edit_id){var e=scheduler.locale.labels.confirm_closing;scheduler._dhtmlx_confirm(e,scheduler.locale.labels.title_confirm_closing,function(){scheduler.editStop(scheduler.config.positive_closing)}),e&&(this._drag_id=this._drag_pos=this._drag_mode=null)}},scheduler._correct_shift=function(e,t){return e-=6e4*(new Date(scheduler._min_date).getTimezoneOffset()-new Date(e).getTimezoneOffset())*(t?-1:1)},scheduler._is_pos_changed=function(e,t){function i(e,t,i){return!!(Math.abs(e-t)>i)}if(!e||!this._drag_pos)return!0;var n=100,a=5;return!!(this._drag_pos.has_moved||!this._drag_pos.timestamp||t.timestamp-this._drag_pos.timestamp>n||i(e.ev.clientX,t.ev.clientX,a)||i(e.ev.clientY,t.ev.clientY,a))},scheduler._correct_drag_start_date=function(e){var t;scheduler.matrix&&(t=scheduler.matrix[scheduler._mode]),t=t||{x_step:1,x_unit:"day"},e=new Date(e);var i=1;return(t._start_correction||t._end_correction)&&(i=60*(t.last_hour||0)-(60*e.getHours()+e.getMinutes())||1),1*e+(scheduler._get_fictional_event_length(e,i,t)-i)},scheduler._correct_drag_end_date=function(e,t){var i;scheduler.matrix&&(i=scheduler.matrix[scheduler._mode]),i=i||{x_step:1,x_unit:"day"};var n=1*e+scheduler._get_fictional_event_length(e,t,i);return new Date(1*n-(scheduler._get_fictional_event_length(n,-1,i,-1)+1))},scheduler._on_mouse_move=function(e){if(this._drag_mode){var t=this._mouse_coords(e);if(this._is_pos_changed(this._drag_pos,t)){var i,n;if(this._edit_id!=this._drag_id&&this._close_not_saved(),!this._drag_mode)return;if(this._drag_pos=t,this._drag_pos.has_moved=!0,"create"==this._drag_mode){if(this._close_not_saved(),this.unselect(this._select_id),this._loading=!0,i=this._get_date_from_pos(t).valueOf(),!this._drag_start){var a=this.callEvent("onBeforeEventCreated",[e,this._drag_id]);return a?(this._loading=!1,void(this._drag_start=i)):void(this._loading=!1)}n=i,n==this._drag_start;var r=new Date(this._drag_start),s=new Date(n);"day"!=this._mode&&"week"!=this._mode||r.getHours()!=s.getHours()||r.getMinutes()!=s.getMinutes()||(s=new Date(this._drag_start+1e3)),this._drag_id=this.uid(),this.addEvent(r,s,this.locale.labels.new_event,this._drag_id,t.fields),this.callEvent("onEventCreated",[this._drag_id,e]),this._loading=!1,this._drag_mode="new-size"}var l,o=this.getEvent(this._drag_id);if(scheduler.matrix&&(l=scheduler.matrix[scheduler._mode]),l=l||{x_step:1,x_unit:"day"},"move"==this._drag_mode)i=this._min_date.valueOf()+6e4*(t.y*this.config.time_step+24*t.x*60-(scheduler._move_pos_shift||0)),!t.custom&&this._table_view&&(i+=1e3*this.date.time_part(o.start_date)),i=this._correct_shift(i),t._ignores&&this.config.preserve_length&&this._table_view?(i=scheduler._correct_drag_start_date(i),n=scheduler._correct_drag_end_date(i,this._drag_event._event_length)):n=o.end_date.valueOf()-(o.start_date.valueOf()-i);else{if(i=o.start_date.valueOf(),n=o.end_date.valueOf(),this._table_view){var d=this._min_date.valueOf()+t.y*this.config.time_step*6e4+(t.custom?0:864e5);if("month"==this._mode)if(d=this._correct_shift(d,!1),this._drag_from_start){var h=864e5;d<=scheduler.date.date_part(new Date(n+h-1)).valueOf()&&(i=d-h)}else n=d;else this.config.preserve_length?t.resize_from_start?i=scheduler._correct_drag_start_date(d):n=scheduler._correct_drag_end_date(d,0):t.resize_from_start?i=d:n=d}else{var _=this.date.date_part(new Date(o.end_date.valueOf()-1)).valueOf(),c=new Date(_);n=_+t.y*this.config.time_step*6e4,n+=6e4*(new Date(n).getTimezoneOffset()-c.getTimezoneOffset()),this._els.dhx_cal_data[0].style.cursor="s-resize",("week"==this._mode||"day"==this._mode)&&(n=this._correct_shift(n))}if("new-size"==this._drag_mode)if(n<=this._drag_start){var u=t.shift||(this._table_view&&!t.custom?864e5:0);i=n-(t.shift?0:u),n=this._drag_start+(u||6e4*this.config.time_step)}else i=this._drag_start;else i>=n&&(n=i+6e4*this.config.time_step)}var f=new Date(n-1),m=new Date(i);if("move"==this._drag_mode&&scheduler.config.limit_drag_out&&(+m<+scheduler._min_date||+n>+scheduler._max_date)){if(+o.start_date<+scheduler._min_date||+o.end_date>+scheduler._max_date)m=new Date(o.start_date),n=new Date(o.end_date);else{
var p=n-m;+m<+scheduler._min_date?(m=new Date(scheduler._min_date),t._ignores&&this.config.preserve_length&&this._table_view?(m=new Date(scheduler._correct_drag_start_date(m)),l._start_correction&&(m=new Date(m.valueOf()+l._start_correction)),n=new Date(1*m+this._get_fictional_event_length(m,this._drag_event._event_length,l))):n=new Date(+m+p)):(n=new Date(scheduler._max_date),t._ignores&&this.config.preserve_length&&this._table_view?(l._end_correction&&(n=new Date(n.valueOf()-l._end_correction)),n=new Date(1*n-this._get_fictional_event_length(n,0,l,!0)),m=new Date(1*n-this._get_fictional_event_length(n,this._drag_event._event_length,l,!0)),this._ignores_detected&&(m=scheduler.date.add(m,l.x_step,l.x_unit),n=new Date(1*n-this._get_fictional_event_length(n,0,l,!0)),n=scheduler.date.add(n,l.x_step,l.x_unit))):m=new Date(+n-p))}var f=new Date(n-1)}if(!this._table_view&&!scheduler.config.all_timed&&(!scheduler._get_section_view()&&t.x!=this._get_event_sday({start_date:new Date(n),end_date:new Date(n)})||new Date(n).getHours()>=this.config.last_hour)){var p=n-m,h=this._min_date.valueOf()+24*t.x*60*6e4;n=scheduler.date.date_part(new Date(h)),n.setHours(this.config.last_hour),f=new Date(n-1),"move"==this._drag_mode&&(m=new Date(+n-p))}if(this._table_view||f.getDate()==m.getDate()&&f.getHours()<this.config.last_hour||scheduler._allow_dnd)if(o.start_date=m,o.end_date=new Date(n),this.config.update_render){var g=scheduler._els.dhx_cal_data[0].scrollTop;this.update_view(),scheduler._els.dhx_cal_data[0].scrollTop=g}else this.updateEvent(this._drag_id);this._table_view&&this.for_rendered(this._drag_id,function(e){e.className+=" dhx_in_move"}),this.callEvent("onEventDrag",[this._drag_id,this._drag_mode,e])}}else if(scheduler.checkEvent("onMouseMove")){var v=this._locate_event(e.target||e.srcElement);this.callEvent("onMouseMove",[v,e])}},scheduler._on_mouse_down=function(e,t){if(2!=e.button&&!this.config.readonly&&!this._drag_mode){t=t||e.target||e.srcElement;var i=scheduler._getClassName(t).split(" ")[0];switch(i){case"dhx_cal_event_line":case"dhx_cal_event_clear":this._table_view&&(this._drag_mode="move");break;case"dhx_event_move":case"dhx_wa_ev_body":this._drag_mode="move";break;case"dhx_event_resize":this._drag_mode="resize";var n=scheduler._getClassName(t);n.indexOf("dhx_event_resize_end")<0?scheduler._drag_from_start=!0:scheduler._drag_from_start=!1;break;case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_matrix_cell":case"dhx_marked_timespan":this._drag_mode="create";break;case"":if(t.parentNode)return scheduler._on_mouse_down(e,t.parentNode);break;default:if((!scheduler.checkEvent("onMouseDown")||scheduler.callEvent("onMouseDown",[i]))&&t.parentNode&&t!=this&&"dhx_body"!=i)return scheduler._on_mouse_down(e,t.parentNode);this._drag_mode=null,this._drag_id=null}if(this._drag_mode){var a=this._locate_event(t);if(this.config["drag_"+this._drag_mode]&&this.callEvent("onBeforeDrag",[a,this._drag_mode,e])){if(this._drag_id=a,(this._edit_id!=this._drag_id||this._edit_id&&"create"==this._drag_mode)&&this._close_not_saved(),!this._drag_mode)return;this._drag_event=scheduler._lame_clone(this.getEvent(this._drag_id)||{}),this._drag_pos=this._mouse_coords(e)}else this._drag_mode=this._drag_id=0}this._drag_start=null}},scheduler._get_private_properties=function(e){var t={};for(var i in e)0===i.indexOf("_")&&(t[i]=!0);return t},scheduler._clear_temporary_properties=function(e,t){var i=this._get_private_properties(e),n=this._get_private_properties(t);for(var a in n)i[a]||delete t[a]},scheduler._on_mouse_up=function(e){if(!e||2!=e.button||!scheduler.config.touch){if(this._drag_mode&&this._drag_id){this._els.dhx_cal_data[0].style.cursor="default";var t=this._drag_id,i=this._drag_mode,n=!this._drag_pos||this._drag_pos.has_moved,a=this.getEvent(this._drag_id);if(n&&(this._drag_event._dhx_changed||!this._drag_event.start_date||a.start_date.valueOf()!=this._drag_event.start_date.valueOf()||a.end_date.valueOf()!=this._drag_event.end_date.valueOf())){var r="new-size"==this._drag_mode;if(this.callEvent("onBeforeEventChanged",[a,e,r,this._drag_event]))if(this._drag_id=this._drag_mode=null,r&&this.config.edit_on_create){if(this.unselect(),this._new_event=new Date,this._table_view||this.config.details_on_create||!this.config.select||!this.isOneDayEvent(this.getEvent(t)))return scheduler.callEvent("onDragEnd",[t,i,e]),this.showLightbox(t);this._drag_pos=!0,this._select_id=this._edit_id=t}else this._new_event||this.callEvent(r?"onEventAdded":"onEventChanged",[t,this.getEvent(t)]);else r?this.deleteEvent(a.id,!0):(this._drag_event._dhx_changed=!1,this._clear_temporary_properties(a,this._drag_event),scheduler._lame_copy(a,this._drag_event),this.updateEvent(a.id))}this._drag_pos&&(this._drag_pos.has_moved||this._drag_pos===!0)&&(this._drag_id=this._drag_mode=null,this.render_view_data()),scheduler.callEvent("onDragEnd",[t,i,e])}this._drag_id=null,this._drag_mode=null,this._drag_pos=null}},scheduler._trigger_dyn_loading=function(){return this._load_mode&&this._load()?(this._render_wait=!0,!0):!1},scheduler.update_view=function(){this._reset_ignores();var e=this[this._mode+"_view"];return e?e(!0):this._reset_scale(),this._trigger_dyn_loading()?!0:void this.render_view_data()},scheduler.isViewExists=function(e){return!!(scheduler[e+"_view"]||scheduler.date[e+"_start"]&&scheduler.templates[e+"_date"]&&scheduler.templates[e+"_scale_date"])},scheduler._set_aria_buttons_attrs=function(){for(var e=["dhx_cal_next_button","dhx_cal_prev_button","dhx_cal_tab","dhx_cal_today_button"],t=0;t<e.length;t++)for(var i=this._els[e[t]],n=0;i&&n<i.length;n++){var a=i[n].getAttribute("name"),r=this.locale.labels[e[t]];a&&(r=this.locale.labels[a]||r),"dhx_cal_next_button"==e[t]?r=this.locale.labels.next:"dhx_cal_prev_button"==e[t]&&(r=this.locale.labels.prev),this._waiAria.headerButtonsAttributes(i[n],r||"")}},scheduler.updateView=function(e,t){e=e||this._date,t=t||this._mode;var i="dhx_cal_data",n=this._obj,a="dhx_scheduler_"+this._mode,r="dhx_scheduler_"+t;this._mode&&-1!=n.className.indexOf(a)?n.className=n.className.replace(a,r):n.className+=" "+r;var s,l="dhx_multi_day",o=this._mode==t&&this.config.preserve_scroll?this._els[i][0].scrollTop:!1;this._els[l]&&this._els[l][0]&&(s=this._els[l][0].scrollTop),this[this._mode+"_view"]&&t&&this._mode!=t&&this[this._mode+"_view"](!1),this._close_not_saved(),this._els[l]&&(this._els[l][0].parentNode.removeChild(this._els[l][0]),this._els[l]=null),this._mode=t,this._date=e,this._table_view="month"==this._mode,this._dy_shift=0,this._set_aria_buttons_attrs();var d=this._els.dhx_cal_tab;if(d)for(var h=0;h<d.length;h++){var _=d[h],c=_.className;c=c.replace(/ active/g,""),_.getAttribute("name")==this._mode+"_tab"?(c+=" active",this._waiAria.headerToggleState(_,!0)):this._waiAria.headerToggleState(_,!1),_.className=c}this.update_view(),"number"==typeof o&&(this._els[i][0].scrollTop=o),"number"==typeof s&&this._els[l]&&this._els[l][0]&&(this._els[l][0].scrollTop=s)},scheduler.setCurrentView=function(e,t){this.callEvent("onBeforeViewChange",[this._mode,this._date,t||this._mode,e||this._date])&&(this.updateView(e,t),this.callEvent("onViewChange",[this._mode,this._date]))},scheduler._render_x_header=function(e,t,i,n,a){a=a||0;var r=document.createElement("DIV");r.className="dhx_scale_bar",this.templates[this._mode+"_scalex_class"]&&(r.className+=" "+this.templates[this._mode+"_scalex_class"](i));var s=this._cols[e]-1;"month"==this._mode&&0===e&&this.config.left_border&&(r.className+=" dhx_scale_bar_border",t+=1),this.set_xy(r,s,this.xy.scale_height-2,t,a);var l=this.templates[this._mode+"_scale_date"](i,this._mode);r.innerHTML=l,this._waiAria.dayHeaderAttr(r,l),n.appendChild(r)},scheduler._get_columns_num=function(e,t){var i=7;if(!scheduler._table_view){var n=scheduler.date["get_"+scheduler._mode+"_end"];n&&(t=n(e)),i=Math.round((t.valueOf()-e.valueOf())/864e5)}return i},scheduler._get_timeunit_start=function(){return this.date[this._mode+"_start"](new Date(this._date.valueOf()))},scheduler._get_view_end=function(){var e=this._get_timeunit_start(),t=scheduler.date.add(e,1,this._mode);if(!scheduler._table_view){var i=scheduler.date["get_"+scheduler._mode+"_end"];i&&(t=i(e))}return t},scheduler._calc_scale_sizes=function(e,t,i){var n=e,a=this._get_columns_num(t,i);this._process_ignores(t,a,"day",1);for(var r=a-this._ignores_detected,s=0;a>s;s++)this._ignores[s]?(this._cols[s]=0,r++):this._cols[s]=Math.floor(n/(r-s)),n-=this._cols[s],this._colsS[s]=(this._cols[s-1]||0)+(this._colsS[s-1]||(this._table_view?0:this.xy.scale_width+2));this._colsS.col_length=a,this._colsS[a]=this._cols[a-1]+this._colsS[a-1]||0},scheduler._set_scale_col_size=function(e,t,i){var n=this.config;this.set_xy(e,t-1,n.hour_size_px*(n.last_hour-n.first_hour),i+this.xy.scale_width+1,0)},scheduler._render_scales=function(e,t){var i=new Date(scheduler._min_date),n=new Date(scheduler._max_date),a=this.date.date_part(scheduler._currentDate()),r=parseInt(e.style.width,10),s=new Date(this._min_date),l=this._get_columns_num(i,n);this._calc_scale_sizes(r,i,n);var o=0;e.innerHTML="";for(var d=0;l>d;d++){if(this._ignores[d]||this._render_x_header(d,o,s,e),!this._table_view){var h=document.createElement("DIV"),_="dhx_scale_holder";s.valueOf()==a.valueOf()&&(_="dhx_scale_holder_now"),this._ignores_detected&&this._ignores[d]&&(_+=" dhx_scale_ignore"),h.className=_+" "+this.templates.week_date_class(s,a),this._waiAria.dayColumnAttr(h,s),this._set_scale_col_size(h,this._cols[d],o),t.appendChild(h),this.callEvent("onScaleAdd",[h,s])}o+=this._cols[d],s=this.date.add(s,1,"day"),s=this.date.day_start(s)}},scheduler._reset_scale=function(){if(this.templates[this._mode+"_date"]){var e=this._els.dhx_cal_header[0],t=this._els.dhx_cal_data[0],i=this.config;e.innerHTML="",t.innerHTML="";var n=(i.readonly||!i.drag_resize?" dhx_resize_denied":"")+(i.readonly||!i.drag_move?" dhx_move_denied":"");t.className="dhx_cal_data"+n,this._scales={},this._cols=[],this._colsS={height:0},this._dy_shift=0,this.set_sizes();var a,r,s=this._get_timeunit_start(),l=scheduler._get_view_end();a=r=this._table_view?scheduler.date.week_start(s):s,this._min_date=a;var o=this.templates[this._mode+"_date"](s,l,this._mode);if(this._els.dhx_cal_date[0].innerHTML=o,this._waiAria.navBarDateAttr(this._els.dhx_cal_date[0],o),this._max_date=l,scheduler._render_scales(e,t),this._table_view)this._reset_month_scale(t,s,r);else if(this._reset_hours_scale(t,s,r),i.multi_day){var d="dhx_multi_day";this._els[d]&&(this._els[d][0].parentNode.removeChild(this._els[d][0]),this._els[d]=null);var h=this._els.dhx_cal_navline[0],_=h.offsetHeight+this._els.dhx_cal_header[0].offsetHeight+1,c=document.createElement("DIV");c.className=d,c.style.visibility="hidden",this.set_xy(c,Math.max(this._colsS[this._colsS.col_length]+this.xy.scroll_width-2,0),0,0,_),t.parentNode.insertBefore(c,t);var u=c.cloneNode(!0);u.className=d+"_icon",u.style.visibility="hidden",this.set_xy(u,this.xy.scale_width,0,0,_),c.appendChild(u),this._els[d]=[c,u],this._els[d][0].onclick=this._click.dhx_cal_data}}},scheduler._reset_hours_scale=function(e,t,i){var n=document.createElement("DIV");n.className="dhx_scale_holder";for(var a=new Date(1980,1,1,this.config.first_hour,0,0),r=1*this.config.first_hour;r<this.config.last_hour;r++){var s=document.createElement("DIV");s.className="dhx_scale_hour",s.style.height=this.config.hour_size_px+"px";var l=this.xy.scale_width;this.config.left_border&&(s.className+=" dhx_scale_hour_border"),s.style.width=l+"px";var o=scheduler.templates.hour_scale(a);s.innerHTML=o,this._waiAria.hourScaleAttr(s,o),n.appendChild(s),a=this.date.add(a,1,"hour")}e.appendChild(n),this.config.scroll_hour&&(e.scrollTop=this.config.hour_size_px*(this.config.scroll_hour-this.config.first_hour))},scheduler._currentDate=function(){return scheduler.config.now_date?new Date(scheduler.config.now_date):new Date},scheduler._reset_ignores=function(){this._ignores={},this._ignores_detected=0},scheduler._process_ignores=function(e,t,i,n,a){this._reset_ignores();var r=scheduler["ignore_"+this._mode];if(r)for(var s=new Date(e),l=0;t>l;l++)r(s)&&(this._ignores_detected+=1,this._ignores[l]=!0,a&&t++),s=scheduler.date.add(s,n,i),scheduler.date[i+"_start"]&&(s=scheduler.date[i+"_start"](s))},scheduler._render_month_scale=function(e,t,i,n){function a(e){var t=scheduler._colsS.height;return void 0!==scheduler._colsS.heights[e+1]&&(t=scheduler._colsS.heights[e+1]-(scheduler._colsS.heights[e]||0)),t}var r=scheduler.date.add(t,1,"month"),s=new Date(i),l=scheduler._currentDate();this.date.date_part(l),this.date.date_part(i),n=n||Math.ceil(Math.round((r.valueOf()-i.valueOf())/864e5)/7);for(var o=[],d=0;7>=d;d++){var h=(this._cols[d]||0)-1;0===d&&this.config.left_border&&(h-=1),o[d]=h+"px"}var _=0,c=document.createElement("table");c.setAttribute("cellpadding","0"),c.setAttribute("cellspacing","0");var u=document.createElement("tbody");c.appendChild(u);for(var f=[],d=0;n>d;d++){var m=document.createElement("tr");u.appendChild(m);for(var p=Math.max(a(d)-scheduler.xy.month_head_height,0),g=0;7>g;g++){var v=document.createElement("td");m.appendChild(v);var x="";t>i?x="dhx_before":i>=r?x="dhx_after":i.valueOf()==l.valueOf()&&(x="dhx_now"),this._ignores_detected&&this._ignores[g]&&(x+=" dhx_scale_ignore"),v.className=x+" "+this.templates.month_date_class(i,l);var y="dhx_month_body",b="dhx_month_head";if(0===g&&this.config.left_border&&(y+=" dhx_month_body_border",b+=" dhx_month_head_border"),this._ignores_detected&&this._ignores[g])v.appendChild(document.createElement("div")),v.appendChild(document.createElement("div"));else{this._waiAria.monthCellAttr(v,i);var w=document.createElement("DIV");w.className=b,w.innerHTML=this.templates.month_day(i),v.appendChild(w);var D=document.createElement("DIV");D.className=y,D.style.height=p+"px",D.style.width=o[g],v.appendChild(D)}f.push(i);var P=i.getDate();i=this.date.add(i,1,"day"),i.getDate()-P>1&&(i=new Date(i.getFullYear(),i.getMonth(),P+1,12,0))}scheduler._colsS.heights[d]=_,_+=a(d)}this._min_date=s,this._max_date=i,e.innerHTML="",e.appendChild(c),this._scales={};for(var E=e.getElementsByTagName("div"),d=0;d<f.length;d++){var e=E[2*d+1],k=f[d];this._scales[+k]=e}for(var d=0;d<f.length;d++){var k=f[d];this.callEvent("onScaleAdd",[this._scales[+k],k])}return this._max_date},scheduler._reset_month_scale=function(e,t,i,n){var a=scheduler.date.add(t,1,"month"),r=scheduler._currentDate();this.date.date_part(r),this.date.date_part(i),n=n||Math.ceil(Math.round((a.valueOf()-i.valueOf())/864e5)/7);var s=Math.floor(e.clientHeight/n)-this.xy.month_head_height;return this._colsS.height=s+this.xy.month_head_height,this._colsS.heights=[],scheduler._render_month_scale(e,t,i,n)},scheduler.getLabel=function(e,t){for(var i=this.config.lightbox.sections,n=0;n<i.length;n++)if(i[n].map_to==e)for(var a=i[n].options,r=0;r<a.length;r++)if(a[r].key==t)return a[r].label;return""},scheduler.updateCollection=function(e,t){var i=scheduler.serverList(e);return i?(i.splice(0,i.length),i.push.apply(i,t||[]),scheduler.callEvent("onOptionsLoad",[]),scheduler.resetLightbox(),!0):!1},scheduler._lame_clone=function(e,t){var i,n,a;for(t=t||[],i=0;i<t.length;i+=2)if(e===t[i])return t[i+1];if(e&&"object"==typeof e){for(a={},n=[Array,Date,Number,String,Boolean],i=0;i<n.length;i++)e instanceof n[i]&&(a=i?new n[i](e):new n[i]);t.push(e,a);for(i in e)Object.prototype.hasOwnProperty.apply(e,[i])&&(a[i]=scheduler._lame_clone(e[i],t))}return a||e},scheduler._lame_copy=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},scheduler._get_date_from_pos=function(e){var t=this._min_date.valueOf()+6e4*(e.y*this.config.time_step+24*(this._table_view?0:e.x)*60);return new Date(this._correct_shift(t))},scheduler.getActionData=function(e){var t=this._mouse_coords(e);return{date:this._get_date_from_pos(t),section:t.section}},scheduler._focus=function(e,t){if(e&&e.focus)if(this.config.touch)window.setTimeout(function(){e.focus()},10);else try{t&&e.select&&e.offsetWidth&&e.select(),e.focus()}catch(i){}},scheduler._get_real_event_length=function(e,t,i){var n,a=t-e,r=i._start_correction+i._end_correction||0,s=this["ignore_"+this._mode],l=0;i.render?(l=this._get_date_index(i,e),n=this._get_date_index(i,t)):n=Math.round(a/60/60/1e3/24);for(var o=!0;n>l;){var d=scheduler.date.add(t,-i.x_step,i.x_unit);s&&s(t)&&(!o||o&&s(d))?a-=t-d:(o=!1,a-=r),t=d,n--}return a},scheduler._get_fictional_event_length=function(e,t,i,n){var a=new Date(e),r=n?-1:1;if(i._start_correction||i._end_correction){var s;s=n?60*a.getHours()+a.getMinutes()-60*(i.first_hour||0):60*(i.last_hour||0)-(60*a.getHours()+a.getMinutes());var l=60*(i.last_hour-i.first_hour),o=Math.ceil((t/6e4-s)/l);0>o&&(o=0),t+=o*(1440-l)*60*1e3}var d,h=new Date(1*e+t*r),_=this["ignore_"+this._mode],c=0;for(i.render?(c=this._get_date_index(i,a),d=this._get_date_index(i,h)):d=Math.round(t/60/60/1e3/24);d*r>=c*r;){var u=scheduler.date.add(a,i.x_step*r,i.x_unit);_&&_(a)&&(t+=(u-a)*r,d+=r),a=u,c+=r}return t},scheduler._get_section_view=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode]:this._props&&this._props[this._mode]?this._props[this._mode]:null},scheduler._get_section_property=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode].y_property:this._props&&this._props[this._mode]?this._props[this._mode].map_to:null},scheduler._is_initialized=function(){var e=this.getState();return this._obj&&e.date&&e.mode},scheduler._is_lightbox_open=function(){var e=this.getState();return null!==e.lightbox_id&&void 0!==e.lightbox_id},scheduler._getClassName=function(e){if(!e)return"";var t=e.className||"";return t.baseVal&&(t=t.baseVal),t.indexOf||(t=""),t||""},scheduler.event=window.dhtmlxEvent,scheduler.eventRemove=function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)},function(){function e(e){var t=!1,i=!1;if(window.getComputedStyle){var n=window.getComputedStyle(e,null);t=n.display,i=n.visibility}else e.currentStyle&&(t=e.currentStyle.display,i=e.currentStyle.visibility);var a=!1,r=scheduler._locate_css({target:e},"dhx_form_repeat",!1);return r&&(a=!("0px"!=r.style.height)),a=a||!e.offsetHeight,"none"!=t&&"hidden"!=i&&!a}function t(e){return!isNaN(e.getAttribute("tabindex"))&&1*e.getAttribute("tabindex")>=0}function i(e){var t={a:!0,area:!0};return t[e.nodeName.loLowerCase()]?!!e.getAttribute("href"):!0}function n(e){var t={input:!0,select:!0,textarea:!0,button:!0,object:!0};return t[e.nodeName.toLowerCase()]?!e.hasAttribute("disabled"):!0}scheduler._getFocusableNodes=function(a){for(var r=a.querySelectorAll(["a[href]","area[href]","input","select","textarea","button","iframe","object","embed","[tabindex]","[contenteditable]"].join(", ")),s=Array.prototype.slice.call(r,0),l=0;l<s.length;l++){var o=s[l],d=(t(o)||n(o)||i(o))&&e(o);d||(s.splice(l,1),l--)}return s}}(),scheduler._trim=function(e){var t=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};return t.apply(e)},function(){function e(e){return(e+"").replace(n," ").replace(a," ")}function t(e){return(e+"").replace(r,"&#39;")}function i(){return!scheduler.config.wai_aria_attributes}var n=new RegExp("<(?:.|\n)*?>","gm"),a=new RegExp(" +","gm"),r=new RegExp("'","gm");scheduler._waiAria={getAttributeString:function(i){var n=[" "];for(var a in i)if("function"!=typeof i[a]&&"object"!=typeof i[a]){var r=t(e(i[a]));n.push(a+"='"+r+"'")}return n.push(" "),n.join(" ")},setAttributes:function(t,i){for(var n in i)t.setAttribute(n,e(i[n]));return t},labelAttr:function(e,t){return this.setAttributes(e,{"aria-label":t})},label:function(e){return scheduler._waiAria.getAttributeString({"aria-label":e})},hourScaleAttr:function(e,t){this.labelAttr(e,t)},monthCellAttr:function(e,t){this.labelAttr(e,scheduler.templates.day_date(t))},navBarDateAttr:function(e,t){this.labelAttr(e,t)},dayHeaderAttr:function(e,t){this.labelAttr(e,t)},dayColumnAttr:function(e,t){this.dayHeaderAttr(e,scheduler.templates.day_date(t))},headerButtonsAttributes:function(e,t){return this.setAttributes(e,{role:"button","aria-label":t})},headerToggleState:function(e,t){return this.setAttributes(e,{"aria-pressed":t?"true":"false"})},getHeaderCellAttr:function(e){return scheduler._waiAria.getAttributeString({"aria-label":e})},eventAttr:function(e,t){!scheduler.config.readonly&&scheduler.config.drag_move&&(e.id!=scheduler.getState().drag_id?t.setAttribute("aria-grabbed",!1):t.setAttribute("aria-grabbed",!0)),this._eventCommonAttr(e,t)},_eventCommonAttr:function(t,i){i.setAttribute("aria-label",e(scheduler.templates.tooltip_text(t.start_date,t.end_date,t))),scheduler.config.readonly&&i.setAttribute("aria-readonly",!0),t.$dataprocessor_class&&i.setAttribute("aria-busy",!0),i.setAttribute("aria-selected",scheduler.getState().select_id==t.id?"true":"false")},setEventBarAttr:function(e,t){this._eventCommonAttr(e,t),!scheduler.config.readonly&&scheduler.config.drag_move&&(e.id!=scheduler.getState().drag_id?t.setAttribute("aria-grabbed",!1):t.setAttribute("aria-grabbed",!0))},_getAttributes:function(e,t){var i={setAttribute:function(e,t){this[e]=t}};return e.apply(this,[t,i]),i},eventBarAttrString:function(e){return this.getAttributeString(this._getAttributes(this.setEventBarAttr,e))},agendaHeadAttrString:function(){return this.getAttributeString({role:"row"})},agendaHeadDateString:function(e){return this.getAttributeString({role:"columnheader","aria-label":e})},agendaHeadDescriptionString:function(e){return this.agendaHeadDateString(e)},agendaDataAttrString:function(){return this.getAttributeString({role:"grid"})},agendaEventAttrString:function(e){var t=this._getAttributes(this._eventCommonAttr,e);return t.role="row",this.getAttributeString(t)},agendaDetailsBtnString:function(){return this.getAttributeString({role:"button","aria-label":scheduler.locale.labels.icon_details})},gridAttrString:function(){return this.getAttributeString({role:"grid"})},gridRowAttrString:function(e){return this.agendaEventAttrString(e)},gridCellAttrString:function(e,t,i){return this.getAttributeString({role:"gridcell","aria-label":[void 0===t.label?t.id:t.label,": ",i]})},mapAttrString:function(){return this.gridAttrString()},mapRowAttrString:function(e){return this.gridRowAttrString(e)},mapDetailsBtnString:function(){return this.agendaDetailsBtnString()},minicalHeader:function(e,t){this.setAttributes(e,{id:t+"","aria-live":"assertice","aria-atomic":"true"})},minicalGrid:function(e,t){this.setAttributes(e,{"aria-labelledby":t+"",role:"grid"})},minicalRow:function(e){this.setAttributes(e,{role:"row"})},minicalDayCell:function(e,t){var i=t.valueOf()<scheduler._max_date.valueOf()&&t.valueOf()>=scheduler._min_date.valueOf();this.setAttributes(e,{role:"gridcell","aria-label":scheduler.templates.day_date(t),"aria-selected":i?"true":"false"})},minicalHeadCell:function(e){this.setAttributes(e,{role:"columnheader"})},weekAgendaDayCell:function(e,t){var i=e.querySelector(".dhx_wa_scale_bar"),n=e.querySelector(".dhx_wa_day_data"),a=scheduler.uid()+"";this.setAttributes(i,{id:a}),this.setAttributes(n,{"aria-labelledby":a})},weekAgendaEvent:function(e,t){this.eventAttr(t,e)},lightboxHiddenAttr:function(e){e.setAttribute("aria-hidden","true")},lightboxVisibleAttr:function(e){e.setAttribute("aria-hidden","false")},lightboxSectionButtonAttrString:function(e){return this.getAttributeString({role:"button","aria-label":e,tabindex:"0"})},yearHeader:function(e,t){this.setAttributes(e,{id:t+""})},yearGrid:function(e,t){this.minicalGrid(e,t)},yearHeadCell:function(e){return this.minicalHeadCell(e)},yearRow:function(e){return this.minicalRow(e)},yearDayCell:function(e){this.setAttributes(e,{role:"gridcell"})},lightboxAttr:function(e){e.setAttribute("role","dialog"),e.setAttribute("aria-hidden","true"),e.firstChild.setAttribute("role","heading")},lightboxButtonAttrString:function(e){return this.getAttributeString({role:"button","aria-label":scheduler.locale.labels[e],tabindex:"0"})},eventMenuAttrString:function(e){return this.getAttributeString({role:"button","aria-label":scheduler.locale.labels[e]})},lightboxHeader:function(e,t){e.setAttribute("aria-label",t)},lightboxSelectAttrString:function(e){var t="";switch(e){case"%Y":t=scheduler.locale.labels.year;break;case"%m":t=scheduler.locale.labels.month;break;case"%d":t=scheduler.locale.labels.day;break;case"%H:%i":t=scheduler.locale.labels.hour+" "+scheduler.locale.labels.minute}return scheduler._waiAria.getAttributeString({"aria-label":t})},messageButtonAttrString:function(e){return"tabindex='0' role='button' aria-label='"+e+"'"},messageInfoAttr:function(e){e.setAttribute("role","alert")},messageModalAttr:function(e,t){e.setAttribute("role","dialog"),t&&e.setAttribute("aria-labelledby",t)},quickInfoAttr:function(e){e.setAttribute("role","dialog")},quickInfoHeaderAttrString:function(){return" role='heading' "},quickInfoHeader:function(e,t){e.setAttribute("aria-label",t)},quickInfoButtonAttrString:function(e){return scheduler._waiAria.getAttributeString({role:"button","aria-label":e,tabindex:"0"})},tooltipAttr:function(e){e.setAttribute("role","tooltip")},tooltipVisibleAttr:function(e){e.setAttribute("aria-hidden","false")},tooltipHiddenAttr:function(e){e.setAttribute("aria-hidden","true")}};for(var s in scheduler._waiAria)scheduler._waiAria[s]=function(e){return function(){return i()?" ":e.apply(this,arguments)}}(scheduler._waiAria[s])}(),scheduler.date={init:function(){for(var e=scheduler.locale.date.month_short,t=scheduler.locale.date.month_short_hash={},i=0;i<e.length;i++)t[e[i]]=i;for(var e=scheduler.locale.date.month_full,t=scheduler.locale.date.month_full_hash={},i=0;i<e.length;i++)t[e[i]]=i},_bind_host_object:function(e){return e.bind?e.bind(scheduler):function(){return e.apply(scheduler,arguments)}},date_part:function(e){var t=new Date(e);return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.getHours()&&(e.getDate()<t.getDate()||e.getMonth()<t.getMonth()||e.getFullYear()<t.getFullYear())&&e.setTime(e.getTime()+36e5*(24-e.getHours())),e},time_part:function(e){return(e.valueOf()/1e3-60*e.getTimezoneOffset())%86400},week_start:function(e){var t=e.getDay();return scheduler.config.start_on_monday&&(0===t?t=6:t--),this.date_part(this.add(e,-1*t,"day"))},month_start:function(e){return e.setDate(1),this.date_part(e)},year_start:function(e){return e.setMonth(0),this.month_start(e)},day_start:function(e){return this.date_part(e)},_add_days:function(e,t){var i=new Date(e.valueOf());if(i.setDate(i.getDate()+t),t==Math.round(t)&&t>0){var n=+i-+e,a=n%864e5;if(a&&e.getTimezoneOffset()==i.getTimezoneOffset()){var r=a/36e5;i.setTime(i.getTime()+60*(24-r)*60*1e3)}}return t>=0&&!e.getHours()&&i.getHours()&&(i.getDate()<e.getDate()||i.getMonth()<e.getMonth()||i.getFullYear()<e.getFullYear())&&i.setTime(i.getTime()+36e5*(24-i.getHours())),i},add:function(e,t,i){var n=new Date(e.valueOf());switch(i){case"day":n=scheduler.date._add_days(n,t);break;case"week":n=scheduler.date._add_days(n,7*t);break;case"month":n.setMonth(n.getMonth()+t);break;case"year":n.setYear(n.getFullYear()+t);break;case"hour":n.setTime(n.getTime()+60*t*60*1e3);break;case"minute":n.setTime(n.getTime()+60*t*1e3);break;default:return scheduler.date["add_"+i](e,t,i)}return n},to_fixed:function(e){return 10>e?"0"+e:e},copy:function(e){return new Date(e.valueOf())},date_to_str:function(e,t){e=e.replace(/%[a-zA-Z]/g,function(e){switch(e){case"%d":return'"+this.date.to_fixed(date.getDate())+"';case"%m":return'"+this.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+this.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+this.locale.date.day_short[date.getDay()]+"';case"%l":return'"+this.locale.date.day_full[date.getDay()]+"';case"%M":return'"+this.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+this.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+this.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+this.date.to_fixed(date.getHours())+"';case"%i":return'"+this.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+this.date.to_fixed(date.getSeconds())+"';case"%W":return'"+this.date.to_fixed(this.date.getISOWeek(date))+"';default:return e}}),t&&(e=e.replace(/date\.get/g,"date.getUTC"));var i=new Function("date",'return "'+e+'";');return scheduler.date._bind_host_object(i)},str_to_date:function(e,t){for(var i="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",n=e.match(/%[a-zA-Z]/g),a=0;a<n.length;a++)switch(n[a]){case"%j":case"%d":i+="set[2]=temp["+a+"]||1;";break;case"%n":case"%m":i+="set[1]=(temp["+a+"]||1)-1;";break;case"%y":i+="set[0]=temp["+a+"]*1+(temp["+a+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":i+="set[3]=temp["+a+"]||0;";break;case"%i":i+="set[4]=temp["+a+"]||0;";break;case"%Y":i+="set[0]=temp["+a+"]||0;";break;case"%a":case"%A":i+="set[3]=set[3]%12+((temp["+a+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":i+="set[5]=temp["+a+"]||0;";break;case"%M":i+="set[1]=this.locale.date.month_short_hash[temp["+a+"]]||0;";break;case"%F":i+="set[1]=this.locale.date.month_full_hash[temp["+a+"]]||0;"}var r="set[0],set[1],set[2],set[3],set[4],set[5]";t&&(r=" Date.UTC("+r+")");var s=new Function("date","var set=[0,0,1,0,0,0]; "+i+" return new Date("+r+");");return scheduler.date._bind_host_object(s)},getISOWeek:function(e){if(!e)return!1;e=this.date_part(new Date(e));var t=e.getDay();0===t&&(t=7);var i=new Date(e.valueOf());i.setDate(e.getDate()+(4-t));var n=i.getFullYear(),a=Math.round((i.getTime()-new Date(n,0,1).getTime())/864e5),r=1+Math.floor(a/7);return r},getUTCISOWeek:function(e){return this.getISOWeek(this.convert_to_utc(e))},convert_to_utc:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}},scheduler.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{dhx_cal_today_button:"Today",day_tab:"Day",week_tab:"Week",month_tab:"Month",new_event:"New event",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Event will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",full_day:"Full day",confirm_recurring:"Do you want to edit the whole set of repeated events?",section_recurring:"Repeat event",button_recurring:"Disabled",button_recurring_open:"Enabled",button_edit_series:"Edit series",button_edit_occurrence:"Edit occurrence",agenda_tab:"Agenda",date:"Date",description:"Description",year_tab:"Year",week_agenda_tab:"Agenda",grid_tab:"Grid",drag_to_create:"Drag to create",drag_to_move:"Drag to move",message_ok:"OK",message_cancel:"Cancel",next:"Next",prev:"Previous",year:"Year",month:"Month",day:"Day",hour:"Hour",minute:"Minute"}},scheduler.config={default_date:"%j %M %Y",month_date:"%F %Y",load_date:"%Y-%m-%d",week_date:"%l",day_date:"%D, %F %j",hour_date:"%H:%i",month_day:"%d",xml_date:"%m/%d/%Y %H:%i",api_date:"%d-%m-%Y %H:%i",preserve_length:!0,time_step:5,start_on_monday:1,first_hour:0,last_hour:24,readonly:!1,drag_resize:1,drag_move:1,drag_create:1,dblclick_create:1,edit_on_create:1,details_on_create:0,resize_month_events:!1,resize_month_timed:!1,cascade_event_display:!1,cascade_event_count:4,cascade_event_margin:30,multi_day:!0,multi_day_height_limit:0,drag_lightbox:!0,preserve_scroll:!0,select:!0,server_utc:!1,touch:!0,touch_tip:!0,touch_drag:500,
quick_info_detached:!0,positive_closing:!1,drag_highlight:!0,limit_drag_out:!1,icons_edit:["icon_save","icon_cancel"],icons_select:["icon_details","icon_edit","icon_delete"],buttons_left:["dhx_save_btn","dhx_cancel_btn"],buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"description",height:200,map_to:"text",type:"textarea",focus:!0},{name:"time",height:72,type:"time",map_to:"auto"}]},highlight_displayed_event:!0,left_border:!1,ajax_error:"alert",delay_render:0,timeline_swap_resize:!0,wai_aria_attributes:!0,wai_aria_application_role:!0},scheduler.templates={},scheduler.init_templates=function(){var e=scheduler.locale.labels;e.dhx_save_btn=e.icon_save,e.dhx_cancel_btn=e.icon_cancel,e.dhx_delete_btn=e.icon_delete;var t=scheduler.date.date_to_str,i=scheduler.config,n=function(e,t){for(var i in t)e[i]||(e[i]=t[i])};n(scheduler.templates,{day_date:t(i.default_date),month_date:t(i.month_date),week_date:function(e,t){return scheduler.templates.day_date(e)+" &ndash; "+scheduler.templates.day_date(scheduler.date.add(t,-1,"day"))},day_scale_date:t(i.default_date),month_scale_date:t(i.week_date),week_scale_date:t(i.day_date),hour_scale:t(i.hour_date),time_picker:t(i.hour_date),event_date:t(i.hour_date),month_day:t(i.month_day),xml_date:scheduler.date.str_to_date(i.xml_date,i.server_utc),load_format:t(i.load_date),xml_format:t(i.xml_date,i.server_utc),api_date:scheduler.date.str_to_date(i.api_date),event_header:function(e,t,i){return scheduler.templates.event_date(e)+" - "+scheduler.templates.event_date(t)},event_text:function(e,t,i){return i.text},event_class:function(e,t,i){return""},month_date_class:function(e){return""},week_date_class:function(e){return""},event_bar_date:function(e,t,i){return scheduler.templates.event_date(e)+" "},event_bar_text:function(e,t,i){return i.text},month_events_link:function(e,t){return"<a>View more("+t+" events)</a>"},drag_marker_class:function(e,t,i){return""},drag_marker_content:function(e,t,i){return""}}),this.callEvent("onTemplatesReady",[])},scheduler.templates.tooltip_date_format=scheduler.date.date_to_str("%Y-%m-%d %H:%i"),scheduler.templates.tooltip_text=function(e,t,i){return"<b>Event:</b> "+i.text+"<br/><b>Start date:</b> "+scheduler.templates.tooltip_date_format(e)+"<br/><b>End date:</b> "+scheduler.templates.tooltip_date_format(t)},scheduler.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++},scheduler._events={},scheduler.clearAll=function(){this._events={},this._loaded={},this._edit_id=null,this._select_id=null,this._drag_id=null,this._drag_mode=null,this._drag_pos=null,this.clear_view(),this.callEvent("onClearAll",[])},scheduler.addEvent=function(e,t,i,n,a){if(!arguments.length)return this.addEventNow();var r=e;1!=arguments.length&&(r=a||{},r.start_date=e,r.end_date=t,r.text=i,r.id=n),r.id=r.id||scheduler.uid(),r.text=r.text||"","string"==typeof r.start_date&&(r.start_date=this.templates.api_date(r.start_date)),"string"==typeof r.end_date&&(r.end_date=this.templates.api_date(r.end_date));var s=6e4*(this.config.event_duration||this.config.time_step);r.start_date.valueOf()==r.end_date.valueOf()&&r.end_date.setTime(r.end_date.valueOf()+s),r._timed=this.isOneDayEvent(r);var l=!this._events[r.id];return this._events[r.id]=r,this.event_updated(r),this._loading||this.callEvent(l?"onEventAdded":"onEventChanged",[r.id,r]),r.id},scheduler.deleteEvent=function(e,t){var i=this._events[e];(t||this.callEvent("onBeforeEventDelete",[e,i])&&this.callEvent("onConfirmedBeforeEventDelete",[e,i]))&&(i&&(this._select_id=null,delete this._events[e],this.event_updated(i)),this.callEvent("onEventDeleted",[e,i]))},scheduler.getEvent=function(e){return this._events[e]},scheduler.setEvent=function(e,t){t.id||(t.id=e),this._events[e]=t},scheduler.for_rendered=function(e,t){for(var i=this._rendered.length-1;i>=0;i--)this._rendered[i].getAttribute("event_id")==e&&t(this._rendered[i],i)},scheduler.changeEventId=function(e,t){if(e!=t){var i=this._events[e];i&&(i.id=t,this._events[t]=i,delete this._events[e]),this.for_rendered(e,function(e){e.setAttribute("event_id",t)}),this._select_id==e&&(this._select_id=t),this._edit_id==e&&(this._edit_id=t),this.callEvent("onEventIdChange",[e,t])}},function(){for(var e=["text","Text","start_date","StartDate","end_date","EndDate"],t=function(e){return function(t){return scheduler.getEvent(t)[e]}},i=function(e){return function(t,i){var n=scheduler.getEvent(t);n[e]=i,n._changed=!0,n._timed=this.isOneDayEvent(n),scheduler.event_updated(n,!0)}},n=0;n<e.length;n+=2)scheduler["getEvent"+e[n+1]]=t(e[n]),scheduler["setEvent"+e[n+1]]=i(e[n])}(),scheduler.event_updated=function(e,t){this.is_visible_events(e)?this.render_view_data():this.clear_event(e.id)},scheduler.is_visible_events=function(e){var t=e.start_date.valueOf()<this._max_date.valueOf()&&this._min_date.valueOf()<e.end_date.valueOf();if(t){var i=e.start_date.getHours(),n=e.end_date.getHours()+e.end_date.getMinutes()/60,a=this.config.last_hour,r=this.config.first_hour,s=this._table_view||!((n>a||r>n)&&(i>=a||r>i));if(s)return!0;var l=(e.end_date.valueOf()-e.start_date.valueOf())/36e5,o=24-(this.config.last_hour-this.config.first_hour);return!!(l>o||a>i&&n>=r)}return!1},scheduler.isOneDayEvent=function(e){var t=e.end_date.getDate()-e.start_date.getDate();return t?(0>t&&(t=Math.ceil((e.end_date.valueOf()-e.start_date.valueOf())/864e5)),1==t&&!e.end_date.getHours()&&!e.end_date.getMinutes()&&(e.start_date.getHours()||e.start_date.getMinutes())):e.start_date.getMonth()==e.end_date.getMonth()&&e.start_date.getFullYear()==e.end_date.getFullYear()},scheduler.get_visible_events=function(e){var t=[];for(var i in this._events)this.is_visible_events(this._events[i])&&(!e||this._events[i]._timed)&&this.filter_event(i,this._events[i])&&t.push(this._events[i]);return t},scheduler.filter_event=function(e,t){var i=this["filter_"+this._mode];return i?i(e,t):!0},scheduler._is_main_area_event=function(e){return!!e._timed},scheduler.render_view_data=function(e,t){var i=!1;if(!e){if(i=!0,this._not_render)return void(this._render_wait=!0);this._render_wait=!1,this.clear_view(),e=this.get_visible_events(!(this._table_view||this.config.multi_day))}for(var n=0,a=e.length;a>n;n++)this._recalculate_timed(e[n]);if(this.config.multi_day&&!this._table_view){for(var r=[],s=[],n=0;n<e.length;n++)this._is_main_area_event(e[n])?r.push(e[n]):s.push(e[n]);this._rendered_location=this._els.dhx_multi_day[0],this._table_view=!0,this.render_data(s,t),this._table_view=!1,this._rendered_location=this._els.dhx_cal_data[0],this._table_view=!1,this.render_data(r,t)}else this._rendered_location=this._els.dhx_cal_data[0],this.render_data(e,t);i&&this.callEvent("onDataRender",[])},scheduler._view_month_day=function(e){var t=scheduler.getActionData(e).date;scheduler.callEvent("onViewMoreClick",[t])&&scheduler.setCurrentView(t,"day")},scheduler._render_month_link=function(e){for(var t=this._rendered_location,i=this._lame_clone(e),n=e._sday;n<e._eday;n++){i._sday=n,i._eday=n+1;var a=scheduler.date,r=scheduler._min_date;r=a.add(r,i._sweek,"week"),r=a.add(r,i._sday,"day");var s=scheduler.getEvents(r,a.add(r,1,"day")).length,l=this._get_event_bar_pos(i),o=l.x2-l.x,d=document.createElement("div");d.onclick=function(e){scheduler._view_month_day(e||event)},d.className="dhx_month_link",d.style.top=l.y+"px",d.style.left=l.x+"px",d.style.width=o+"px",d.innerHTML=scheduler.templates.month_events_link(r,s),this._rendered.push(d),t.appendChild(d)}},scheduler._recalculate_timed=function(e){if(e){var t;t="object"!=typeof e?this._events[e]:e,t&&(t._timed=scheduler.isOneDayEvent(t))}},scheduler.attachEvent("onEventChanged",scheduler._recalculate_timed),scheduler.attachEvent("onEventAdded",scheduler._recalculate_timed),scheduler.render_data=function(e,t){e=this._pre_render_events(e,t);for(var i=0;i<e.length;i++)if(this._table_view)if("month"!=scheduler._mode)this.render_event_bar(e[i]);else{var n=scheduler.config.max_month_events;n!==1*n||e[i]._sorder<n?this.render_event_bar(e[i]):void 0!==n&&e[i]._sorder==n&&scheduler._render_month_link(e[i])}else this.render_event(e[i])},scheduler._get_first_visible_cell=function(e){for(var t=0;t<e.length;t++)if(-1==(e[t].className||"").indexOf("dhx_scale_ignore"))return e[t];return e[0]},scheduler._pre_render_events=function(e,t){var i=this.xy.bar_height,n=this._colsS.heights,a=this._colsS.heights=[0,0,0,0,0,0,0],r=this._els.dhx_cal_data[0];if(e=this._table_view?this._pre_render_events_table(e,t):this._pre_render_events_line(e,t),this._table_view)if(t)this._colsS.heights=n;else{var s=r.firstChild;if(s.rows){for(var l=0;l<s.rows.length;l++){a[l]++;var o=s.rows[l].cells,d=this._colsS.height-this.xy.month_head_height;if(a[l]*i>d){var h=d;1*this.config.max_month_events!==this.config.max_month_events||a[l]<=this.config.max_month_events?h=a[l]*i:(this.config.max_month_events+1)*i>d&&(h=(this.config.max_month_events+1)*i);for(var _=0;_<o.length;_++)o[_].childNodes[1].style.height=h+"px"}a[l]=(a[l-1]||0)+scheduler._get_first_visible_cell(o).offsetHeight}if(a.unshift(0),s.parentNode.offsetHeight<s.parentNode.scrollHeight&&!scheduler._colsS.scroll_fix&&scheduler.xy.scroll_width){var c=scheduler._colsS,u=c[c.col_length],f=c.heights.slice();u-=scheduler.xy.scroll_width||0,this._calc_scale_sizes(u,this._min_date,this._max_date),scheduler._colsS.heights=f,this.set_xy(this._els.dhx_cal_header[0],u,this.xy.scale_height),scheduler._render_scales(this._els.dhx_cal_header[0]),scheduler._render_month_scale(this._els.dhx_cal_data[0],this._get_timeunit_start(),this._min_date),c.scroll_fix=!0}}else if(e.length||"visible"!=this._els.dhx_multi_day[0].style.visibility||(a[0]=-1),e.length||-1==a[0]){var m=(s.parentNode.childNodes,(a[0]+1)*i+1),p=m,g=m+"px";this.config.multi_day_height_limit&&(p=Math.min(m,this.config.multi_day_height_limit),g=p+"px"),r.style.top=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+p+"px",r.style.height=this._obj.offsetHeight-parseInt(r.style.top,10)-(this.xy.margin_top||0)+"px";var v=this._els.dhx_multi_day[0];v.style.height=g,v.style.visibility=-1==a[0]?"hidden":"visible";var x=this._els.dhx_multi_day[1];x.style.height=g,x.style.visibility=-1==a[0]?"hidden":"visible",x.className=a[0]?"dhx_multi_day_icon":"dhx_multi_day_icon_small",this._dy_shift=(a[0]+1)*i,this.config.multi_day_height_limit&&(this._dy_shift=Math.min(this.config.multi_day_height_limit,this._dy_shift)),a[0]=0,p!=m&&(r.style.top=parseInt(r.style.top)+2+"px",v.style.overflowY="auto",x.style.position="fixed",x.style.top="",x.style.left="")}}return e},scheduler._get_event_sday=function(e){var t=this.date.day_start(new Date(e.start_date));return Math.round((t.valueOf()-this._min_date.valueOf())/864e5)},scheduler._get_event_mapped_end_date=function(e){var t=e.end_date;if(this.config.separate_short_events){var i=(e.end_date-e.start_date)/6e4;i<this._min_mapped_duration&&(t=this.date.add(t,this._min_mapped_duration-i,"minute"))}return t},scheduler._pre_render_events_line=function(e,t){e.sort(function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});var i=[],n=[];this._min_mapped_duration=Math.ceil(60*this.xy.min_event_height/this.config.hour_size_px);for(var a=0;a<e.length;a++){var r=e[a],s=r.start_date,l=r.end_date,o=s.getHours(),d=l.getHours();if(r._sday=this._get_event_sday(r),this._ignores[r._sday])e.splice(a,1),a--;else{if(i[r._sday]||(i[r._sday]=[]),!t){r._inner=!1;for(var h=i[r._sday];h.length;){var _=h[h.length-1],c=this._get_event_mapped_end_date(_);if(!(c.valueOf()<=r.start_date.valueOf()))break;h.splice(h.length-1,1)}for(var u=h.length,f=!1,m=0;m<h.length;m++){var _=h[m],c=this._get_event_mapped_end_date(_);if(c.valueOf()<=r.start_date.valueOf()){f=!0,r._sorder=_._sorder,u=m,r._inner=!0;break}}if(h.length&&(h[h.length-1]._inner=!0),!f)if(h.length)if(h.length<=h[h.length-1]._sorder){if(h[h.length-1]._sorder)for(m=0;m<h.length;m++){for(var p=!1,g=0;g<h.length;g++)if(h[g]._sorder==m){p=!0;break}if(!p){r._sorder=m;break}}else r._sorder=0;r._inner=!0}else{var v=h[0]._sorder;for(m=1;m<h.length;m++)h[m]._sorder>v&&(v=h[m]._sorder);r._sorder=v+1,r._inner=!1}else r._sorder=0;h.splice(u,u==h.length?0:1,r),h.length>(h.max_count||0)?(h.max_count=h.length,r._count=h.length):r._count=r._count?r._count:1}(o<this.config.first_hour||d>=this.config.last_hour)&&(n.push(r),e[a]=r=this._copy_event(r),o<this.config.first_hour&&(r.start_date.setHours(this.config.first_hour),r.start_date.setMinutes(0)),d>=this.config.last_hour&&(r.end_date.setMinutes(0),r.end_date.setHours(this.config.last_hour)),r.start_date>r.end_date||o==this.config.last_hour)&&(e.splice(a,1),a--)}}if(!t){for(var a=0;a<e.length;a++)e[a]._count=i[e[a]._sday].max_count;for(var a=0;a<n.length;a++)n[a]._count=i[n[a]._sday].max_count}return e},scheduler._time_order=function(e){e.sort(function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e._timed&&!t._timed?1:!e._timed&&t._timed?-1:e.id>t.id?1:-1:e.start_date>t.start_date?1:-1})},scheduler._pre_render_events_table=function(e,t){this._time_order(e);for(var i,n=[],a=[[],[],[],[],[],[],[]],r=this._colsS.heights,s=this._cols.length,l={},o=0;o<e.length;o++){var d=e[o],h=d.id;l[h]||(l[h]={first_chunk:!0,last_chunk:!0});var _=l[h],c=i||d.start_date,u=d.end_date;c<this._min_date&&(_.first_chunk=!1,c=this._min_date),u>this._max_date&&(_.last_chunk=!1,u=this._max_date);var f=this.locate_holder_day(c,!1,d);if(d._sday=f%s,!this._ignores[d._sday]||!d._timed){var m=this.locate_holder_day(u,!0,d)||s;d._eday=m%s||s,d._length=m-f,d._sweek=Math.floor((this._correct_shift(c.valueOf(),1)-this._min_date.valueOf())/(864e5*s));var p,g=a[d._sweek];for(p=0;p<g.length&&!(g[p]._eday<=d._sday);p++);if(d._sorder&&t||(d._sorder=p),d._sday+d._length<=s)i=null,n.push(d),g[p]=d,r[d._sweek]=g.length-1,d._first_chunk=_.first_chunk,d._last_chunk=_.last_chunk;else{var v=this._copy_event(d);v.id=d.id,v._length=s-d._sday,v._eday=s,v._sday=d._sday,v._sweek=d._sweek,v._sorder=d._sorder,v.end_date=this.date.add(c,v._length,"day"),v._first_chunk=_.first_chunk,_.first_chunk&&(_.first_chunk=!1),n.push(v),g[p]=v,i=v.end_date,r[d._sweek]=g.length-1,o--}}}return n},scheduler._copy_dummy=function(){var e=new Date(this.start_date),t=new Date(this.end_date);this.start_date=e,this.end_date=t},scheduler._copy_event=function(e){return this._copy_dummy.prototype=e,new this._copy_dummy},scheduler._rendered=[],scheduler.clear_view=function(){for(var e=0;e<this._rendered.length;e++){var t=this._rendered[e];t.parentNode&&t.parentNode.removeChild(t)}this._rendered=[]},scheduler.updateEvent=function(e){var t=this.getEvent(e);this.clear_event(e),t&&this.is_visible_events(t)&&this.filter_event(e,t)&&(this._table_view||this.config.multi_day||t._timed)&&(this.config.update_render?this.render_view_data():"month"!=this.getState().mode||this.getState().drag_id||this.isOneDayEvent(t)?this.render_view_data([t],!0):this.render_view_data())},scheduler.clear_event=function(e){this.for_rendered(e,function(e,t){e.parentNode&&e.parentNode.removeChild(e),scheduler._rendered.splice(t,1)})},scheduler._y_from_date=function(e){var t=60*e.getHours()+e.getMinutes();return Math.round((60*t*1e3-60*this.config.first_hour*60*1e3)*this.config.hour_size_px/36e5)%(24*this.config.hour_size_px)},scheduler._calc_event_y=function(e,t){t=t||0;var i=60*e.start_date.getHours()+e.start_date.getMinutes(),n=60*e.end_date.getHours()+e.end_date.getMinutes()||60*scheduler.config.last_hour,a=this._y_from_date(e.start_date),r=Math.max(t,(n-i)*this.config.hour_size_px/60);return{top:a,height:r}},scheduler.render_event=function(e){var t=scheduler.xy.menu_width,i=this.config.use_select_menu_space?0:t;if(!(e._sday<0)){var n=scheduler.locate_holder(e._sday);if(n){var a=this._calc_event_y(e,scheduler.xy.min_event_height),r=a.top,s=a.height,l=e._count||1,o=e._sorder||0,d=Math.floor((n.clientWidth-i)/l),h=o*d+1;if(e._inner||(d*=l-o),this.config.cascade_event_display){var _=this.config.cascade_event_count,c=this.config.cascade_event_margin;h=o%_*c;var u=e._inner?(l-o-1)%_*c/2:0;d=Math.floor(n.clientWidth-i-h-u)}var f=this._render_v_bar(e,i+h,r,d,s,e._text_style,scheduler.templates.event_header(e.start_date,e.end_date,e),scheduler.templates.event_text(e.start_date,e.end_date,e));if(this._waiAria.eventAttr(e,f),this._rendered.push(f),n.appendChild(f),h=h+parseInt(n.style.left,10)+i,this._edit_id==e.id){f.style.zIndex=1,d=Math.max(d-4,scheduler.xy.editor_width),f=document.createElement("DIV"),f.setAttribute("event_id",e.id),this._waiAria.eventAttr(e,f),this.set_xy(f,d,s-20,h,r+14),f.className="dhx_cal_event dhx_cal_editor";var m=scheduler.templates.event_class(e.start_date,e.end_date,e);m&&(f.className+=" "+m);var p=document.createElement("DIV");this.set_xy(p,d-6,s-26),p.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;",f.appendChild(p),this._els.dhx_cal_data[0].appendChild(f),this._rendered.push(f),p.innerHTML="<textarea class='dhx_cal_editor'>"+e.text+"</textarea>",this._quirks7&&(p.firstChild.style.height=s-12+"px"),this._editor=p.firstChild,this._editor.onkeydown=function(e){if((e||event).shiftKey)return!0;var t=(e||event).keyCode;t==scheduler.keys.edit_save&&scheduler.editStop(!0),t==scheduler.keys.edit_cancel&&scheduler.editStop(!1),(t==scheduler.keys.edit_save||t==scheduler.keys.edit_cancel)&&e.preventDefault&&e.preventDefault()},this._editor.onselectstart=function(e){return(e||event).cancelBubble=!0,!0},scheduler._focus(p.firstChild,!0),this._els.dhx_cal_data[0].scrollLeft=0}if(0!==this.xy.menu_width&&this._select_id==e.id){this.config.cascade_event_display&&this._drag_mode&&(f.style.zIndex=1);for(var g,v=this.config["icons_"+(this._edit_id==e.id?"edit":"select")],x="",y=e.color?"background-color: "+e.color+";":"",b=e.textColor?"color: "+e.textColor+";":"",w=0;w<v.length;w++)g=this._waiAria.eventMenuAttrString(v[w]),x+="<div class='dhx_menu_icon "+v[w]+"' style='"+y+b+"' title='"+this.locale.labels[v[w]]+"'"+g+"></div>";var D=this._render_v_bar(e,h-t+1,r,t,20*v.length+26-2,"","<div style='"+y+b+"' class='dhx_menu_head'></div>",x,!0);D.style.left=h-t+1,this._els.dhx_cal_data[0].appendChild(D),this._rendered.push(D)}this.config.drag_highlight&&this._drag_id==e.id&&this.highlightEventPosition(e)}}},scheduler._render_v_bar=function(e,t,i,n,a,r,s,l,o){var d=document.createElement("DIV"),h=e.id,_=o?"dhx_cal_event dhx_cal_select_menu":"dhx_cal_event",c=scheduler.templates.event_class(e.start_date,e.end_date,e);c&&(_=_+" "+c);var u=e.color?"background:"+e.color+";":"",f=e.textColor?"color:"+e.textColor+";":"",m='<div event_id="'+h+'" class="'+_+'" style="position:absolute; top:'+i+"px; left:"+t+"px; width:"+(n-4)+"px; height:"+a+"px;"+(r||"")+'"></div>';d.innerHTML=m;var p=d.cloneNode(!0).firstChild;if(!o&&scheduler.renderEvent(p,e,n,a,s,l))return p;p=d.firstChild;var g='<div class="dhx_event_move dhx_header" style=" width:'+(n-6)+"px;"+u+'" >&nbsp;</div>';g+='<div class="dhx_event_move dhx_title" style="'+u+f+'">'+s+"</div>",g+='<div class="dhx_body" style=" width:'+(n-(this._quirks?4:14))+"px; height:"+(a-(this._quirks?20:30)+1)+"px;"+u+f+'">'+l+"</div>";var v="dhx_event_resize dhx_footer";return o&&(v="dhx_resize_denied "+v),g+='<div class="'+v+'" style=" width:'+(n-8)+"px;"+(o?" margin-top:-1px;":"")+u+f+'" ></div>',p.innerHTML=g,p},scheduler.renderEvent=function(){return!1},scheduler.locate_holder=function(e){return"day"==this._mode?this._els.dhx_cal_data[0].firstChild:this._els.dhx_cal_data[0].childNodes[e]},scheduler.locate_holder_day=function(e,t){var i=Math.floor((this._correct_shift(e,1)-this._min_date)/864e5);return t&&this.date.time_part(e)&&i++,i},scheduler._get_dnd_order=function(e,t,i){if(!this._drag_event)return e;this._drag_event._orig_sorder?e=this._drag_event._orig_sorder:this._drag_event._orig_sorder=e;for(var n=t*e;n+t>i;)e--,n-=t;return e=Math.max(e,0)},scheduler._get_event_bar_pos=function(e){var t=this._colsS[e._sday],i=this._colsS[e._eday];i==t&&(i=this._colsS[e._eday+1]);var n=this.xy.bar_height,a=e._sorder;if(e.id==this._drag_id){var r=this._colsS.heights[e._sweek+1]-this._colsS.heights[e._sweek]-this.xy.month_head_height;a=scheduler._get_dnd_order(a,n,r)}var s=a*n,l=this._colsS.heights[e._sweek]+(this._colsS.height?this.xy.month_scale_height+2:2)+s;return{x:t,x2:i,y:l}},scheduler.render_event_bar=function(e){var t=this._rendered_location,i=this._get_event_bar_pos(e),n=i.y,a=i.x,r=i.x2,s="";if(r){var l=scheduler.config.resize_month_events&&"month"==this._mode&&(!e._timed||scheduler.config.resize_month_timed),o=document.createElement("DIV"),d=e.hasOwnProperty("_first_chunk")&&e._first_chunk,h=e.hasOwnProperty("_last_chunk")&&e._last_chunk,_=l&&(e._timed||d),c=l&&(e._timed||h),u="dhx_cal_event_clear";(!e._timed||l)&&(u="dhx_cal_event_line"),d&&(u+=" dhx_cal_event_line_start"),h&&(u+=" dhx_cal_event_line_end"),_&&(s+="<div class='dhx_event_resize dhx_event_resize_start'></div>"),c&&(s+="<div class='dhx_event_resize dhx_event_resize_end'></div>");var f=scheduler.templates.event_class(e.start_date,e.end_date,e);f&&(u+=" "+f);var m=e.color?"background:"+e.color+";":"",p=e.textColor?"color:"+e.textColor+";":"",g=["position:absolute","top:"+n+"px","left:"+a+"px","width:"+(r-a-15)+"px",p,m,e._text_style||""].join(";"),v="<div event_id='"+e.id+"' class='"+u+"' style='"+g+"'"+this._waiAria.eventBarAttrString(e)+">";l&&(v+=s),"month"==scheduler.getState().mode&&(e=scheduler.getEvent(e.id)),e._timed&&(v+=scheduler.templates.event_bar_date(e.start_date,e.end_date,e)),v+=scheduler.templates.event_bar_text(e.start_date,e.end_date,e)+"</div>",v+="</div>",o.innerHTML=v,this._rendered.push(o.firstChild),t.appendChild(o.firstChild)}},scheduler._locate_event=function(e){for(var t=null;e&&!t&&e.getAttribute;)t=e.getAttribute("event_id"),e=e.parentNode;return t},scheduler._locate_css=function(e,t,i){void 0===i&&(i=!0);for(var n=e.target||e.srcElement,a="";n;){if(a=scheduler._getClassName(n)){var r=a.indexOf(t);if(r>=0){if(!i)return n;var s=0===r||!scheduler._trim(a.charAt(r-1)),l=r+t.length>=a.length||!scheduler._trim(a.charAt(r+t.length));if(s&&l)return n}}n=n.parentNode}return null},scheduler.edit=function(e){this._edit_id!=e&&(this.editStop(!1,e),this._edit_id=e,this.updateEvent(e))},scheduler.editStop=function(e,t){if(!t||this._edit_id!=t){var i=this.getEvent(this._edit_id);i&&(e&&(i.text=this._editor.value),this._edit_id=null,this._editor=null,this.updateEvent(i.id),this._edit_stop_event(i,e))}},scheduler._edit_stop_event=function(e,t){this._new_event?(t?this.callEvent("onEventAdded",[e.id,e]):e&&this.deleteEvent(e.id,!0),this._new_event=null):t&&this.callEvent("onEventChanged",[e.id,e])},scheduler.getEvents=function(e,t){var i=[];for(var n in this._events){var a=this._events[n];a&&(!e&&!t||a.start_date<t&&a.end_date>e)&&i.push(a)}return i},scheduler.getRenderedEvent=function(e){if(e){for(var t=scheduler._rendered,i=0;i<t.length;i++){var n=t[i];if(n.getAttribute("event_id")==e)return n}return null}},scheduler.showEvent=function(e,t){var i="number"==typeof e||"string"==typeof e?scheduler.getEvent(e):e;if(t=t||scheduler._mode,i&&(!this.checkEvent("onBeforeEventDisplay")||this.callEvent("onBeforeEventDisplay",[i,t]))){var n=scheduler.config.scroll_hour;scheduler.config.scroll_hour=i.start_date.getHours();var a=scheduler.config.preserve_scroll;scheduler.config.preserve_scroll=!1;var r=i.color,s=i.textColor;if(scheduler.config.highlight_displayed_event&&(i.color=scheduler.config.displayed_event_color,i.textColor=scheduler.config.displayed_event_text_color),scheduler.setCurrentView(new Date(i.start_date),t),i.color=r,i.textColor=s,scheduler.config.scroll_hour=n,scheduler.config.preserve_scroll=a,scheduler.matrix&&scheduler.matrix[t]){var l=scheduler.getRenderedEvent(i.id);l&&(scheduler._els.dhx_cal_data[0].scrollTop=getAbsoluteTop(l)-getAbsoluteTop(scheduler._els.dhx_cal_data[0])-20)}scheduler.callEvent("onAfterEventDisplay",[i,t])}},scheduler._append_drag_marker=function(e){if(!e.parentNode){var t=scheduler._els.dhx_cal_data[0],i=t.lastChild,n=scheduler._getClassName(i);n.indexOf("dhx_scale_holder")<0&&i.previousSibling&&(i=i.previousSibling),n=scheduler._getClassName(i),i&&0===n.indexOf("dhx_scale_holder")&&i.appendChild(e)}},scheduler._update_marker_position=function(e,t){var i=scheduler._calc_event_y(t,0);e.style.top=i.top+"px",e.style.height=i.height+"px"},scheduler.highlightEventPosition=function(e){var t=document.createElement("div");t.setAttribute("event_id",e.id),this._rendered.push(t),this._update_marker_position(t,e);var i=this.templates.drag_marker_class(e.start_date,e.end_date,e),n=this.templates.drag_marker_content(e.start_date,e.end_date,e);t.className="dhx_drag_marker",i&&(t.className+=" "+i),n&&(t.innerHTML=n),this._append_drag_marker(t)},scheduler._loaded={},scheduler._load=function(e,t){if(e=e||this._load_url){e+=(-1==e.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset(),this.config.prevent_cache&&(e+="&uid="+this.uid());var i;if(t=t||this._date,this._load_mode){var n=this.templates.load_format;for(t=this.date[this._load_mode+"_start"](new Date(t.valueOf()));t>this._min_date;)t=this.date.add(t,-1,this._load_mode);i=t;for(var a=!0;i<this._max_date;)i=this.date.add(i,1,this._load_mode),this._loaded[n(t)]&&a?t=this.date.add(t,1,this._load_mode):a=!1;var r=i;do i=r,r=this.date.add(i,-1,this._load_mode);while(r>t&&this._loaded[n(r)]);if(t>=i)return!1;for(dhtmlxAjax.get(e+"&from="+n(t)+"&to="+n(i),function(e){scheduler.on_load(e)});i>t;)this._loaded[n(t)]=!0,t=this.date.add(t,1,this._load_mode)}else dhtmlxAjax.get(e,function(e){scheduler.on_load(e)});return this.callEvent("onXLS",[]),!0}},scheduler.on_load=function(e){var t,i=!1;if(this._process&&"xml"!=this._process)try{t=this[this._process].parse(e.xmlDoc.responseText)}catch(n){i=!0}else t=this._magic_parser(e),t||(i=!0);i&&(this.callEvent("onLoadError",[e.xmlDoc]),t=[]),scheduler._process_loading(t),this.callEvent("onXLE",[])},scheduler._process_loading=function(e){this._loading=!0,this._not_render=!0;for(var t=0;t<e.length;t++)this.callEvent("onEventLoading",[e[t]])&&this.addEvent(e[t]);this._not_render=!1,this._render_wait&&this.render_view_data(),this._loading=!1,this._after_call&&this._after_call(),this._after_call=null},scheduler._init_event=function(e){e.text=e.text||e._tagvalue||"",e.start_date=scheduler._init_date(e.start_date),e.end_date=scheduler._init_date(e.end_date)},scheduler._init_date=function(e){return e?"string"==typeof e?scheduler.templates.xml_date(e):new Date(e):null},scheduler.json={},scheduler.json.parse=function(data){"string"==typeof data&&(window.JSON?scheduler._temp=JSON.parse(data):scheduler._temp=eval("("+data+")"),data=scheduler._temp?scheduler._temp.data||scheduler._temp.d||scheduler._temp:[]),data.dhx_security&&(dhtmlx.security_key=data.dhx_security);var collections=scheduler._temp&&scheduler._temp.collections?scheduler._temp.collections:{},collections_loaded=!1;for(var key in collections)if(collections.hasOwnProperty(key)){collections_loaded=!0;var collection=collections[key],arr=scheduler.serverList[key];if(!arr)continue;arr.splice(0,arr.length);for(var j=0;j<collection.length;j++){var option=collection[j],obj={key:option.value,label:option.label};for(var option_key in option)if(option.hasOwnProperty(option_key)){if("value"==option_key||"label"==option_key)continue;obj[option_key]=option[option_key]}arr.push(obj)}}collections_loaded&&scheduler.callEvent("onOptionsLoad",[]);for(var evs=[],i=0;i<data.length;i++){var event=data[i];scheduler._init_event(event),evs.push(event)}return evs},scheduler.parse=function(e,t){this._process=t,this.on_load({xmlDoc:{responseText:e}})},scheduler.load=function(e,t){"string"==typeof t&&(this._process=t,t=arguments[2]),this._load_url=e,this._after_call=t,this._load(e,this._date)},scheduler.setLoadMode=function(e){"all"==e&&(e=""),this._load_mode=e},scheduler.serverList=function(e,t){return t?(this.serverList[e]=t.slice(0),this.serverList[e]):(this.serverList[e]=this.serverList[e]||[],this.serverList[e])},scheduler._userdata={},scheduler._magic_parser=function(e){var t;if(!e.getXMLTopNode){var i=e.xmlDoc.responseText;e=new dtmlXMLLoaderObject(function(){}),e.loadXMLString(i)}if(t=e.getXMLTopNode("data"),"data"!=t.tagName)return null;var n=t.getAttribute("dhx_security");n&&(dhtmlx.security_key=n);for(var a=e.doXPath("//coll_options"),r=0;r<a.length;r++){var s=a[r].getAttribute("for"),l=this.serverList[s];if(l){l.splice(0,l.length);for(var o=e.doXPath(".//item",a[r]),d=0;d<o.length;d++){for(var h=o[d],_=h.attributes,c={key:o[d].getAttribute("value"),label:o[d].getAttribute("label")},u=0;u<_.length;u++){var f=_[u];"value"!=f.nodeName&&"label"!=f.nodeName&&(c[f.nodeName]=f.nodeValue)}l.push(c)}}}a.length&&scheduler.callEvent("onOptionsLoad",[]);for(var m=e.doXPath("//userdata"),r=0;r<m.length;r++){var p=this._xmlNodeToJSON(m[r]);this._userdata[p.name]=p.text}var g=[];t=e.doXPath("//event");for(var r=0;r<t.length;r++){var v=g[r]=this._xmlNodeToJSON(t[r]);scheduler._init_event(v)}return g},scheduler._xmlNodeToJSON=function(e){for(var t={},i=0;i<e.attributes.length;i++)t[e.attributes[i].name]=e.attributes[i].value;for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1==n.nodeType&&(t[n.tagName]=n.firstChild?n.firstChild.nodeValue:"")}return t.text||(t.text=e.firstChild?e.firstChild.nodeValue:""),t},scheduler.attachEvent("onXLS",function(){if(this.config.show_loading===!0){var e;e=this.config.show_loading=document.createElement("DIV"),e.className="dhx_loading",e.style.left=Math.round((this._x-128)/2)+"px",e.style.top=Math.round((this._y-15)/2)+"px",this._obj.appendChild(e)}}),scheduler.attachEvent("onXLE",function(){var e=this.config.show_loading;e&&"object"==typeof e&&(this._obj.removeChild(e),this.config.show_loading=!0)}),scheduler.ical={parse:function(e){var t=e.match(RegExp(this.c_start+"[^\f]*"+this.c_end,""));if(t.length){t[0]=t[0].replace(/[\r\n]+(?=[a-z \t])/g," "),t[0]=t[0].replace(/\;[^:\r\n]*:/g,":");for(var i,n=[],a=RegExp("(?:"+this.e_start+")([^\f]*?)(?:"+this.e_end+")","g");null!==(i=a.exec(t));){for(var r,s={},l=/[^\r\n]+[\r\n]+/g;null!==(r=l.exec(i[1]));)this.parse_param(r.toString(),s);s.uid&&!s.id&&(s.id=s.uid),n.push(s)}return n}},parse_param:function(e,t){var i=e.indexOf(":");if(-1!=i){var n=e.substr(0,i).toLowerCase(),a=e.substr(i+1).replace(/\\\,/g,",").replace(/[\r\n]+$/,"");"summary"==n?n="text":"dtstart"==n?(n="start_date",a=this.parse_date(a,0,0)):"dtend"==n&&(n="end_date",a=this.parse_date(a,0,0)),t[n]=a}},parse_date:function(e,t,i){var n=e.split("T"),a=!1;n[1]&&(t=n[1].substr(0,2),i=n[1].substr(2,2),a=!("Z"!=n[1][6]));var r=n[0].substr(0,4),s=parseInt(n[0].substr(4,2),10)-1,l=n[0].substr(6,2);return scheduler.config.server_utc||a?new Date(Date.UTC(r,s,l,t,i)):new Date(r,s,l,t,i)},c_start:"BEGIN:VCALENDAR",e_start:"BEGIN:VEVENT",e_end:"END:VEVENT",c_end:"END:VCALENDAR"},scheduler._lightbox_controls={},scheduler.formSection=function(e){var t=this.config.lightbox.sections,i=0;for(i;i<t.length&&t[i].name!=e;i++);var n=t[i];scheduler._lightbox||scheduler.getLightbox();var a=document.getElementById(n.id),r=a.nextSibling,s={section:n,header:a,node:r,getValue:function(e){return scheduler.form_blocks[n.type].get_value(r,e||{},n)},setValue:function(e,t){return scheduler.form_blocks[n.type].set_value(r,e,t||{},n)}},l=scheduler._lightbox_controls["get_"+n.type+"_control"];return l?l(s):s},scheduler._lightbox_controls.get_template_control=function(e){return e.control=e.node,e},scheduler._lightbox_controls.get_select_control=function(e){return e.control=e.node.getElementsByTagName("select")[0],e},scheduler._lightbox_controls.get_textarea_control=function(e){return e.control=e.node.getElementsByTagName("textarea")[0],e},scheduler._lightbox_controls.get_time_control=function(e){return e.control=e.node.getElementsByTagName("select"),e},scheduler.form_blocks={template:{render:function(e){var t=(e.height||"30")+"px";return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+t+";'></div>"},set_value:function(e,t,i,n){e.innerHTML=t||""},get_value:function(e,t,i){
return e.innerHTML||""},focus:function(e){}},textarea:{render:function(e){var t=(e.height||"130")+"px";return"<div class='dhx_cal_ltext' style='height:"+t+";'><textarea></textarea></div>"},set_value:function(e,t,i){scheduler.form_blocks.textarea._get_input(e).value=t||""},get_value:function(e,t){return scheduler.form_blocks.textarea._get_input(e).value},focus:function(e){var t=scheduler.form_blocks.textarea._get_input(e);scheduler._focus(t,!0)},_get_input:function(e){return e.getElementsByTagName("textarea")[0]}},select:{render:function(e){for(var t=(e.height||"23")+"px",i="<div class='dhx_cal_ltext' style='height:"+t+";'><select style='width:100%;'>",n=0;n<e.options.length;n++)i+="<option value='"+e.options[n].key+"'>"+e.options[n].label+"</option>";return i+="</select></div>"},set_value:function(e,t,i,n){var a=e.firstChild;!a._dhx_onchange&&n.onchange&&(a.onchange=n.onchange,a._dhx_onchange=!0),"undefined"==typeof t&&(t=(a.options[0]||{}).value),a.value=t||""},get_value:function(e,t){return e.firstChild.value},focus:function(e){var t=e.firstChild;scheduler._focus(t,!0)}},time:{render:function(e){e.time_format||(e.time_format=["%H:%i","%d","%m","%Y"]),e._time_format_order={};var t=e.time_format,i=scheduler.config,n=this.date.date_part(scheduler._currentDate()),a=1440,r=0;scheduler.config.limit_time_select&&(a=60*i.last_hour+1,r=60*i.first_hour,n.setHours(i.first_hour));for(var s="",l=0;l<t.length;l++){var o=t[l];l>0&&(s+=" ");var d="";switch(o){case"%Y":e._time_format_order[3]=l;for(var h=n.getFullYear()-5,_=0;10>_;_++)d+="<option value='"+(h+_)+"'>"+(h+_)+"</option>";break;case"%m":e._time_format_order[2]=l;for(var _=0;12>_;_++)d+="<option value='"+_+"'>"+this.locale.date.month_full[_]+"</option>";break;case"%d":e._time_format_order[1]=l;for(var _=1;32>_;_++)d+="<option value='"+_+"'>"+_+"</option>";break;case"%H:%i":e._time_format_order[0]=l;var _=r,c=n.getDate();for(e._time_values=[];a>_;){var u=this.templates.time_picker(n);d+="<option value='"+_+"'>"+u+"</option>",e._time_values.push(_),n.setTime(n.valueOf()+60*this.config.time_step*1e3);var f=n.getDate()!=c?1:0;_=24*f*60+60*n.getHours()+n.getMinutes()}}if(d){var m=scheduler._waiAria.lightboxSelectAttrString(o),p=e.readonly?"disabled='disabled'":"";s+="<select "+p+m+">"+d+"</select> "}}return"<div style='height:30px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+s+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+s+"</div>"},set_value:function(e,t,i,n){function a(e,t,i){for(var a=n._time_values,r=60*i.getHours()+i.getMinutes(),s=r,l=!1,o=0;o<a.length;o++){var h=a[o];if(h===r){l=!0;break}r>h&&(s=h)}e[t+d[0]].value=l?r:s,l||s||(e[t+d[0]].selectedIndex=-1),e[t+d[1]].value=i.getDate(),e[t+d[2]].value=i.getMonth(),e[t+d[3]].value=i.getFullYear()}var r,s,l=scheduler.config,o=e.getElementsByTagName("select"),d=n._time_format_order;if(l.full_day){if(!e._full_day){var h="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>";scheduler.config.wide_form||(h=e.previousSibling.innerHTML+h),e.previousSibling.innerHTML=h,e._full_day=!0}var _=e.previousSibling.getElementsByTagName("input")[0];_.checked=0===scheduler.date.time_part(i.start_date)&&0===scheduler.date.time_part(i.end_date),o[d[0]].disabled=_.checked,o[d[0]+o.length/2].disabled=_.checked,_.onclick=function(){if(_.checked){var t={};scheduler.form_blocks.time.get_value(e,t,n),r=scheduler.date.date_part(t.start_date),s=scheduler.date.date_part(t.end_date),(+s==+r||+s>=+r&&(0!==i.end_date.getHours()||0!==i.end_date.getMinutes()))&&(s=scheduler.date.add(s,1,"day"))}else r=null,s=null;o[d[0]].disabled=_.checked,o[d[0]+o.length/2].disabled=_.checked,a(o,0,r||i.start_date),a(o,4,s||i.end_date)}}if(l.auto_end_date&&l.event_duration)for(var c=function(){r=new Date(o[d[3]].value,o[d[2]].value,o[d[1]].value,0,o[d[0]].value),s=new Date(r.getTime()+60*scheduler.config.event_duration*1e3),a(o,4,s)},u=0;4>u;u++)o[u].onchange=c;a(o,0,i.start_date),a(o,4,i.end_date)},get_value:function(e,t,i){var n=e.getElementsByTagName("select"),a=i._time_format_order;if(t.start_date=new Date(n[a[3]].value,n[a[2]].value,n[a[1]].value,0,n[a[0]].value),t.end_date=new Date(n[a[3]+4].value,n[a[2]+4].value,n[a[1]+4].value,0,n[a[0]+4].value),!n[a[3]].value||!n[a[3]+4].value){var r=this.getEvent(this._lightbox_id);r&&(t.start_date=r.start_date,t.end_date=r.end_date)}return t.end_date<=t.start_date&&(t.end_date=scheduler.date.add(t.start_date,scheduler.config.time_step,"minute")),{start_date:new Date(t.start_date),end_date:new Date(t.end_date)}},focus:function(e){scheduler._focus(e.getElementsByTagName("select")[0])}}},scheduler.showCover=function(e){if(e){e.style.display="block";var t=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,i=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,n=window.innerHeight||document.documentElement.clientHeight;t?e.style.top=Math.round(t+Math.max((n-e.offsetHeight)/2,0))+"px":e.style.top=Math.round(Math.max((n-e.offsetHeight)/2,0)+9)+"px",document.documentElement.scrollWidth>document.body.offsetWidth?e.style.left=Math.round(i+(document.body.offsetWidth-e.offsetWidth)/2)+"px":e.style.left=Math.round((document.body.offsetWidth-e.offsetWidth)/2)+"px"}this.show_cover()},scheduler.showLightbox=function(e){if(e){if(!this.callEvent("onBeforeLightbox",[e]))return void(this._new_event&&(this._new_event=null));var t=this.getLightbox();this.showCover(t),this._fill_lightbox(e,t),this._waiAria.lightboxVisibleAttr(t),this.callEvent("onLightbox",[e])}},scheduler._fill_lightbox=function(e,t){var i=this.getEvent(e),n=t.getElementsByTagName("span"),a=[];if(scheduler.templates.lightbox_header){a.push("");var r=scheduler.templates.lightbox_header(i.start_date,i.end_date,i);a.push(r),n[1].innerHTML="",n[2].innerHTML=r}else{var s=this.templates.event_header(i.start_date,i.end_date,i),l=(this.templates.event_bar_text(i.start_date,i.end_date,i)||"").substr(0,70);a.push(s),a.push(l),n[1].innerHTML=s,n[2].innerHTML=l}this._waiAria.lightboxHeader(t,a.join(" "));for(var o=this.config.lightbox.sections,d=0;d<o.length;d++){var h=o[d],_=scheduler._get_lightbox_section_node(h),c=this.form_blocks[h.type],u=void 0!==i[h.map_to]?i[h.map_to]:h.default_value;c.set_value.call(this,_,u,i,h),o[d].focus&&c.focus.call(this,_)}scheduler._lightbox_id=e},scheduler._get_lightbox_section_node=function(e){return document.getElementById(e.id).nextSibling},scheduler._lightbox_out=function(e){for(var t=this.config.lightbox.sections,i=0;i<t.length;i++){var n=document.getElementById(t[i].id);n=n?n.nextSibling:n;var a=this.form_blocks[t[i].type],r=a.get_value.call(this,n,e,t[i]);"auto"!=t[i].map_to&&(e[t[i].map_to]=r)}return e},scheduler._empty_lightbox=function(e){var t=scheduler._lightbox_id,i=this.getEvent(t);this.getLightbox(),this._lame_copy(i,e),this.setEvent(i.id,i),this._edit_stop_event(i,!0),this.render_view_data()},scheduler.hide_lightbox=function(e){var t=this.getLightbox();this.hideCover(t),this._waiAria.lightboxHiddenAttr(t),this._lightbox_id=null,this.callEvent("onAfterLightbox",[])},scheduler.hideCover=function(e){e&&(e.style.display="none"),this.hide_cover()},scheduler.hide_cover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},scheduler.show_cover=function(){if(!this._cover){this._cover=document.createElement("DIV"),this._cover.className="dhx_cal_cover";var e=void 0!==document.height?document.height:document.body.offsetHeight,t=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(e,t)+"px",document.body.appendChild(this._cover)}},scheduler.save_lightbox=function(){var e=this._lightbox_out({},this._lame_copy(this.getEvent(this._lightbox_id)));(!this.checkEvent("onEventSave")||this.callEvent("onEventSave",[this._lightbox_id,e,this._new_event]))&&(this._empty_lightbox(e),this.hide_lightbox())},scheduler.startLightbox=function(e,t){this._lightbox_id=e,this._custom_lightbox=!0,this._temp_lightbox=this._lightbox,this._lightbox=t,this.showCover(t)},scheduler.endLightbox=function(e,t){this._edit_stop_event(scheduler.getEvent(this._lightbox_id),e),e&&scheduler.render_view_data(),this.hideCover(t),this._custom_lightbox&&(this._lightbox=this._temp_lightbox,this._custom_lightbox=!1),this._temp_lightbox=this._lightbox_id=null},scheduler.resetLightbox=function(){scheduler._lightbox&&!scheduler._custom_lightbox&&scheduler._lightbox.parentNode.removeChild(scheduler._lightbox),scheduler._lightbox=null},scheduler.cancel_lightbox=function(){this.callEvent("onEventCancel",[this._lightbox_id,this._new_event]),this.endLightbox(!1),this.hide_lightbox()},scheduler._init_lightbox_events=function(){this.getLightbox().onclick=function(e){var t=e?e.target:event.srcElement;t.className||(t=t.previousSibling);var i=scheduler._getClassName(t);if(t&&i)switch(i){case"dhx_save_btn":scheduler.save_lightbox();break;case"dhx_delete_btn":var n=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(n,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(scheduler._lightbox_id),scheduler._new_event=null,scheduler.hide_lightbox()});break;case"dhx_cancel_btn":scheduler.cancel_lightbox();break;default:if(t.getAttribute("dhx_button"))scheduler.callEvent("onLightboxButton",[i,t,e]);else{var a,r,s;-1!=i.indexOf("dhx_custom_button")&&(-1!=i.indexOf("dhx_custom_button_")?(a=t.parentNode.getAttribute("index"),s=t.parentNode.parentNode):(a=t.getAttribute("index"),s=t.parentNode,t=t.firstChild)),a&&(r=scheduler.form_blocks[scheduler.config.lightbox.sections[a].type],r.button_click(a,t,s,s.nextSibling))}}},this.getLightbox().onkeydown=function(e){var t=e||window.event,i=e.target||e.srcElement,n=i.querySelector("[dhx_button]");switch(n||(n=i.parentNode.querySelector(".dhx_custom_button, .dhx_readonly")),(e||t).keyCode){case 32:if((e||t).shiftKey)return;n&&n.click&&n.click();break;case scheduler.keys.edit_save:if((e||t).shiftKey)return;n&&n.click?n.click():scheduler.save_lightbox();break;case scheduler.keys.edit_cancel:scheduler.cancel_lightbox()}}},scheduler.setLightboxSize=function(){var e=this._lightbox;if(e){var t=e.childNodes[1];t.style.height="0px",t.style.height=t.scrollHeight+"px",e.style.height=t.scrollHeight+scheduler.xy.lightbox_additional_height+"px",t.style.height=t.scrollHeight+"px"}},scheduler._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",scheduler._move_while_dnd),dhtmlxEvent(document.body,"mouseup",scheduler._finish_dnd),scheduler._init_dnd_events=function(){}},scheduler._move_while_dnd=function(e){if(scheduler._dnd_start_lb){document.dhx_unselectable||(document.body.className+=" dhx_unselectable",document.dhx_unselectable=!0);var t=scheduler.getLightbox(),i=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY];t.style.top=scheduler._lb_start[1]+i[1]-scheduler._dnd_start_lb[1]+"px",t.style.left=scheduler._lb_start[0]+i[0]-scheduler._dnd_start_lb[0]+"px"}},scheduler._ready_to_dnd=function(e){var t=scheduler.getLightbox();scheduler._lb_start=[parseInt(t.style.left,10),parseInt(t.style.top,10)],scheduler._dnd_start_lb=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY]},scheduler._finish_dnd=function(){scheduler._lb_start&&(scheduler._lb_start=scheduler._dnd_start_lb=!1,document.body.className=document.body.className.replace(" dhx_unselectable",""),document.dhx_unselectable=!1)},scheduler.getLightbox=function(){if(!this._lightbox){var e=document.createElement("DIV");e.className="dhx_cal_light",scheduler.config.wide_form&&(e.className+=" dhx_cal_light_wide"),scheduler.form_blocks.recurring&&(e.className+=" dhx_cal_light_rec"),/msie|MSIE 6/.test(navigator.userAgent)&&(e.className+=" dhx_ie6"),e.style.visibility="hidden";for(var t=this._lightbox_template,i=this.config.buttons_left,n="",a=0;a<i.length;a++)n=this._waiAria.lightboxButtonAttrString(i[a]),t+="<div "+n+" class='dhx_btn_set dhx_left_btn_set "+i[a]+"_set'><div dhx_button='1' class='"+i[a]+"'></div><div>"+scheduler.locale.labels[i[a]]+"</div></div>";i=this.config.buttons_right;for(var a=0;a<i.length;a++)n=this._waiAria.lightboxButtonAttrString(i[a]),t+="<div "+n+" class='dhx_btn_set dhx_right_btn_set "+i[a]+"_set' style='float:right;'><div dhx_button='1' class='"+i[a]+"'></div><div>"+scheduler.locale.labels[i[a]]+"</div></div>";t+="</div>",e.innerHTML=t,scheduler.config.drag_lightbox&&(e.firstChild.onmousedown=scheduler._ready_to_dnd,e.firstChild.onselectstart=function(){return!1},e.firstChild.style.cursor="pointer",scheduler._init_dnd_events()),this._waiAria.lightboxAttr(e),document.body.insertBefore(e,document.body.firstChild),this._lightbox=e;var r=this.config.lightbox.sections;t="";for(var a=0;a<r.length;a++){var s=this.form_blocks[r[a].type];if(s){r[a].id="area_"+this.uid();var l="";if(r[a].button){var n=scheduler._waiAria.lightboxSectionButtonAttrString(this.locale.labels["button_"+r[a].button]);l="<div "+n+" class='dhx_custom_button' index='"+a+"'><div class='dhx_custom_button_"+r[a].button+"'></div><div>"+this.locale.labels["button_"+r[a].button]+"</div></div>"}this.config.wide_form&&(t+="<div class='dhx_wrap_section'>");var o=this.locale.labels["section_"+r[a].name];"string"!=typeof o&&(o=r[a].name),t+="<div id='"+r[a].id+"' class='dhx_cal_lsection'>"+l+"<label>"+o+"</label></div>"+s.render.call(this,r[a]),t+="</div>"}}for(var d=e.getElementsByTagName("div"),a=0;a<d.length;a++){var h=d[a],_=scheduler._getClassName(h);if("dhx_cal_larea"==_){h.innerHTML=t;break}}scheduler._bindLightboxLabels(r),this.setLightboxSize(),this._init_lightbox_events(this),e.style.display="none",e.style.visibility="visible"}return this._lightbox},scheduler._bindLightboxLabels=function(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.id&&document.getElementById(i.id)){for(var n=document.getElementById(i.id),a=n.querySelector("label"),r=scheduler._get_lightbox_section_node(i);r&&!r.querySelector;)r=r.nextSibling;var s=!0;if(r){var l=r.querySelector("input, select, textarea");l&&(i.inputId=l.id||"input_"+scheduler.uid(),l.id||(l.id=i.inputId),a.setAttribute("for",i.inputId),s=!1)}if(s){var o=scheduler.form_blocks[i.type];o.focus&&(a.onclick=function(e){return function(){var t=scheduler.form_blocks[e.type],i=scheduler._get_lightbox_section_node(e);t&&t.focus&&t.focus.call(scheduler,i)}}(i))}}}},scheduler.attachEvent("onEventIdChange",function(e,t){this._lightbox_id==e&&(this._lightbox_id=t)}),scheduler._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>",scheduler._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))),this.config.touch&&(this.xy.scroll_width=0,window.navigator.msPointerEnabled?(this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(e){return e.pointerType==e.MSPOINTER_TYPE_MOUSE?null:e},function(e){return!e||e.pointerType==e.MSPOINTER_TYPE_MOUSE||scheduler._pointerDragId&&scheduler._pointerDragId!=e.pointerId}),this._obj.ondblclick=function(){}):this._touch_events(["touchmove","touchstart","touchend"],function(e){return e.touches&&e.touches.length>1?null:e.touches&&e.touches[0]?{target:e.target,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY}:e},function(e){return!!(e.touches&&e.touches.length>1)}))},scheduler._touch_events=function(e,t,i){function n(e,t,i){e.addEventListener(t,function(e){return scheduler._is_lightbox_open()?!0:i(e)},{passive:!1})}function a(e,t,i,n){if(e&&t){for(var a=e.target;a&&a!=scheduler._obj;)a=a.parentNode;if(a==scheduler._obj){var r=Math.abs(e.pageY-t.pageY),s=Math.abs(e.pageX-t.pageX);n>r&&s>i&&(!r||s/r>3)&&(e.pageX>t.pageX?scheduler._click.dhx_cal_next_button():scheduler._click.dhx_cal_prev_button())}}}function r(e){var t=scheduler.getState().drag_mode,i=scheduler.matrix?scheduler.matrix[scheduler._mode]:!1,n=scheduler.render_view_data;"create"==t&&i&&(scheduler.render_view_data=function(){for(var e=scheduler.getState().drag_id,t=scheduler.getEvent(e),n=i.y_property,a=scheduler.getEvents(t.start_date,t.end_date),r=0;r<a.length;r++)a[r][n]!=t[n]&&(a.splice(r,1),r--);t._sorder=a.length-1,t._count=a.length,this.render_data([t],scheduler.getState().mode)}),scheduler._on_mouse_move(e),"create"==t&&i&&(scheduler.render_view_data=n)}function s(e){scheduler._hide_global_tip(),h&&(scheduler._on_mouse_up(t(e||event)),scheduler._temp_touch_block=!1),scheduler._drag_id=null,scheduler._drag_mode=null,scheduler._drag_pos=null,scheduler._pointerDragId=null,clearTimeout(d),h=c=!1,_=!0}var l,o,d,h,_,c,u=(-1!=navigator.userAgent.indexOf("Android")&&-1!=navigator.userAgent.indexOf("WebKit"),0);n(document.body,e[0],function(e){if(!i(e)){var n=t(e);if(n){if(h)return r(n),scheduler._update_global_tip(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1;if(o=t(e),c)return o?void((l.target!=o.target||Math.abs(l.pageX-o.pageX)>5||Math.abs(l.pageY-o.pageY)>5)&&(_=!0,clearTimeout(d))):void(_=!0)}}}),n(this._els.dhx_cal_data[0],"scroll",s),n(this._els.dhx_cal_data[0],"touchcancel",s),n(this._els.dhx_cal_data[0],"contextmenu",function(e){return c?(e&&e.preventDefault&&e.preventDefault(),(e||event).cancelBubble=!0,!1):void 0}),n(this._obj,e[1],function(e){if(!i(e)){scheduler._pointerDragId=e.pointerId;var n;if(h=_=!1,c=!0,scheduler._temp_touch_block=!0,n=o=t(e),!n)return void(_=!0);var a=new Date;if(!_&&!h&&250>a-u)return scheduler._click.dhx_cal_data(n),window.setTimeout(function(){n.type="dblclick",scheduler._on_dbl_click(n)},50),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._block_next_stop=!0,!1;if(u=a,!_&&!h&&scheduler.config.touch_drag){var r=scheduler._locate_event(document.activeElement),s=scheduler._locate_event(n.target),f=l?scheduler._locate_event(l.target):null;if(r&&s&&r==s&&r!=f)return e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._ignore_next_click=!1,scheduler._click.dhx_cal_data(n),l=n,!1;d=setTimeout(function(){h=!0;var e=l.target,t=scheduler._getClassName(e);e&&-1!=t.indexOf("dhx_body")&&(e=e.previousSibling),scheduler._on_mouse_down(l,e),scheduler._drag_mode&&"create"!=scheduler._drag_mode&&scheduler.for_rendered(scheduler._drag_id,function(e,t){e.style.display="none",scheduler._rendered.splice(t,1)}),scheduler.config.touch_tip&&scheduler._show_global_tip(),scheduler.updateEvent(scheduler._drag_id)},scheduler.config.touch_drag),l=n}}}),n(this._els.dhx_cal_data[0],e[2],function(e){return i(e)?void 0:(h||a(l,o,200,100),h&&(scheduler._ignore_next_click=!0),s(e),scheduler._block_next_stop?(scheduler._block_next_stop=!1,e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):void 0)}),dhtmlxEvent(document.body,e[2],s)},scheduler._show_global_tip=function(){scheduler._hide_global_tip();var e=scheduler._global_tip=document.createElement("DIV");e.className="dhx_global_tip",scheduler._update_global_tip(1),document.body.appendChild(e)},scheduler._update_global_tip=function(e){var t=scheduler._global_tip;if(t){var i="";if(scheduler._drag_id&&!e){var n=scheduler.getEvent(scheduler._drag_id);n&&(i="<div>"+(n._timed?scheduler.templates.event_header(n.start_date,n.end_date,n):scheduler.templates.day_date(n.start_date,n.end_date,n))+"</div>")}"create"==scheduler._drag_mode||"new-size"==scheduler._drag_mode?t.innerHTML=(scheduler.locale.labels.drag_to_create||"Drag to create")+i:t.innerHTML=(scheduler.locale.labels.drag_to_move||"Drag to move")+i}},scheduler._hide_global_tip=function(){var e=scheduler._global_tip;e&&e.parentNode&&(e.parentNode.removeChild(e),scheduler._global_tip=0)},scheduler._dp_init=function(e){e._methods=["_set_event_text_style","","_dp_change_event_id","_dp_hook_delete"],this._dp_change_event_id=function(e,t){scheduler.getEvent(e)&&scheduler.changeEventId(e,t)},this._dp_hook_delete=function(t,i){return scheduler.getEvent(t)?(t!=i&&("true_deleted"==this.getUserData(t,e.action_param)&&this.setUserData(t,e.action_param,"updated"),this.changeEventId(t,i)),this.deleteEvent(i,!0)):void 0},this.attachEvent("onEventAdded",function(t){!this._loading&&this._validId(t)&&e.setUpdated(t,!0,"inserted")}),this.attachEvent("onConfirmedBeforeEventDelete",function(t){if(this._validId(t)){var i=e.getState(t);return"inserted"==i||this._new_event?(e.setUpdated(t,!1),!0):"deleted"==i?!1:"true_deleted"==i?!0:(e.setUpdated(t,!0,"deleted"),!1)}}),this.attachEvent("onEventChanged",function(t){!this._loading&&this._validId(t)&&e.setUpdated(t,!0,"updated")}),scheduler.attachEvent("onClearAll",function(){e._in_progress={},e._invalid={},e.updatedRows=[],e._waitMode=0}),e._objToJson=function(t,i,n){n=n||"",i=i||{};for(var a in t)0!==a.indexOf("_")&&(t[a]&&t[a].getUTCFullYear?i[n+a]=this.obj.templates.xml_format(t[a]):t[a]&&"object"==typeof t[a]?e._objToJson(t[a],i,n+a+"."):i[n+a]=t[a]);return i},e._getRowData=function(e,t){var i=this.obj.getEvent(e);return this._objToJson(i)},e._clearUpdateFlag=function(){},e.attachEvent("insertCallback",scheduler._update_callback),e.attachEvent("updateCallback",scheduler._update_callback),e.attachEvent("deleteCallback",function(e,t){this.obj.getEvent(t)?(this.obj.setUserData(t,this.action_param,"true_deleted"),this.obj.deleteEvent(t)):this.obj._add_rec_marker&&this.obj._update_callback(e,t)})},scheduler._validId=function(e){return!0},scheduler.setUserData=function(e,t,i){if(e){var n=this.getEvent(e);n&&(n[t]=i)}else this._userdata[t]=i},scheduler.getUserData=function(e,t){if(e){var i=this.getEvent(e);return i?i[t]:null}return this._userdata[t]},scheduler._set_event_text_style=function(e,t){if(scheduler.getEvent(e)){this.for_rendered(e,function(e){e.style.cssText+=";"+t});var i=this.getEvent(e);i._text_style=t,this.event_updated(i)}},scheduler._update_callback=function(e,t){var i=scheduler._xmlNodeToJSON(e.firstChild);"none"==i.rec_type&&(i.rec_pattern="none"),i.text=i.text||i._tagvalue,i.start_date=scheduler.templates.xml_date(i.start_date),i.end_date=scheduler.templates.xml_date(i.end_date),scheduler.addEvent(i),scheduler._add_rec_marker&&scheduler.setCurrentView()},scheduler._skin_settings={fix_tab_position:[1,0],use_select_menu_space:[1,0],wide_form:[1,0],hour_size_px:[44,42],displayed_event_color:["#ff4a4a","ffc5ab"],displayed_event_text_color:["#ffef80","7e2727"]},scheduler._skin_xy={lightbox_additional_height:[90,50],nav_height:[59,22],bar_height:[24,20]},scheduler._configure=function(e,t,i){for(var n in t)"undefined"==typeof e[n]&&(e[n]=t[n][i])},scheduler._skin_init=function(){if(!scheduler.skin)for(var e=document.getElementsByTagName("link"),t=0;t<e.length;t++){var i=e[t].href.match("dhtmlxscheduler_([a-z]+).css");if(i){scheduler.skin=i[1];break}}var n=0;if(!scheduler.skin||"classic"!==scheduler.skin&&"glossy"!==scheduler.skin||(n=1),this._configure(scheduler.config,scheduler._skin_settings,n),this._configure(scheduler.xy,scheduler._skin_xy,n),"flat"===scheduler.skin&&(scheduler.xy.scale_height=35,scheduler.templates.hour_scale=function(e){var t=e.getMinutes();t=10>t?"0"+t:t;var i="<span class='dhx_scale_h'>"+e.getHours()+"</span><span class='dhx_scale_m'>&nbsp;"+t+"</span>";return i}),!n){var a=scheduler.config.minicalendar;a&&(a.padding=14),scheduler.templates.event_bar_date=function(e,t,i){return"• <b>"+scheduler.templates.event_date(e)+"</b> "},scheduler.attachEvent("onTemplatesReady",function(){var e=scheduler.date.date_to_str("%d");scheduler.templates._old_month_day||(scheduler.templates._old_month_day=scheduler.templates.month_day);var t=scheduler.templates._old_month_day;if(scheduler.templates.month_day=function(i){if("month"==this._mode){var n=e(i);return 1==i.getDate()&&(n=scheduler.locale.date.month_full[i.getMonth()]+" "+n),+i==+scheduler.date.date_part(this._currentDate())&&(n=scheduler.locale.labels.dhx_cal_today_button+" "+n),n}return t.call(this,i)},scheduler.config.fix_tab_position){for(var i=scheduler._els.dhx_cal_navline[0].getElementsByTagName("div"),n=null,a=211,r=0;r<i.length;r++){var s=i[r],l=s.getAttribute("name");if(l)switch(s.style.right="auto",l){case"day_tab":s.style.left="14px",s.className+=" dhx_cal_tab_first";break;case"week_tab":s.style.left="75px";break;case"month_tab":s.style.left="136px",s.className+=" dhx_cal_tab_last";break;default:s.style.left=a+"px",s.className+=" dhx_cal_tab_standalone",a=a+14+s.offsetWidth}else 0===(s.className||"").indexOf("dhx_minical_icon")&&s.parentNode==scheduler._els.dhx_cal_navline[0]&&(n=s)}n&&(n.style.left=a+"px")}}),scheduler._skin_init=function(){}}},window.jQuery&&!function(e){var t=0,i=[];e.fn.dhx_scheduler=function(n){if("string"!=typeof n){var a=[];return this.each(function(){if(this&&this.getAttribute)if(this.getAttribute("dhxscheduler"))a.push(window[this.getAttribute("dhxscheduler")]);else{var e="scheduler";t&&(e="scheduler"+(t+1),window[e]=Scheduler.getSchedulerInstance());var i=window[e];this.setAttribute("dhxscheduler",e);for(var r in n)"data"!=r&&(i.config[r]=n[r]);this.getElementsByTagName("div").length||(this.innerHTML='<div class="dhx_cal_navline"><div class="dhx_cal_prev_button">&nbsp;</div><div class="dhx_cal_next_button">&nbsp;</div><div class="dhx_cal_today_button"></div><div class="dhx_cal_date"></div><div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div><div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div><div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div></div><div class="dhx_cal_header"></div><div class="dhx_cal_data"></div>',this.className+=" dhx_cal_container"),i.init(this,i.config.date,i.config.mode),n.data&&i.parse(n.data),a.push(i),t++}}),1===a.length?a[0]:a}return i[n]?i[n].apply(this,[]):void e.error("Method "+n+" does not exist on jQuery.dhx_scheduler")}}(jQuery),function(){function e(e,t,i){t&&(e._date=t),i&&(e._mode=i)}var t=scheduler.setCurrentView,i=scheduler.updateView,n=null,a=null,r=function(t,r){var s=this;window.clearTimeout(a),window.clearTimeout(n),e(this,t,r),a=setTimeout(function(){s.callEvent("onBeforeViewChange",[s._mode,s._date,r||s._mode,t||s._date])&&(i.call(s,t,r),s.callEvent("onViewChange",[s._mode,s._date]),window.clearTimeout(n),a=0)},scheduler.config.delay_render)},s=function(t,r){var s=this,l=arguments;e(this,t,r),window.clearTimeout(n),n=setTimeout(function(){a||i.apply(s,l)},scheduler.config.delay_render)};scheduler.attachEvent("onSchedulerReady",function(){scheduler.config.delay_render?(scheduler.setCurrentView=r,scheduler.updateView=s):(scheduler.setCurrentView=t,scheduler.updateView=i)})}();for(var i=0;i<Scheduler._schedulerPlugins.length;i++)Scheduler._schedulerPlugins[i](scheduler);return scheduler._internal_id=Scheduler._seed++,Scheduler.$syncFactory&&Scheduler.$syncFactory(scheduler),scheduler},window.scheduler=Scheduler.getSchedulerInstance(),dhtmlx&&dhtmlx.attaches&&(dhtmlx.attaches.attachScheduler=function(e,t,i,n){var i=i||'<div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div><div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div><div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div>',a=document.createElement("DIV");return a.id="dhxSchedObj_"+this._genStr(12),a.innerHTML='<div id="'+a.id+'" class="dhx_cal_container" style="width:100%; height:100%;"><div class="dhx_cal_navline"><div class="dhx_cal_prev_button">&nbsp;</div><div class="dhx_cal_next_button">&nbsp;</div><div class="dhx_cal_today_button"></div><div class="dhx_cal_date"></div>'+i+'</div><div class="dhx_cal_header"></div><div class="dhx_cal_data"></div></div>',document.body.appendChild(a.firstChild),this.attachObject(a.id,!1,!0),this.vs[this.av].sched=n,this.vs[this.av].schedId=a.id,n.setSizes=n.updateView,n.destructor=function(){},n.init(a.id,e,t),this.vs[this._viewRestore()].sched}),Scheduler.plugin(function(e){e.config.limit_start=null,e.config.limit_end=null,e.config.limit_view=!1,e.config.check_limits=!0,e.config.mark_now=!0,e.config.display_marked_timespans=!0,e._temp_limit_scope=function(){function t(t,i,n,a,r){var s=e,l=[],o={_props:"map_to",matrix:"y_property"};for(var d in o){var h=o[d];if(s[d])for(var _ in s[d]){var c=s[d][_],u=c[h];t[u]&&(l=s._add_timespan_zones(l,e._get_blocked_zones(i[_],t[u],n,a,r)))}}return l=s._add_timespan_zones(l,e._get_blocked_zones(i,"global",n,a,r))}var i=null,n="dhx_time_block",a="default",r=function(e,t,i){return t instanceof Date&&i instanceof Date?(e.start_date=t,e.end_date=i):(e.days=t,e.zones=i),e},s=function(e,t,i){var a="object"==typeof e?e:{days:e};return a.type=n,a.css="",t&&(i&&(a.sections=i),a=r(a,e,t)),a};e.blockTime=function(t,i,n){var a=s(t,i,n);return e.addMarkedTimespan(a)},e.unblockTime=function(t,i,n){i=i||"fullday";var a=s(t,i,n);return e.deleteMarkedTimespan(a)},e.attachEvent("onBeforeViewChange",function(t,i,n,a){function r(t,i){var n=e.config.limit_start,a=e.config.limit_end,r=e.date.add(t,1,i);return t.valueOf()>a.valueOf()||r<=n.valueOf()}return e.config.limit_view&&(a=a||i,n=n||t,r(a,n)&&i.valueOf()!=a.valueOf())?(setTimeout(function(){var t=r(i,n)?e.config.limit_start:i;e.setCurrentView(r(t,n)?null:t,n)},1),!1):!0}),e.checkInMarkedTimespan=function(i,n,r){n=n||a;for(var s=!0,l=new Date(i.start_date.valueOf()),o=e.date.add(l,1,"day"),d=e._marked_timespans;l<i.end_date;l=e.date.date_part(o),o=e.date.add(l,1,"day")){var h=+e.date.date_part(new Date(l)),_=l.getDay(),c=t(i,d,_,h,n);if(c)for(var u=0;u<c.length;u+=2){var f=e._get_zone_minutes(l),m=i.end_date>o||i.end_date.getDate()!=l.getDate()?1440:e._get_zone_minutes(i.end_date),p=c[u],g=c[u+1];if(m>p&&g>f&&(s="function"==typeof r?r(i,f,m,p,g):!1,!s))break}}return!s};var l=e.checkLimitViolation=function(t){if(!t)return!0;if(!e.config.check_limits)return!0;var i=e,a=i.config,r=[];if(t.rec_type)for(var s=e.getRecDates(t),l=0;l<s.length;l++){var o=e._copy_event(t);e._lame_copy(o,s[l]),r.push(o)}else r=[t];for(var d=!0,h=0;h<r.length;h++){var _=!0,o=r[h];o._timed=e.isOneDayEvent(o),_=a.limit_start&&a.limit_end?o.start_date.valueOf()>=a.limit_start.valueOf()&&o.end_date.valueOf()<=a.limit_end.valueOf():!0,_&&(_=!e.checkInMarkedTimespan(o,n,function(e,t,n,a,r){var s=!0;return r>=t&&t>=a&&((1440==r||r>n)&&(s=!1),e._timed&&i._drag_id&&"new-size"==i._drag_mode?(e.start_date.setHours(0),e.start_date.setMinutes(r)):s=!1),(n>=a&&r>n||a>t&&n>r)&&(e._timed&&i._drag_id&&"new-size"==i._drag_mode?(e.end_date.setHours(0),e.end_date.setMinutes(a)):s=!1),s})),_||(_=i.checkEvent("onLimitViolation")?i.callEvent("onLimitViolation",[o.id,o]):_),d=d&&_}return d||(i._drag_id=null,i._drag_mode=null),d};e._get_blocked_zones=function(e,t,i,n,a){var r=[];if(e&&e[t])for(var s=e[t],l=this._get_relevant_blocked_zones(i,n,s,a),o=0;o<l.length;o++)r=this._add_timespan_zones(r,l[o].zones);return r},e._get_relevant_blocked_zones=function(e,t,i,n){var a=i[t]&&i[t][n]?i[t][n]:i[e]&&i[e][n]?i[e][n]:[];return a},e.attachEvent("onMouseDown",function(e){return!(e==n)}),e.attachEvent("onBeforeDrag",function(t){return t?l(e.getEvent(t)):!0}),e.attachEvent("onClick",function(t,i){return l(e.getEvent(t))}),e.attachEvent("onBeforeLightbox",function(t){var n=e.getEvent(t);return i=[n.start_date,n.end_date],l(n)}),e.attachEvent("onEventSave",function(t,i,n){if(!i.start_date||!i.end_date){var a=e.getEvent(t);i.start_date=new Date(a.start_date),i.end_date=new Date(a.end_date)}if(i.rec_type){var r=e._lame_clone(i);return e._roll_back_dates(r),l(r)}return l(i)}),e.attachEvent("onEventAdded",function(t){if(!t)return!0;var i=e.getEvent(t);return!l(i)&&e.config.limit_start&&e.config.limit_end&&(i.start_date<e.config.limit_start&&(i.start_date=new Date(e.config.limit_start)),i.start_date.valueOf()>=e.config.limit_end.valueOf()&&(i.start_date=this.date.add(e.config.limit_end,-1,"day")),i.end_date<e.config.limit_start&&(i.end_date=new Date(e.config.limit_start)),i.end_date.valueOf()>=e.config.limit_end.valueOf()&&(i.end_date=this.date.add(e.config.limit_end,-1,"day")),i.start_date.valueOf()>=i.end_date.valueOf()&&(i.end_date=this.date.add(i.start_date,this.config.event_duration||this.config.time_step,"minute")),
i._timed=this.isOneDayEvent(i)),!0}),e.attachEvent("onEventChanged",function(t){if(!t)return!0;var n=e.getEvent(t);if(!l(n)){if(!i)return!1;n.start_date=i[0],n.end_date=i[1],n._timed=this.isOneDayEvent(n)}return!0}),e.attachEvent("onBeforeEventChanged",function(e,t,i){return l(e)}),e.attachEvent("onBeforeEventCreated",function(t){var i=e.getActionData(t).date,n={_timed:!0,start_date:i,end_date:e.date.add(i,e.config.time_step,"minute")};return l(n)}),e.attachEvent("onViewChange",function(){e._mark_now()}),e.attachEvent("onSchedulerResize",function(){return window.setTimeout(function(){e._mark_now()},1),!0}),e.attachEvent("onTemplatesReady",function(){e._mark_now_timer=window.setInterval(function(){e._is_initialized()&&e._mark_now()},6e4)}),e._mark_now=function(t){var i="dhx_now_time";this._els[i]||(this._els[i]=[]);var n=e._currentDate(),a=this.config;if(e._remove_mark_now(),!t&&a.mark_now&&n<this._max_date&&n>this._min_date&&n.getHours()>=a.first_hour&&n.getHours()<a.last_hour){var r=this.locate_holder_day(n);this._els[i]=e._append_mark_now(r,n)}},e._append_mark_now=function(t,i){var n="dhx_now_time",a=e._get_zone_minutes(i),r={zones:[a,a+1],css:n,type:n};if(!this._table_view){if(this._props&&this._props[this._mode]){var s,l,o=this._props[this._mode],d=o.size||o.options.length;o.days>1?(s=t,l=t+d):(s=0,l=s+d);for(var h=[],_=s;l>_;_++){var c=_;r.days=c;var u=e._render_marked_timespan(r,null,c)[0];h.push(u)}return h}return r.days=t,e._render_marked_timespan(r,null,t)}return"month"==this._mode?(r.days=+e.date.date_part(i),e._render_marked_timespan(r,null,null)):void 0},e._remove_mark_now=function(){for(var e="dhx_now_time",t=this._els[e],i=0;i<t.length;i++){var n=t[i],a=n.parentNode;a&&a.removeChild(n)}this._els[e]=[]},e._marked_timespans={global:{}},e._get_zone_minutes=function(e){return 60*e.getHours()+e.getMinutes()},e._prepare_timespan_options=function(t){var i=[],n=[];if("fullweek"==t.days&&(t.days=[0,1,2,3,4,5,6]),t.days instanceof Array){for(var r=t.days.slice(),s=0;s<r.length;s++){var l=e._lame_clone(t);l.days=r[s],i.push.apply(i,e._prepare_timespan_options(l))}return i}if(!t||!(t.start_date&&t.end_date&&t.end_date>t.start_date||void 0!==t.days&&t.zones)&&!t.type)return i;var o=0,d=1440;"fullday"==t.zones&&(t.zones=[o,d]),t.zones&&t.invert_zones&&(t.zones=e.invertZones(t.zones)),t.id=e.uid(),t.css=t.css||"",t.type=t.type||a;var h=t.sections;if(h){for(var _ in h)if(h.hasOwnProperty(_)){var c=h[_];c instanceof Array||(c=[c]);for(var s=0;s<c.length;s++){var u=e._lame_copy({},t);u.sections={},u.sections[_]=c[s],n.push(u)}}}else n.push(t);for(var f=0;f<n.length;f++){var m=n[f],p=m.start_date,g=m.end_date;if(p&&g)for(var v=e.date.date_part(new Date(p)),x=e.date.add(v,1,"day");g>v;){var u=e._lame_copy({},m);delete u.start_date,delete u.end_date,u.days=v.valueOf();var y=p>v?e._get_zone_minutes(p):o,b=g>x||g.getDate()!=v.getDate()?d:e._get_zone_minutes(g);u.zones=[y,b],i.push(u),v=x,x=e.date.add(x,1,"day")}else m.days instanceof Date&&(m.days=e.date.date_part(m.days).valueOf()),m.zones=t.zones.slice(),i.push(m)}return i},e._get_dates_by_index=function(t,i,n){var a=[];i=e.date.date_part(new Date(i||e._min_date)),n=new Date(n||e._max_date);for(var r=i.getDay(),s=t-r>=0?t-r:7-i.getDay()+t,l=e.date.add(i,s,"day");n>l;l=e.date.add(l,1,"week"))a.push(l);return a},e._get_css_classes_by_config=function(e){var t=[];return e.type==n&&(t.push(n),e.css&&t.push(n+"_reset")),t.push("dhx_marked_timespan",e.css),t.join(" ")},e._get_block_by_config=function(e){var t=document.createElement("DIV");return e.html&&("string"==typeof e.html?t.innerHTML=e.html:t.appendChild(e.html)),t},e._render_marked_timespan=function(t,i,n){var a=[],r=e.config,s=this._min_date,l=this._max_date,o=!1;if(!r.display_marked_timespans)return a;if(!n&&0!==n){if(t.days<7)n=t.days;else{var d=new Date(t.days);if(o=+d,!(+l>+d&&+d>=+s))return a;n=d.getDay()}var h=s.getDay();h>n?n=7-(h-n):n-=h}var _=t.zones,c=e._get_css_classes_by_config(t);if(e._table_view&&"month"==e._mode){var u=[],f=[];if(i)u.push(i),f.push(n);else{f=o?[o]:e._get_dates_by_index(n);for(var m=0;m<f.length;m++)u.push(this._scales[f[m]])}for(var m=0;m<u.length;m++){i=u[m],n=f[m];var p=Math.floor((this._correct_shift(n,1)-s.valueOf())/(864e5*this._cols.length)),g=this.locate_holder_day(n,!1)%this._cols.length;if(!this._ignores[g]){var v=e._get_block_by_config(t),x=Math.max(i.offsetHeight-1,0),y=Math.max(i.offsetWidth-1,0),b=this._colsS[g],w=this._colsS.heights[p]+(this._colsS.height?this.xy.month_scale_height+2:2)-1;v.className=c,v.style.top=w+"px",v.style.lineHeight=v.style.height=x+"px";for(var D=0;D<_.length;D+=2){var P=_[m],E=_[m+1];if(P>=E)return[];var k=v.cloneNode(!0);k.style.left=b+Math.round(P/1440*y)+"px",k.style.width=Math.round((E-P)/1440*y)+"px",i.appendChild(k),a.push(k)}}}}else{var M=n;if(this._ignores[this.locate_holder_day(n,!1)])return a;if(this._props&&this._props[this._mode]&&t.sections&&t.sections[this._mode]){var S=this._props[this._mode];M=S.order[t.sections[this._mode]];var N=S.order[t.sections[this._mode]];if(S.days>1){var O=S.size||S.options.length;M=M*O+N}else M=N,S.size&&M>S.position+S.size&&(M=0)}i=i?i:e.locate_holder(M);for(var m=0;m<_.length;m+=2){var P=Math.max(_[m],60*r.first_hour),E=Math.min(_[m+1],60*r.last_hour);if(P>=E){if(m+2<_.length)continue;return[]}var k=e._get_block_by_config(t);k.className=c;var A=24*this.config.hour_size_px+1,L=36e5;k.style.top=Math.round((60*P*1e3-this.config.first_hour*L)*this.config.hour_size_px/L)%A+"px",k.style.lineHeight=k.style.height=Math.max(Math.round(60*(E-P)*1e3*this.config.hour_size_px/L)%A,1)+"px",i.appendChild(k),a.push(k)}}return a},e._mark_timespans=function(){var t=this._els.dhx_cal_data[0],i=[];if(e._table_view&&"month"==e._mode)for(var n in this._scales){var a=new Date(+n);i.push.apply(i,e._on_scale_add_marker(this._scales[n],a))}else for(var a=new Date(e._min_date),r=0,s=t.childNodes.length;s>r;r++){var l=t.childNodes[r];l.firstChild&&e._getClassName(l.firstChild).indexOf("dhx_scale_hour")>-1||(i.push.apply(i,e._on_scale_add_marker(l,a)),a=e.date.add(a,1,"day"))}return i},e.markTimespan=function(t){var i=!1;this._els.dhx_cal_data||(e.get_elements(),i=!0);var n=e._marked_timespans_ids,a=e._marked_timespans_types,r=e._marked_timespans;e.deleteMarkedTimespan(),e.addMarkedTimespan(t);var s=e._mark_timespans();return i&&(e._els=[]),e._marked_timespans_ids=n,e._marked_timespans_types=a,e._marked_timespans=r,s},e.unmarkTimespan=function(e){if(e)for(var t=0;t<e.length;t++){var i=e[t];i.parentNode&&i.parentNode.removeChild(i)}},e._addMarkerTimespanConfig=function(t){var i="global",n=e._marked_timespans,a=t.id,r=e._marked_timespans_ids;r[a]||(r[a]=[]);var s=t.days,l=t.sections,o=t.type;if(t.id=a,l){for(var d in l)if(l.hasOwnProperty(d)){n[d]||(n[d]={});var h=l[d],_=n[d];_[h]||(_[h]={}),_[h][s]||(_[h][s]={}),_[h][s][o]||(_[h][s][o]=[],e._marked_timespans_types||(e._marked_timespans_types={}),e._marked_timespans_types[o]||(e._marked_timespans_types[o]=!0));var c=_[h][s][o];t._array=c,c.push(t),r[a].push(t)}}else{n[i][s]||(n[i][s]={}),n[i][s][o]||(n[i][s][o]=[]),e._marked_timespans_types||(e._marked_timespans_types={}),e._marked_timespans_types[o]||(e._marked_timespans_types[o]=!0);var c=n[i][s][o];t._array=c,c.push(t),r[a].push(t)}},e._marked_timespans_ids={},e.addMarkedTimespan=function(t){var i=e._prepare_timespan_options(t);if(i.length){for(var n=i[0].id,a=0;a<i.length;a++)e._addMarkerTimespanConfig(i[a]);return n}},e._add_timespan_zones=function(e,t){var i=e.slice();if(t=t.slice(),!i.length)return t;for(var n=0;n<i.length;n+=2)for(var a=i[n],r=i[n+1],s=n+2==i.length,l=0;l<t.length;l+=2){var o=t[l],d=t[l+1];if(d>r&&r>=o||a>o&&d>=a)i[n]=Math.min(a,o),i[n+1]=Math.max(r,d),n-=2;else{if(!s)continue;var h=a>o?0:2;i.splice(n+h,0,o,d)}t.splice(l--,2);break}return i},e._subtract_timespan_zones=function(e,t){for(var i=e.slice(),n=0;n<i.length;n+=2)for(var a=i[n],r=i[n+1],s=0;s<t.length;s+=2){var l=t[s],o=t[s+1];if(o>a&&r>l){var d=!1;a>=l&&o>=r&&i.splice(n,2),l>a&&(i.splice(n,2,a,l),d=!0),r>o&&i.splice(d?n+2:n,d?0:2,o,r),n-=2;break}}return i},e.invertZones=function(t){return e._subtract_timespan_zones([0,1440],t.slice())},e._delete_marked_timespan_by_id=function(t){var i=e._marked_timespans_ids[t];if(i)for(var n=0;n<i.length;n++)for(var a=i[n],r=a._array,s=0;s<r.length;s++)if(r[s]==a){r.splice(s,1);break}},e._delete_marked_timespan_by_config=function(t){var i,n=e._marked_timespans,r=t.sections,s=t.days,l=t.type||a;if(r){for(var o in r)if(r.hasOwnProperty(o)&&n[o]){var d=r[o];n[o][d]&&(i=n[o][d])}}else i=n.global;if(i)if(void 0!==s)i[s]&&i[s][l]&&(e._addMarkerTimespanConfig(t),e._delete_marked_timespans_list(i[s][l],t));else for(var h in i)if(i[h][l]){var _=e._lame_clone(t);t.days=h,e._addMarkerTimespanConfig(_),e._delete_marked_timespans_list(i[h][l],t)}},e._delete_marked_timespans_list=function(t,i){for(var n=0;n<t.length;n++){var a=t[n],r=e._subtract_timespan_zones(a.zones,i.zones);if(r.length)a.zones=r;else{t.splice(n,1),n--;for(var s=e._marked_timespans_ids[a.id],l=0;l<s.length;l++)if(s[l]==a){s.splice(l,1);break}}}},e.deleteMarkedTimespan=function(t){if(arguments.length||(e._marked_timespans={global:{}},e._marked_timespans_ids={},e._marked_timespans_types={}),"object"!=typeof t)e._delete_marked_timespan_by_id(t);else{t.start_date&&t.end_date||(void 0!==t.days||t.type||(t.days="fullweek"),t.zones||(t.zones="fullday"));var i=[];if(t.type)i.push(t.type);else for(var n in e._marked_timespans_types)i.push(n);for(var a=e._prepare_timespan_options(t),r=0;r<a.length;r++)for(var s=a[r],l=0;l<i.length;l++){var o=e._lame_clone(s);o.type=i[l],e._delete_marked_timespan_by_config(o)}}},e._get_types_to_render=function(t,i){var n=t?e._lame_copy({},t):{};for(var a in i||{})i.hasOwnProperty(a)&&(n[a]=i[a]);return n},e._get_configs_to_render=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push.apply(t,e[i]);return t},e._on_scale_add_marker=function(t,i){if(!e._table_view||"month"==e._mode){var n=i.getDay(),a=i.valueOf(),r=this._mode,s=e._marked_timespans,l=[],o=[];if(this._props&&this._props[r]){var d=this._props[r],h=d.options,_=e._get_unit_index(d,i),c=h[_];if(d.days>1){var u=864e5,f=Math.round((i-e._min_date)/u);i=e.date.add(e._min_date,Math.floor(f/h.length),"day"),i=e.date.date_part(i)}else i=e.date.date_part(new Date(this._date));if(n=i.getDay(),a=i.valueOf(),s[r]&&s[r][c.key]){var m=s[r][c.key],p=e._get_types_to_render(m[n],m[a]);l.push.apply(l,e._get_configs_to_render(p))}}var g=s.global,v=g[a]||g[n];l.push.apply(l,e._get_configs_to_render(v));for(var x=0;x<l.length;x++)o.push.apply(o,e._render_marked_timespan(l[x],t,i));return o}},e.attachEvent("onScaleAdd",function(){e._on_scale_add_marker.apply(e,arguments)}),e.dblclick_dhx_marked_timespan=function(t,i){e.callEvent("onScaleDblClick",[e.getActionData(t).date,i,t]),e.config.dblclick_create&&e.addEventNow(e.getActionData(t).date,null,t)}},e._temp_limit_scope()}),Scheduler.plugin(function(e){e._temp_matrix_scope=function(){e.matrix={},e._merge=function(e,t){for(var i in t)"undefined"==typeof e[i]&&(e[i]=t[i])},e.createTimelineView=function(t){e._skin_init(),e._merge(t,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:e.xy.bar_height-5,event_min_dy:e.xy.bar_height-5,resize_events:!0,fit_events:!0,show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(t,i,n){var a={};return e.checkEvent("onBeforeSectionRender")&&(a=e.callEvent("onBeforeSectionRender",[t,i,n])),a}}),t._original_x_start=t.x_start,"day"!=t.x_unit&&(t.first_hour=t.last_hour=0),t._start_correction=t.first_hour?60*t.first_hour*60*1e3:0,t._end_correction=t.last_hour?60*(24-t.last_hour)*60*1e3:0,e.checkEvent("onTimelineCreated")&&e.callEvent("onTimelineCreated",[t]);var i=e.render_data;e.render_data=function(n,a){if(this._mode!=t.name)return i.apply(this,arguments);if(a&&!t.show_unassigned&&"cell"!=t.render)for(var r=0;r<n.length;r++)this.clear_event(n[r]),this.render_timeline_event.call(this.matrix[this._mode],n[r],!0);else e._renderMatrix.call(t,!0,!0)},e.matrix[t.name]=t,e.templates[t.name+"_cell_value"]=function(e){return e?e.length:""},e.templates[t.name+"_cell_class"]=function(e){return""},e.templates[t.name+"_scalex_class"]=function(e){return""},e.templates[t.name+"_second_scalex_class"]=function(e){return""},e.templates[t.name+"_scaley_class"]=function(e,t,i){return""},e.templates[t.name+"_scale_label"]=function(e,t,i){return t},e.templates[t.name+"_tooltip"]=function(e,t,i){return i.text},e.templates[t.name+"_date"]=function(t,i){return t.getDay()==i.getDay()&&864e5>i-t||+t==+e.date.date_part(new Date(i))||+e.date.add(t,1,"day")==+i&&0===i.getHours()&&0===i.getMinutes()?e.templates.day_date(t):t.getDay()!=i.getDay()&&864e5>i-t?e.templates.day_date(t)+" &ndash; "+e.templates.day_date(i):e.templates.week_date(t,i)},e.templates[t.name+"_scale_date"]=e.date.date_to_str(t.x_date||e.config.hour_date),e.templates[t.name+"_second_scale_date"]=e.date.date_to_str(t.second_scale&&t.second_scale.x_date?t.second_scale.x_date:e.config.hour_date),e.date["add_"+t.name+"_private"]=function(i,n){var a=n,r=t.x_unit;if("minute"==t.x_unit||"hour"==t.x_unit){var s=a;"hour"==t.x_unit&&(s*=60),s%1440||(a=s/1440,r="day")}return e.date.add(i,a,r)},e.date["add_"+t.name]=function(i,n,a){var r=e.date["add_"+t.name+"_private"](i,(t.x_length||t.x_size)*t.x_step*n);if("minute"==t.x_unit||"hour"==t.x_unit){var s=t.x_length||t.x_size,l="hour"==t.x_unit?60*t.x_step:t.x_step;if(l*s%1440)if(+e.date.date_part(new Date(i))==+e.date.date_part(new Date(r)))t.x_start+=n*s;else{var o=1440/(s*l)-1,d=Math.round(o*s);n>0?t.x_start=t.x_start-d:t.x_start=d+t.x_start}}return r},e.date[t.name+"_start"]=function(i){var n=e.date[t.x_unit+"_start"]||e.date.day_start,a=n.call(e.date,i),r=a.getTimezoneOffset();a=e.date.add(a,t.x_step*t.x_start,t.x_unit);var s=a.getTimezoneOffset();return r!=s&&a.setTime(a.getTime()+6e4*(s-r)),a},e.callEvent("onOptionsLoad",[t]),e[t.name+"_view"]=function(i){i?e._set_timeline_dates(t):e._renderMatrix.apply(t,arguments)};var n=new Date;e.date.add(n,t.x_step,t.x_unit).valueOf()-n.valueOf();e["mouse_"+t.name]=function(i){var n=this._drag_event;this._drag_id&&(n=this.getEvent(this._drag_id)),i.x-=t.dx;var a=e._timeline_drag_date(t,i.x);if(i.x=0,i.force_redraw=!0,i.custom=!0,"move"==this._drag_mode&&this._drag_id&&this._drag_event){var n=this.getEvent(this._drag_id),r=this._drag_event;if(i._ignores=this._ignores_detected||t._start_correction||t._end_correction,void 0===r._move_delta&&(r._move_delta=(n.start_date-a)/6e4,this.config.preserve_length&&i._ignores&&(r._move_delta=this._get_real_event_length(n.start_date,a,t),r._event_length=this._get_real_event_length(n.start_date,n.end_date,t))),this.config.preserve_length&&i._ignores){var s=(r._event_length,this._get_fictional_event_length(a,r._move_delta,t,!0));a=new Date(a-s)}else a=e.date.add(a,r._move_delta,"minute")}if("resize"==this._drag_mode&&n&&(this.config.timeline_swap_resize&&this._drag_id&&(this._drag_from_start&&+a>+n.end_date?this._drag_from_start=!1:!this._drag_from_start&&+a<+n.start_date&&(this._drag_from_start=!0)),i.resize_from_start=this._drag_from_start,!this.config.timeline_swap_resize&&this._drag_id&&this._drag_from_start&&+a>=+e.date.add(n.end_date,-e.config.time_step,"minute")&&(a=e.date.add(n.end_date,-e.config.time_step,"minute"))),t.round_position)switch(this._drag_mode){case"move":this.config.preserve_length||(a=e._timeline_get_rounded_date.call(t,a,!1),"day"==t.x_unit&&(i.custom=!1));break;case"resize":this._drag_event&&((null===this._drag_event._resize_from_start||void 0===this._drag_event._resize_from_start)&&(this._drag_event._resize_from_start=i.resize_from_start),i.resize_from_start=this._drag_event._resize_from_start,a=e._timeline_get_rounded_date.call(t,a,!this._drag_event._resize_from_start))}this._resolve_timeline_section(t,i),i.section&&this._update_timeline_section({pos:i,event:this.getEvent(this._drag_id),view:t}),i.y=Math.round((this._correct_shift(a,1)-this._min_date)/(6e4*this.config.time_step)),i.shift=this.config.time_step,t.round_position&&"new-size"==this._drag_mode&&a<=this._drag_start&&(i.shift=e.date.add(this._drag_start,t.x_step,t.x_unit)-this._drag_start);var l=this._is_pos_changed(this._drag_pos,i);return this._drag_pos&&l&&(this._drag_event._dhx_changed=!0),l||this._drag_pos.has_moved||(i.force_redraw=!1),i}},e._prepare_timeline_events=function(t){var i=[];if("cell"==t.render)i=e._timeline_trace_events.call(t);else for(var n=e.get_visible_events(),a=t.order,r=0;r<n.length;r++){var s=n[r],l=s[t.y_property],o=t.order[l];if(t.show_unassigned&&!l){for(var d in a)if(a.hasOwnProperty(d)){o=a[d],i[o]||(i[o]=[]);var h=e._lame_copy({},s);h[t.y_property]=d,i[o].push(h)}}else i[o]||(i[o]=[]),i[o].push(s)}return i},e._populate_timeline_rendered=function(t){e._rendered=[];for(var i=t.getElementsByTagName("DIV"),n=0;n<i.length;n++)i[n].getAttribute("event_id")&&e._rendered.push(i[n])},e._get_timeline_event_height=function(e,t){var i=e[t.y_property],n=t.event_dy;return"full"==t.event_dy&&(n=t.section_autoheight?t._section_height[i]-6:t.dy-3),t.resize_events&&(n=Math.max(Math.floor(n/e._count),t.event_min_dy)),n},e._get_timeline_event_y=function(t,i){var n=t,a=2+n*i+(n?2*n:0);return e.config.cascade_event_display&&(a=2+n*e.config.cascade_event_margin+(n?2*n:0)),a},e.render_timeline_event=function(t,i){var n=t[this.y_property];if(!n)return"";var a=t._sorder,r=e._timeline_getX(t,!1,this),s=e._timeline_getX(t,!0,this),l=e._get_timeline_event_height(t,this),o=l-2;t._inner||"full"!=this.event_dy||(o=(o+2)*(t._count-a)-2);var d=e._get_timeline_event_y(t._sorder,l),h=l+d+2;(!this._events_height[n]||this._events_height[n]<h)&&(this._events_height[n]=h);var _=e.templates.event_class(t.start_date,t.end_date,t);_="dhx_cal_event_line "+(_||""),t._no_drag_move&&(_+=" no_drag_move");var c=t.color?"background:"+t.color+";":"",u=t.textColor?"color:"+t.textColor+";":"",f=e.templates.event_bar_text(t.start_date,t.end_date,t),m="<div "+e._waiAria.eventBarAttrString(t)+" event_id='"+t.id+"' class='"+_+"' style='"+c+u+"position:absolute; top:"+d+"px; height: "+o+"px; left:"+r+"px; width:"+Math.max(0,s-r)+"px;"+(t._text_style||"")+"'>";if(e.config.drag_resize&&!e.config.readonly){var p="dhx_event_resize",g="<div class='"+p+" "+p+"_start' style='height: "+o+"px;'></div>",v="<div class='"+p+" "+p+"_end' style='height: "+o+"px;'></div>";m+=(t._no_resize_start?"":g)+(t._no_resize_end?"":v)}if(m+=f+"</div>",!i)return m;var x=document.createElement("DIV");x.innerHTML=m;var y=this.order[n],b=e._els.dhx_cal_data[0].firstChild.rows[y];if(b){var w=b.cells[1].firstChild;e._rendered.push(x.firstChild),w.appendChild(x.firstChild)}},e._timeline_trace_events=function(){for(var t=e.get_visible_events(),i=[],n=0;n<this.y_unit.length;n++)i[n]=[];var a;i[a]||(i[a]=[]);for(var n=0;n<t.length;n++){a=this.order[t[n][this.y_property]];for(var r=0;this._trace_x[r+1]&&t[n].start_date>=this._trace_x[r+1];)r++;for(;this._trace_x[r]&&t[n].end_date>this._trace_x[r];)i[a][r]||(i[a][r]=[]),i[a][r].push(t[n]),r++}return i},e._timeline_getX=function(t,i,n){var a=0,r=n._step,s=n.round_position,l=0,o=i?t.end_date:t.start_date;o.valueOf()>e._max_date.valueOf()&&(o=e._max_date);var d=o-e._min_date_timeline;if(d>0){var h=e._get_date_index(n,o);e._ignores[h]&&(s=!0);for(var _=0;h>_;_++)a+=e._cols[_];var c=e._timeline_get_rounded_date.apply(n,[o,!1]);s?+o>+c&&i&&(l=e._cols[h]):(d=o-c,n.first_hour||n.last_hour?(d-=n._start_correction,0>d&&(d=0),l=Math.round(d/r),l>e._cols[h]&&(l=e._cols[h])):l=Math.round(d/r))}return a+=i?0===d||s?l-14:l-12:l+1},e._timeline_get_rounded_date=function(t,i){var n=e._get_date_index(this,t),a=this._trace_x[n];return i&&+t!=+this._trace_x[n]&&(a=this._trace_x[n+1]?this._trace_x[n+1]:e.date.add(this._trace_x[n],this.x_step,this.x_unit)),new Date(a)},e._timeline_skip_ignored=function(t){if(e._ignores_detected)for(var i,n,a,r,s=0;s<t.length;s++){for(r=t[s],a=!1,i=e._get_date_index(this,r.start_date),n=e._get_date_index(this,r.end_date);n>i;){if(!e._ignores[i]){a=!0;break}i++}a||i!=n||e._ignores[n]||+r.end_date>+this._trace_x[n]&&(a=!0),a||(t.splice(s,1),s--)}},e._timeline_get_events_html=function(t){var i="";if(t&&"cell"!=this.render){e._timeline_skip_ignored.call(this,t),t.sort(this.sort||function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});for(var n=[],a=t.length,r=0;a>r;r++){var s=t[r];s._inner=!1;var l=this.round_position?e._timeline_get_rounded_date.apply(this,[s.start_date,!1]):s.start_date;for(this.round_position?e._timeline_get_rounded_date.apply(this,[s.end_date,!0]):s.end_date;n.length;){var o=n[n.length-1];if(!(o.end_date.valueOf()<=l.valueOf()))break;n.splice(n.length-1,1)}for(var d=!1,h=0;h<n.length;h++){var _=n[h];if(_.end_date.valueOf()<=l.valueOf()){d=!0,s._sorder=_._sorder,n.splice(h,1),s._inner=!0;break}}if(n.length&&(n[n.length-1]._inner=!0),!d)if(n.length)if(n.length<=n[n.length-1]._sorder){if(n[n.length-1]._sorder)for(var c=0;c<n.length;c++){for(var u=!1,f=0;f<n.length;f++)if(n[f]._sorder==c){u=!0;break}if(!u){s._sorder=c;break}}else s._sorder=0;s._inner=!0}else{for(var m=n[0]._sorder,p=1;p<n.length;p++)n[p]._sorder>m&&(m=n[p]._sorder);s._sorder=m+1,s._inner=!1}else s._sorder=0;n.push(s),n.length>(n.max_count||0)?(n.max_count=n.length,s._count=n.length):s._count=s._count?s._count:1}for(var g=0;g<t.length;g++)t[g]._count=n.max_count;for(var v=0;a>v;v++)i+=e.render_timeline_event.call(this,t[v],!1)}return i},e._timeline_y_scale=function(t){var i="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>";e._load_mode&&e._load();for(var n=e._prepare_timeline_events(this),a=0,r=0;r<e._cols.length;r++)a+=e._cols[r];var s=new Date,l=e._cols.length-e._ignores_detected;s=(e.date.add(s,this.x_step*l,this.x_unit)-s-(this._start_correction+this._end_correction)*l)/a,this._step=s,this._summ=a;var o=e._colsS.heights=[],d=[];this._events_height={},this._section_height={};for(var r=0;r<this.y_unit.length;r++){var h=this._logic(this.render,this.y_unit[r],this);e._merge(h,{height:this.dy}),this.section_autoheight&&(this.y_unit.length*h.height<t.offsetHeight&&(h.height=Math.max(h.height,Math.floor((t.offsetHeight-1)/this.y_unit.length))),this._section_height[this.y_unit[r].key]=h.height),h.td_className||(h.td_className="dhx_matrix_scell"+(e.templates[this.name+"_scaley_class"](this.y_unit[r].key,this.y_unit[r].label,this.y_unit[r])?" "+e.templates[this.name+"_scaley_class"](this.y_unit[r].key,this.y_unit[r].label,this.y_unit[r]):"")),h.td_content||(h.td_content=e.templates[this.name+"_scale_label"](this.y_unit[r].key,this.y_unit[r].label,this.y_unit[r])),e._merge(h,{tr_className:"",style_height:"height:"+h.height+"px;",style_width:"width:"+this.dx+"px;",summ_width:"width:"+a+"px;",table_className:""});var _=e._timeline_get_events_html.call(this,n[r]);if(this.fit_events){var c=this._events_height[this.y_unit[r].key]||0;h.height=c>h.height?c:h.height,h.style_height="height:"+h.height+"px;",this._section_height[this.y_unit[r].key]=h.height}if(i+="<tr class='"+h.tr_className+"' style='"+h.style_height+"'><td class='"+h.td_className+"' style='"+h.style_width+" height:"+(h.height-1)+"px;' "+e._waiAria.label(h.td_content)+">"+h.td_content+"</td>","cell"==this.render)for(var u=0;u<e._cols.length;u++)i+=e._ignores[u]?"<td></td>":"<td class='dhx_matrix_cell "+e.templates[this.name+"_cell_class"](n[r][u],this._trace_x[u],this.y_unit[r])+"' style='width:"+e._cols[u]+"px'><div style='width:auto'>"+e.templates[this.name+"_cell_value"](n[r][u],this._trace_x[u],this.y_unit[r])+"</div></td>";else{i+="<td><div style='"+h.summ_width+" "+h.style_height+" position:relative;' class='dhx_matrix_line'>",i+=_,i+="<table class='"+h.table_className+"' cellpadding='0' cellspacing='0' style='"+h.summ_width+" "+h.style_height+"' >";for(var u=0;u<e._cols.length;u++)if(e._ignores[u])i+="<td></td>";else{var f=e.templates[this.name+"_cell_value"](this._trace_x[u],this.y_unit[r]);i+=f?"<td class='dhx_matrix_cell custom_cell"+e.templates[this.name+"_cell_class"](n[r],this._trace_x[u],this.y_unit[r])+"' style='width:"+e._cols[u]+"px'>"+e.templates[this.name+"_cell_value"](this._trace_x[u],this.y_unit[r])+"</td>":"<td class='dhx_matrix_cell "+e.templates[this.name+"_cell_class"](n[r],this._trace_x[u],this.y_unit[r])+"' style='width:"+(e._cols[u]-1)+"px'><div style='width:"+(e._cols[u]-1)+"px'></div></td>"}i+="</table>",i+="</div></td>"}i+="</tr>",d.push(h)}i+="</table>",this._matrix=n,t.innerHTML=i,e._populate_timeline_rendered(t),this._scales={};for(var m=t.firstChild.rows,p=null,r=0,g=d.length;g>r;r++){p=this.y_unit[r],o.push(d[r].height);var v=p.key,x=this._scales[v]=e._isRender("cell")?m[r]:m[r].childNodes[1].getElementsByTagName("div")[0];e.callEvent("onScaleAdd",[x,v])}},e._timeline_x_dates=function(t){var i=e._min_date,n=e._max_date;e._process_ignores(i,this.x_size,this.x_unit,this.x_step,t);for(var a=(this.x_size+(t?e._ignores_detected:0),0),r=0;+n>+i;)if(this._trace_x[r]=new Date(i),"month"==this.x_unit&&e.date[this.x_unit+"_start"]&&(i=e.date[this.x_unit+"_start"](new Date(i))),i=e.date.add(i,this.x_step,this.x_unit),e.date[this.x_unit+"_start"]&&(i=e.date[this.x_unit+"_start"](i)),e._ignores[r]||a++,r++,t)if(a<this.x_size&&!(+n>+i))n=e.date["add_"+this.name+"_private"](n,(this.x_length||this.x_size)*this.x_step);else if(a>=this.x_size){e._max_date=i;break}return{total:r,displayed:a}},e._timeline_x_scale=function(t){var i=e.xy.scale_height,n=this._header_resized||e.xy.scale_height;e._cols=[],e._colsS={height:0},this._trace_x=[];var a=e._x-this.dx-e.xy.scroll_width,r=[this.dx],s=e._els.dhx_cal_header[0];s.style.width=r[0]+a+"px";for(var l=e._min_date_timeline=e._min_date,o=e.config.preserve_scale_length,d=e._timeline_x_dates.call(this,o),h=d.displayed,_=d.total,c=0;_>c;c++)e._ignores[c]?(e._cols[c]=0,h++):e._cols[c]=Math.floor(a/(h-c)),a-=e._cols[c],r[c+1]=r[c]+e._cols[c];if(t.innerHTML="<div></div>",this.second_scale){for(var u=this.second_scale.x_unit,f=[this._trace_x[0]],m=[],p=[this.dx,this.dx],g=0,v=0;v<this._trace_x.length;v++){var x=this._trace_x[v],y=e._timeline_is_new_interval(u,x,f[g]);y&&(++g,f[g]=x,p[g+1]=p[g]);var b=g+1;m[g]=e._cols[v]+(m[g]||0),p[b]+=e._cols[v]}t.innerHTML="<div></div><div></div>";var w=t.firstChild;w.style.height=n+"px";var D=t.lastChild;D.style.position="relative";for(var P=0;P<f.length;P++){var E=f[P],k=e.templates[this.name+"_second_scalex_class"](E),M=document.createElement("DIV");M.className="dhx_scale_bar dhx_second_scale_bar"+(k?" "+k:""),e.set_xy(M,m[P]-1,n-3,p[P],0),M.innerHTML=e.templates[this.name+"_second_scale_date"](E),w.appendChild(M)}}e.xy.scale_height=n,t=t.lastChild;for(var S=0;S<this._trace_x.length;S++)if(!e._ignores[S]){l=this._trace_x[S],e._render_x_header(S,r[S],l,t);var N=e.templates[this.name+"_scalex_class"](l);N&&(t.lastChild.className+=" "+N)}e.xy.scale_height=i;var O=this._trace_x;t.onclick=function(t){var i=e._timeline_locate_hcell(t);i&&e.callEvent("onXScaleClick",[i.x,O[i.x],t||event])},t.ondblclick=function(t){var i=e._timeline_locate_hcell(t);i&&e.callEvent("onXScaleDblClick",[i.x,O[i.x],t||event])}},e._timeline_is_new_interval=function(t,i,n){switch(t){case"hour":return i.getHours()!=n.getHours()||e._timeline_is_new_interval("day",i,n);case"day":return!(i.getDate()==n.getDate()&&i.getMonth()==n.getMonth()&&i.getFullYear()==n.getFullYear());case"week":return!(e.date.week_start(new Date(i)).valueOf()==e.date.week_start(new Date(n)).valueOf());case"month":return!(i.getMonth()==n.getMonth()&&i.getFullYear()==n.getFullYear());case"year":return!(i.getFullYear()==n.getFullYear());default:return!1}},e._timeline_reset_scale_height=function(t){if(this._header_resized&&(!t||!this.second_scale)){e.xy.scale_height/=2,this._header_resized=!1;var i=e._els.dhx_cal_header[0];i.className=i.className.replace(/ dhx_second_cal_header/gi,"")}},e._timeline_set_full_view=function(t){if(e._timeline_reset_scale_height.call(this,t),t){this.second_scale&&!this._header_resized&&(this._header_resized=e.xy.scale_height,e.xy.scale_height*=2,e._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),e.set_sizes(),e._init_matrix_tooltip();var i=e._min_date;e._timeline_x_scale.call(this,e._els.dhx_cal_header[0]),e._timeline_y_scale.call(this,e._els.dhx_cal_data[0]),e._min_date=i,e._els.dhx_cal_date[0].innerHTML=e.templates[this.name+"_date"](e._min_date,e._max_date),e._mark_now&&e._mark_now(),e._timeline_reset_scale_height.call(this,t)}e._timeline_hideToolTip()},e._timeline_hideToolTip=function(){e._tooltip&&(e._tooltip.style.display="none",e._tooltip.date="")},e._timeline_showToolTip=function(t,i,n){if("cell"==t.render){var a=i.x+"_"+i.y,r=t._matrix[i.y][i.x];if(!r)return e._timeline_hideToolTip();if(r.sort(function(e,t){return e.start_date>t.start_date?1:-1}),e._tooltip){if(e._tooltip.date==a)return;e._tooltip.innerHTML=""}else{var s=e._tooltip=document.createElement("DIV");s.className="dhx_year_tooltip",document.body.appendChild(s),s.onclick=e._click.dhx_cal_data}for(var l="",o=0;o<r.length;o++){var d=r[o].color?"background-color:"+r[o].color+";":"",h=r[o].textColor?"color:"+r[o].textColor+";":"";l+="<div class='dhx_tooltip_line' event_id='"+r[o].id+"' style='"+d+h+"'>",l+="<div class='dhx_tooltip_date'>"+(r[o]._timed?e.templates.event_date(r[o].start_date):"")+"</div>",l+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",l+=e.templates[t.name+"_tooltip"](r[o].start_date,r[o].end_date,r[o])+"</div>"}e._tooltip.style.display="",e._tooltip.style.top="0px",document.body.offsetWidth-n.left-e._tooltip.offsetWidth<0?e._tooltip.style.left=n.left-e._tooltip.offsetWidth+"px":e._tooltip.style.left=n.left+i.src.offsetWidth+"px",e._tooltip.date=a,e._tooltip.innerHTML=l,document.body.offsetHeight-n.top-e._tooltip.offsetHeight<0?e._tooltip.style.top=n.top-e._tooltip.offsetHeight+i.src.offsetHeight+"px":e._tooltip.style.top=n.top+"px"}},e._matrix_tooltip_handler=function(t){var i=e.matrix[e._mode];if(i&&"cell"==i.render){if(i){var n=e._locate_cell_timeline(t),t=t||event;t.target||t.srcElement;if(n)return e._timeline_showToolTip(i,n,getOffset(n.src))}e._timeline_hideToolTip()}},e._init_matrix_tooltip=function(){e._detachDomEvent(e._els.dhx_cal_data[0],"mouseover",e._matrix_tooltip_handler),dhtmlxEvent(e._els.dhx_cal_data[0],"mouseover",e._matrix_tooltip_handler)},e._set_timeline_dates=function(t){e._min_date=e.date[t.name+"_start"](new Date(e._date)),e._max_date=e.date["add_"+t.name+"_private"](e._min_date,t.x_size*t.x_step),e.date[t.x_unit+"_start"]&&(e._max_date=e.date[t.x_unit+"_start"](e._max_date)),e._table_view=!0},e._renderMatrix=function(t,i){i||(e._els.dhx_cal_data[0].scrollTop=0),e._set_timeline_dates(this),e._timeline_set_full_view.call(this,t)},e._timeline_html_index=function(t){for(var i=t.parentNode.childNodes,n=-1,a=0;a<i.length;a++)if(i[a]==t){n=a;break}var r=n;if(e._ignores_detected)for(var s in e._ignores)e._ignores[s]&&r>=1*s&&r++;return r},e._timeline_locate_hcell=function(t){t=t||event;for(var i=t.target?t.target:t.srcElement;i&&"DIV"!=i.tagName;)i=i.parentNode;if(i&&"DIV"==i.tagName){var n=e._getClassName(i).split(" ")[0];if("dhx_scale_bar"==n)return{x:e._timeline_html_index(i),y:-1,src:i,scale:!0}}},e._locate_cell_timeline=function(t){t=t||event;for(var i=t.target?t.target:t.srcElement,n={},a=e.matrix[e._mode],r=e.getActionData(t),s=e._ignores,l=0,o=0;o<a._trace_x.length-1&&!(+r.date<a._trace_x[o+1]);o++)s[o]||l++;n.x=0===l?0:o,n.y=a.order[r.section];var d=e._isRender("cell")?1:0;n.src=a._scales[r.section]?a._scales[r.section].getElementsByTagName("td")[o+d]:null;for(var h=!1;0===n.x&&"dhx_cal_data"!=e._getClassName(i)&&i.parentNode;){if("dhx_matrix_scell"==e._getClassName(i).split(" ")[0]){h=!0;break}i=i.parentNode}return h?(n.x=-1,n.src=i,n.scale=!0):n.x=o,n};var t=e._click.dhx_cal_data;e._click.dhx_marked_timespan=e._click.dhx_cal_data=function(i){var n=t.apply(this,arguments),a=e.matrix[e._mode];if(a){var r=e._locate_cell_timeline(i);
r&&(r.scale?e.callEvent("onYScaleClick",[r.y,a.y_unit[r.y],i||event]):e.callEvent("onCellClick",[r.x,r.y,a._trace_x[r.x],(a._matrix[r.y]||{})[r.x]||[],i||event]))}return n},e.dblclick_dhx_matrix_cell=function(t){var i=e.matrix[e._mode];if(i){var n=e._locate_cell_timeline(t);n&&(n.scale?e.callEvent("onYScaleDblClick",[n.y,i.y_unit[n.y],t||event]):e.callEvent("onCellDblClick",[n.x,n.y,i._trace_x[n.x],(i._matrix[n.y]||{})[n.x]||[],t||event]))}};var i=e.dblclick_dhx_marked_timespan||function(){};e.dblclick_dhx_marked_timespan=function(t){var n=e.matrix[e._mode];return n?e.dblclick_dhx_matrix_cell(t):i.apply(this,arguments)},e.dblclick_dhx_matrix_scell=function(t){return e.dblclick_dhx_matrix_cell(t)},e._isRender=function(t){return e.matrix[e._mode]&&e.matrix[e._mode].render==t},e.attachEvent("onCellDblClick",function(t,i,n,a,r){if(!this.config.readonly&&("dblclick"!=r.type||this.config.dblclick_create)){var s=e.matrix[e._mode],l={};l.start_date=s._trace_x[t],l.end_date=s._trace_x[t+1]?s._trace_x[t+1]:e.date.add(s._trace_x[t],s.x_step,s.x_unit),s._start_correction&&(l.start_date=new Date(1*l.start_date+s._start_correction)),s._end_correction&&(l.end_date=new Date(l.end_date-s._end_correction)),l[s.y_property]=s.y_unit[i].key,e.addEventNow(l,null,r)}}),e.attachEvent("onBeforeDrag",function(t,i,n){return!e._isRender("cell")}),e.attachEvent("onEventChanged",function(e,t){t._timed=this.isOneDayEvent(t)}),e.attachEvent("onBeforeEventChanged",function(e,t,i,n){return e&&(e._move_delta=void 0),n&&(n._move_delta=void 0),!0}),e._is_column_visible=function(t){var i=e.matrix[e._mode],n=e._get_date_index(i,t);return!e._ignores[n]};var n=e._render_marked_timespan;e._render_marked_timespan=function(t,i,a,r,s){if(!e.config.display_marked_timespans)return[];if(e.matrix&&e.matrix[e._mode]){if(e._isRender("cell"))return;var l=e._lame_copy({},e.matrix[e._mode]);l.round_position=!1;var o=[],d=[],h=[],_=t.sections?t.sections.units||t.sections.timeline:null;if(a)h=[i],d=[a];else{var c=l.order;if(_)c.hasOwnProperty(_)&&(d.push(_),h.push(l._scales[_]));else if(l._scales)for(var u in c)c.hasOwnProperty(u)&&(d.push(u),h.push(l._scales[u]))}var r=r?new Date(r):e._min_date,s=s?new Date(s):e._max_date;if(r.valueOf()<e._min_date.valueOf()&&(r=new Date(e._min_date)),s.valueOf()>e._max_date.valueOf()&&(s=new Date(e._max_date)),!l._trace_x)return;for(var f=0;f<l._trace_x.length&&!e._is_column_visible(l._trace_x[f]);f++);if(f==l._trace_x.length)return;var m=[];if(t.days>6){var p=new Date(t.days);e.date.date_part(new Date(r))<=+p&&+s>=+p&&m.push(p)}else m.push.apply(m,e._get_dates_by_index(t.days));for(var g=t.zones,v=e._get_css_classes_by_config(t),x=0;x<d.length;x++){i=h[x],a=d[x];for(var f=0;f<m.length;f++)for(var y=m[f],b=0;b<g.length;b+=2){var w=g[b],D=g[b+1],P=new Date(+y+60*w*1e3),E=new Date(+y+60*D*1e3);if(P=new Date(P.valueOf()+1e3*(P.getTimezoneOffset()-y.getTimezoneOffset())*60),E=new Date(E.valueOf()+1e3*(E.getTimezoneOffset()-y.getTimezoneOffset())*60),E>r&&s>P){var k=e._get_block_by_config(t);k.className=v;var M=e._timeline_getX({start_date:P},!1,l)-1,S=e._timeline_getX({start_date:E},!1,l)-1,N=Math.max(1,S-M-1),O=l._section_height[a]-1||l.dy-1;k.style.cssText="height: "+O+"px; left: "+M+"px; width: "+N+"px; top: 0;",i.insertBefore(k,i.firstChild),o.push(k)}}}return o}return n.apply(e,[t,i,a])};var a=e._append_mark_now;e._append_mark_now=function(t,i){if(e.matrix&&e.matrix[e._mode]){var n=e._currentDate(),r=e._get_zone_minutes(n),s={days:+e.date.date_part(n),zones:[r,r+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return e._render_marked_timespan(s)}return a.apply(e,[t,i])};var r=e._mark_timespans;e._mark_timespans=function(){if(e.matrix&&e.matrix[e.getState().mode]){for(var t=[],i=e.matrix[e.getState().mode],n=i.y_unit,a=0;a<n.length;a++){var s=n[a].key,l=i._scales[s],o=e._on_scale_add_marker(l,s);t.push.apply(t,o)}return t}return r.apply(this,arguments)};var s=e._on_scale_add_marker;e._on_scale_add_marker=function(t,i){if(e.matrix&&e.matrix[e._mode]){var n=[],a=e._marked_timespans;if(a&&e.matrix&&e.matrix[e._mode])for(var r=e._mode,l=e._min_date,o=e._max_date,d=a.global,h=e.date.date_part(new Date(l));o>h;h=e.date.add(h,1,"day")){var _=+h,c=h.getDay(),u=[],f=d[_]||d[c];if(u.push.apply(u,e._get_configs_to_render(f)),a[r]&&a[r][i]){var m=[],p=e._get_types_to_render(a[r][i][c],a[r][i][_]);m.push.apply(m,e._get_configs_to_render(p)),m.length&&(u=m)}for(var g=0;g<u.length;g++){var v=u[g],x=v.days;7>x?(x=_,n.push.apply(n,e._render_marked_timespan(v,t,i,h,e.date.add(h,1,"day"))),x=c):n.push.apply(n,e._render_marked_timespan(v,t,i,h,e.date.add(h,1,"day")))}}return n}return s.apply(this,arguments)},e._resolve_timeline_section=function(e,t){var i=0,n=0;for(i;i<this._colsS.heights.length&&(n+=this._colsS.heights[i],!(n>t.y));i++);e.y_unit[i]||(i=e.y_unit.length-1),this._drag_event&&!this._drag_event._orig_section&&(this._drag_event._orig_section=e.y_unit[i].key),t.fields={},i>=0&&e.y_unit[i]&&(t.section=t.fields[e.y_property]=e.y_unit[i].key)},e._update_timeline_section=function(e){var t=e.view,i=e.event,n=e.pos;if(i){if(i[t.y_property]!=n.section){var a=this._get_timeline_event_height(i,t);i._sorder=this._get_dnd_order(i._sorder,a,t._section_height[n.section])}i[t.y_property]=n.section}},e._get_date_index=function(e,t){for(var i=0,n=e._trace_x;i<n.length-1&&+t>=+n[i+1];)i++;return i},e._timeline_drag_date=function(t,i){var n,a,r=t,s={x:i},l=0,o=0;for(o;o<=this._cols.length-1;o++)if(a=this._cols[o],l+=a,l>s.x){n=(s.x-(l-a))/a,n=0>n?0:n;break}if(r.round_position){var d=1,h=e.getState().drag_mode;h&&"move"!=h&&"create"!=h&&(d=.5),n>=d&&o++,n=0}if(0===o&&this._ignores[0])for(o=1,n=0;this._ignores[o];)o++;else if(o==this._cols.length&&this._ignores[o-1]){for(o=this._cols.length-1,n=0;this._ignores[o];)o--;o++}var _;if(o>=r._trace_x.length)_=e.date.add(r._trace_x[r._trace_x.length-1],r.x_step,r.x_unit),r._end_correction&&(_=new Date(_-r._end_correction));else{var c=n*a*r._step+r._start_correction;_=new Date(+r._trace_x[o]+c)}return _},e.attachEvent("onBeforeTodayDisplayed",function(){for(var t in e.matrix){var i=e.matrix[t];i.x_start=i._original_x_start}return!0}),e.attachEvent("onOptionsLoad",function(){for(var t in e.matrix){var i=e.matrix[t];i.order={},e.callEvent("onOptionsLoadStart",[]);for(var t=0;t<i.y_unit.length;t++)i.order[i.y_unit[t].key]=t;e.callEvent("onOptionsLoadFinal",[]),e._date&&i.name==e._mode&&e.setCurrentView(e._date,e._mode)}}),e.attachEvent("onSchedulerResize",function(){if(e.matrix[this._mode]){var t=e.matrix[this._mode];return e._renderMatrix.call(t,!0,!0),!1}return!0}),e.attachEvent("onBeforeDrag",function(t,i,n){if("resize"==i){var a=n.target||n.srcElement,r=e._getClassName(a);r.indexOf("dhx_event_resize_end")<0?e._drag_from_start=!0:e._drag_from_start=!1}return!0})},e._temp_matrix_scope()}),Scheduler.plugin(function(e){e.attachEvent("onTimelineCreated",function(t){"tree"==t.render&&(t.y_unit_original=t.y_unit,t.y_unit=e._getArrayToDisplay(t.y_unit_original),e.attachEvent("onOptionsLoadStart",function(){t.y_unit=e._getArrayToDisplay(t.y_unit_original)}),e.form_blocks[t.name]={render:function(e){var t="<div class='dhx_section_timeline' style='overflow: hidden; height: "+e.height+"px'></div>";return t},set_value:function(t,i,n,a){var r=e._getArrayForSelect(e.matrix[a.type].y_unit_original,a.type);t.innerHTML="";var s=document.createElement("select");t.appendChild(s);var l=t.getElementsByTagName("select")[0];!l._dhx_onchange&&a.onchange&&(l.onchange=a.onchange,l._dhx_onchange=!0);for(var o=0;o<r.length;o++){var d=document.createElement("option");d.value=r[o].key,d.value==n[e.matrix[a.type].y_property]&&(d.selected=!0),d.innerHTML=r[o].label,l.appendChild(d)}},get_value:function(e,t,i){return e.firstChild.value},focus:function(e){}})}),e.attachEvent("onBeforeSectionRender",function(t,i,n){var a={};if("tree"==t){var r,s,l,o,d,h;o="dhx_matrix_scell",i.children?(r=n.folder_dy||n.dy,n.folder_dy&&!n.section_autoheight&&(l="height:"+n.folder_dy+"px;"),s="dhx_row_folder",o+=" folder",d="<div class='dhx_scell_expand'>"+(i.open?"-":"+")+"</div>",h=n.folder_events_available?"dhx_data_table folder_events":"dhx_data_table folder"):(r=n.dy,s="dhx_row_item",o+=" item",d="",h="dhx_data_table"),o+=e.templates[n.name+"_scaley_class"](i.key,i.label,i)?" "+e.templates[n.name+"_scaley_class"](i.key,i.label,i):"";var _="<div class='dhx_scell_level"+i.level+"'>"+d+"<div class='dhx_scell_name'>"+(e.templates[n.name+"_scale_label"](i.key,i.label,i)||i.label)+"</div></div>";a={height:r,style_height:l,tr_className:s,td_className:o,td_content:_,table_className:h}}return a});var t;e.attachEvent("onBeforeEventChanged",function(i,n,a){if(e._isRender("tree"))for(var r=e._get_event_sections?e._get_event_sections(i):[i[e.matrix[e._mode].y_property]],s=0;s<r.length;s++){var l=e.getSection(r[s]);if(l&&l.children&&!e.matrix[e._mode].folder_events_available)return a||(i[e.matrix[e._mode].y_property]=t),!1}return!0}),e.attachEvent("onBeforeDrag",function(i,n,a){if(e._isRender("tree")){var r,s=e._locate_cell_timeline(a);if(s&&(r=e.matrix[e._mode].y_unit[s.y].key,e.matrix[e._mode].y_unit[s.y].children&&!e.matrix[e._mode].folder_events_available))return!1;var l=e.getEvent(i),o=e.matrix[e._mode].y_property;t=l&&l[o]?l[o]:r}return!0}),e._getArrayToDisplay=function(t){var i=[],n=function(t,a){for(var r=a||0,s=0;s<t.length;s++)t[s].level=r,t[s].children&&"undefined"==typeof t[s].key&&(t[s].key=e.uid()),i.push(t[s]),t[s].open&&t[s].children&&n(t[s].children,r+1)};return n(t),i},e._getArrayForSelect=function(t,i){var n=[],a=function(t){for(var r=0;r<t.length;r++)e.matrix[i].folder_events_available?n.push(t[r]):t[r].children||n.push(t[r]),t[r].children&&a(t[r].children,i)};return a(t),n},e._toggleFolderDisplay=function(t,i,n){var a,r=function(e,t,i,n){for(var s=0;s<t.length&&(t[s].key!=e&&!n||!t[s].children||(t[s].open="undefined"!=typeof i?i:!t[s].open,a=!0,n||!a));s++)t[s].children&&r(e,t[s].children,i,n)},s=e.getSection(t);"undefined"!=typeof i||n||(i=!s.open),e.callEvent("onBeforeFolderToggle",[s,i,n])&&(r(t,e.matrix[e._mode].y_unit_original,i,n),e.matrix[e._mode].y_unit=e._getArrayToDisplay(e.matrix[e._mode].y_unit_original),e.callEvent("onOptionsLoad",[]),e.callEvent("onAfterFolderToggle",[s,i,n]))},e.attachEvent("onCellClick",function(t,i,n,a,r){e._isRender("tree")&&(e.matrix[e._mode].folder_events_available||"undefined"!=typeof e.matrix[e._mode].y_unit[i]&&e.matrix[e._mode].y_unit[i].children&&e._toggleFolderDisplay(e.matrix[e._mode].y_unit[i].key))}),e.attachEvent("onYScaleClick",function(t,i,n){e._isRender("tree")&&i.children&&e._toggleFolderDisplay(i.key)}),e.getSection=function(t){if(e._isRender("tree")){var i,n=function(e,t){for(var a=0;a<t.length;a++)t[a].key==e&&(i=t[a]),t[a].children&&n(e,t[a].children)};return n(t,e.matrix[e._mode].y_unit_original),i||null}},e.deleteSection=function(t){if(e._isRender("tree")){var i=!1,n=function(e,t){for(var a=0;a<t.length&&(t[a].key==e&&(t.splice(a,1),i=!0),!i);a++)t[a].children&&n(e,t[a].children)};return n(t,e.matrix[e._mode].y_unit_original),e.matrix[e._mode].y_unit=e._getArrayToDisplay(e.matrix[e._mode].y_unit_original),e.callEvent("onOptionsLoad",[]),i}},e.deleteAllSections=function(){e._isRender("tree")&&(e.matrix[e._mode].y_unit_original=[],e.matrix[e._mode].y_unit=e._getArrayToDisplay(e.matrix[e._mode].y_unit_original),e.callEvent("onOptionsLoad",[]))},e.addSection=function(t,i){if(e._isRender("tree")){var n=!1,a=function(e,t,r){if(i)for(var s=0;s<r.length&&(r[s].key==t&&r[s].children&&(r[s].children.push(e),n=!0),!n);s++)r[s].children&&a(e,t,r[s].children);else r.push(e),n=!0};return a(t,i,e.matrix[e._mode].y_unit_original),e.matrix[e._mode].y_unit=e._getArrayToDisplay(e.matrix[e._mode].y_unit_original),e.callEvent("onOptionsLoad",[]),n}},e.openAllSections=function(){e._isRender("tree")&&e._toggleFolderDisplay(1,!0,!0)},e.closeAllSections=function(){e._isRender("tree")&&e._toggleFolderDisplay(1,!1,!0)},e.openSection=function(t){e._isRender("tree")&&e._toggleFolderDisplay(t,!0)},e.closeSection=function(t){e._isRender("tree")&&e._toggleFolderDisplay(t,!1)}}),Scheduler.plugin(function(e){e.templates.calendar_month=e.date.date_to_str("%F %Y"),e.templates.calendar_scale_date=e.date.date_to_str("%D"),e.templates.calendar_date=e.date.date_to_str("%d"),e.config.minicalendar={mark_events:!0},e._synced_minicalendars=[],e.renderCalendar=function(t,i,n){var a=null,r=t.date||e._currentDate();if("string"==typeof r&&(r=this.templates.api_date(r)),i)a=this._render_calendar(i.parentNode,r,t,i),e.unmarkCalendar(a);else{var s=t.container,l=t.position;if("string"==typeof s&&(s=document.getElementById(s)),"string"==typeof l&&(l=document.getElementById(l)),l&&"undefined"==typeof l.left){var o=getOffset(l);l={top:o.top+l.offsetHeight,left:o.left}}s||(s=e._get_def_cont(l)),a=this._render_calendar(s,r,t),a.onclick=function(t){t=t||event;var i=t.target||t.srcElement;if(-1!=i.className.indexOf("dhx_month_head")){var n=i.parentNode.className;if(-1==n.indexOf("dhx_after")&&-1==n.indexOf("dhx_before")){var a=e.templates.xml_date(this.getAttribute("date"));a.setDate(parseInt(i.innerHTML,10)),e.unmarkCalendar(this),e.markCalendar(this,a,"dhx_calendar_click"),this._last_date=a,this.conf.handler&&this.conf.handler.call(e,a,this)}}}}if(e.config.minicalendar.mark_events)for(var d=e.date.month_start(r),h=e.date.add(d,1,"month"),_=this.getEvents(d,h),c=this["filter_"+this._mode],u={},f=0;f<_.length;f++){var m=_[f];if(!c||c(m.id,m)){var p=m.start_date;for(p.valueOf()<d.valueOf()&&(p=d),p=e.date.date_part(new Date(p.valueOf()));p<m.end_date&&(u[+p]||(u[+p]=!0,this.markCalendar(a,p,"dhx_year_event")),p=this.date.add(p,1,"day"),!(p.valueOf()>=h.valueOf())););}}return this._markCalendarCurrentDate(a),a.conf=t,t.sync&&!n&&this._synced_minicalendars.push(a),a.conf._on_xle_handler||(a.conf._on_xle_handler=e.attachEvent("onXLE",function(){e.updateCalendar(a,a.conf.date)})),this.config.wai_aria_attributes&&this.config.wai_aria_application_role&&a.setAttribute("role","application"),a},e._get_def_cont=function(e){return this._def_count||(this._def_count=document.createElement("DIV"),this._def_count.className="dhx_minical_popup",this._def_count.onclick=function(e){(e||event).cancelBubble=!0},document.body.appendChild(this._def_count)),this._def_count.style.left=e.left+"px",this._def_count.style.top=e.top+"px",this._def_count._created=new Date,this._def_count},e._locateCalendar=function(t,i){if("string"==typeof i&&(i=e.templates.api_date(i)),+i>+t._max_date||+i<+t._min_date)return null;for(var n=t.querySelector(".dhx_year_body").childNodes[0],a=0,r=new Date(t._min_date);+this.date.add(r,1,"week")<=+i;)r=this.date.add(r,1,"week"),a++;var s=e.config.start_on_monday,l=(i.getDay()||(s?7:0))-(s?1:0);return n.rows[a].cells[l].firstChild},e.markCalendar=function(e,t,i){var n=this._locateCalendar(e,t);n&&(n.className+=" "+i)},e.unmarkCalendar=function(e,t,i){if(t=t||e._last_date,i=i||"dhx_calendar_click",t){var n=this._locateCalendar(e,t);n&&(n.className=(n.className||"").replace(RegExp(i,"g")))}},e._week_template=function(t){for(var i=t||250,n=0,a=document.createElement("div"),r=this.date.week_start(e._currentDate()),s=0;7>s;s++)this._cols[s]=Math.floor(i/(7-s)),this._render_x_header(s,n,r,a),r=this.date.add(r,1,"day"),i-=this._cols[s],n+=this._cols[s];return a.lastChild.className+=" dhx_scale_bar_last",a},e.updateCalendar=function(e,t){e.conf.date=t,this.renderCalendar(e.conf,e,!0)},e._mini_cal_arrows=["&nbsp","&nbsp"],e._render_calendar=function(t,i,n,a){var r=e.templates,s=this._cols;this._cols=[];var l=this._mode;this._mode="calendar";var o=this._colsS;this._colsS={height:0};var d=new Date(this._min_date),h=new Date(this._max_date),_=new Date(e._date),c=r.month_day,u=this._ignores_detected;this._ignores_detected=0,r.month_day=r.calendar_date,i=this.date.month_start(i);var f,m=this._week_template(t.offsetWidth-1-this.config.minicalendar.padding);a?f=a:(f=document.createElement("DIV"),f.className="dhx_cal_container dhx_mini_calendar"),f.setAttribute("date",this.templates.xml_format(i)),f.innerHTML="<div class='dhx_year_month'></div><div class='dhx_year_grid'><div class='dhx_year_week'>"+(m?m.innerHTML:"")+"</div><div class='dhx_year_body'></div></div>";var p=f.querySelector(".dhx_year_month"),g=f.querySelector(".dhx_year_week"),v=f.querySelector(".dhx_year_body");if(p.innerHTML=this.templates.calendar_month(i),n.navigation)for(var x=function(t,i){var n=e.date.add(t._date,i,"month");e.updateCalendar(t,n),e._date.getMonth()==t._date.getMonth()&&e._date.getFullYear()==t._date.getFullYear()&&e._markCalendarCurrentDate(t)},y=["dhx_cal_prev_button","dhx_cal_next_button"],b=["left:1px;top:2px;position:absolute;","left:auto; right:1px;top:2px;position:absolute;"],w=[-1,1],D=function(t){return function(){if(n.sync)for(var i=e._synced_minicalendars,a=0;a<i.length;a++)x(i[a],t);else x(f,t)}},P=[e.locale.labels.prev,e.locale.labels.next],E=0;2>E;E++){var k=document.createElement("DIV");k.className=y[E],e._waiAria.headerButtonsAttributes(k,P[E]),k.style.cssText=b[E],k.innerHTML=this._mini_cal_arrows[E],p.appendChild(k),k.onclick=D(w[E])}f._date=new Date(i),f.week_start=(i.getDay()-(this.config.start_on_monday?1:0)+7)%7;var M=f._min_date=this.date.week_start(i);f._max_date=this.date.add(f._min_date,6,"week"),this._reset_month_scale(v,i,M,6),a||t.appendChild(f),g.style.height=g.childNodes[0].offsetHeight-1+"px";var S=e.uid();e._waiAria.minicalHeader(p,S),e._waiAria.minicalGrid(f.querySelector(".dhx_year_grid"),S),e._waiAria.minicalRow(g);for(var N=g.querySelectorAll(".dhx_scale_bar"),O=0;O<N.length;O++)e._waiAria.minicalHeadCell(N[O]);for(var A=v.querySelectorAll("td"),L=new Date(M),O=0;O<A.length;O++)e._waiAria.minicalDayCell(A[O],new Date(L)),L=e.date.add(L,1,"day");return e._waiAria.minicalHeader(p,S),this._cols=s,this._mode=l,this._colsS=o,this._min_date=d,this._max_date=h,e._date=_,r.month_day=c,this._ignores_detected=u,f},e.destroyCalendar=function(t,i){!t&&this._def_count&&this._def_count.firstChild&&(i||(new Date).valueOf()-this._def_count._created.valueOf()>500)&&(t=this._def_count.firstChild),t&&(t.onclick=null,t.innerHTML="",t.parentNode&&t.parentNode.removeChild(t),this._def_count&&(this._def_count.style.top="-1000px"),t.conf&&t.conf._on_xle_handler&&e.detachEvent(t.conf._on_xle_handler))},e.isCalendarVisible=function(){return this._def_count&&parseInt(this._def_count.style.top,10)>0?this._def_count:!1},e._attach_minical_events=function(){dhtmlxEvent(document.body,"click",function(){e.destroyCalendar()}),e._attach_minical_events=function(){}},e.attachEvent("onTemplatesReady",function(){e._attach_minical_events()}),e.templates.calendar_time=e.date.date_to_str("%d-%m-%Y"),e.form_blocks.calendar_time={render:function(t){var i="<input class='dhx_readonly' type='text' readonly='true'>",n=e.config,a=this.date.date_part(e._currentDate()),r=1440,s=0;n.limit_time_select&&(s=60*n.first_hour,r=60*n.last_hour+1),a.setHours(s/60),t._time_values=[],i+=" <select>";for(var l=s;r>l;l+=1*this.config.time_step){var o=this.templates.time_picker(a);i+="<option value='"+l+"'>"+o+"</option>",t._time_values.push(l),a=this.date.add(a,this.config.time_step,"minute")}return i+="</select>",e.config.full_day,"<div style='height:30px;padding-top:0; font-size:inherit;' class='dhx_section_time'>"+i+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+i+"</div>"},set_value:function(t,i,n,a){function r(t,i,n){_(t,i,n),t.value=e.templates.calendar_time(i),t._date=e.date.date_part(new Date(i))}function s(e){for(var t=a._time_values,i=60*e.getHours()+e.getMinutes(),n=i,r=!1,s=0;s<t.length;s++){var l=t[s];if(l===i){r=!0;break}i>l&&(n=l)}return r||n?r?i:n:-1}var l,o,d=t.getElementsByTagName("input"),h=t.getElementsByTagName("select"),_=function(t,i,n){t.onclick=function(){e.destroyCalendar(null,!0),e.renderCalendar({position:t,date:new Date(this._date),navigation:!0,handler:function(i){t.value=e.templates.calendar_time(i),t._date=new Date(i),e.destroyCalendar(),e.config.event_duration&&e.config.auto_end_date&&0===n&&m()}})}};if(e.config.full_day){if(!t._full_day){var c="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+e.locale.labels.full_day+"&nbsp;</label></input>";e.config.wide_form||(c=t.previousSibling.innerHTML+c),t.previousSibling.innerHTML=c,t._full_day=!0}var u=t.previousSibling.getElementsByTagName("input")[0],f=0===e.date.time_part(n.start_date)&&0===e.date.time_part(n.end_date);u.checked=f,h[0].disabled=u.checked,h[1].disabled=u.checked,u.onclick=function(){if(u.checked===!0){var i={};e.form_blocks.calendar_time.get_value(t,i),l=e.date.date_part(i.start_date),o=e.date.date_part(i.end_date),(+o==+l||+o>=+l&&(0!==n.end_date.getHours()||0!==n.end_date.getMinutes()))&&(o=e.date.add(o,1,"day"))}var a=l||n.start_date,s=o||n.end_date;r(d[0],a),r(d[1],s),h[0].value=60*a.getHours()+a.getMinutes(),h[1].value=60*s.getHours()+s.getMinutes(),h[0].disabled=u.checked,h[1].disabled=u.checked}}if(e.config.event_duration&&e.config.auto_end_date){var m=function(){l=e.date.add(d[0]._date,h[0].value,"minute"),o=new Date(l.getTime()+60*e.config.event_duration*1e3),d[1].value=e.templates.calendar_time(o),d[1]._date=e.date.date_part(new Date(o)),h[1].value=60*o.getHours()+o.getMinutes()};h[0].onchange=m}r(d[0],n.start_date,0),r(d[1],n.end_date,1),_=function(){},h[0].value=s(n.start_date),h[1].value=s(n.end_date)},get_value:function(t,i){var n=t.getElementsByTagName("input"),a=t.getElementsByTagName("select");return i.start_date=e.date.add(n[0]._date,a[0].value,"minute"),i.end_date=e.date.add(n[1]._date,a[1].value,"minute"),i.end_date<=i.start_date&&(i.end_date=e.date.add(i.start_date,e.config.time_step,"minute")),{start_date:new Date(i.start_date),end_date:new Date(i.end_date)}},focus:function(e){}},e.linkCalendar=function(t,i){var n=function(){var n=e._date,a=new Date(n.valueOf());return i&&(a=i(a)),a.setDate(1),e.updateCalendar(t,a),!0};e.attachEvent("onViewChange",n),e.attachEvent("onXLE",n),e.attachEvent("onEventAdded",n),e.attachEvent("onEventChanged",n),e.attachEvent("onAfterEventDelete",n),n()},e._markCalendarCurrentDate=function(t){var i=e._date,n=e._mode,a=e.date.month_start(new Date(t._date)),r=e.date.add(a,1,"month");if("day"==n||this._props&&this._props[n])a.valueOf()<=i.valueOf()&&r>i&&e.markCalendar(t,i,"dhx_calendar_click");else if("week"==n)for(var s=e.date.week_start(new Date(i.valueOf())),l=0;7>l;l++)a.valueOf()<=s.valueOf()&&r>s&&e.markCalendar(t,s,"dhx_calendar_click"),s=e.date.add(s,1,"day")},e.attachEvent("onEventCancel",function(){e.destroyCalendar(null,!0)})}),Scheduler.plugin(function(e){!function(){var t=e.dhtmlXTooltip=e.tooltip={};t.config={className:"dhtmlXTooltip tooltip",timeout_to_display:50,timeout_to_hide:50,delta_x:15,delta_y:-20},t.tooltip=document.createElement("div"),t.tooltip.className=t.config.className,e._waiAria.tooltipAttr(t.tooltip),t.show=function(i,n){if(!e.config.touch||e.config.touch_tooltip){var a=t,r=this.tooltip,s=r.style;a.tooltip.className=a.config.className;var l=this.position(i),o=i.target||i.srcElement;if(!this.isTooltip(o)){var d=l.x+(a.config.delta_x||0),h=l.y-(a.config.delta_y||0);s.visibility="hidden",s.removeAttribute?(s.removeAttribute("right"),s.removeAttribute("bottom")):(s.removeProperty("right"),s.removeProperty("bottom")),s.left="0",s.top="0",this.tooltip.innerHTML=n,document.body.appendChild(this.tooltip);var _=this.tooltip.offsetWidth,c=this.tooltip.offsetHeight;document.documentElement.clientWidth-d-_<0?(s.removeAttribute?s.removeAttribute("left"):s.removeProperty("left"),s.right=document.documentElement.clientWidth-d+2*(a.config.delta_x||0)+"px"):0>d?s.left=l.x+Math.abs(a.config.delta_x||0)+"px":s.left=d+"px",document.documentElement.clientHeight-h-c<0?(s.removeAttribute?s.removeAttribute("top"):s.removeProperty("top"),s.bottom=document.documentElement.clientHeight-h-2*(a.config.delta_y||0)+"px"):0>h?s.top=l.y+Math.abs(a.config.delta_y||0)+"px":s.top=h+"px",e._waiAria.tooltipVisibleAttr(this.tooltip),s.visibility="visible",this.tooltip.onmouseleave=function(t){t=t||window.event;for(var i=e.dhtmlXTooltip,n=t.relatedTarget;n!=e._obj&&n;)n=n.parentNode;n!=e._obj&&i.delay(i.hide,i,[],i.config.timeout_to_hide)},e.callEvent("onTooltipDisplayed",[this.tooltip,this.tooltip.event_id])}}},t._clearTimeout=function(){this.tooltip._timeout_id&&window.clearTimeout(this.tooltip._timeout_id)},t.hide=function(){if(this.tooltip.parentNode){e._waiAria.tooltipHiddenAttr(this.tooltip);var t=this.tooltip.event_id;this.tooltip.event_id=null,this.tooltip.onmouseleave=null,this.tooltip.parentNode.removeChild(this.tooltip),e.callEvent("onAfterTooltip",[t])}this._clearTimeout()},t.delay=function(e,t,i,n){this._clearTimeout(),this.tooltip._timeout_id=setTimeout(function(){var n=e.apply(t,i);return e=t=i=null,n},n||this.config.timeout_to_display)},t.isTooltip=function(e){for(var t=!1;e&&!t;)t=e.className==this.tooltip.className,e=e.parentNode;return t},t.position=function(e){return e=e||window.event,{x:e.clientX,y:e.clientY}},e.attachEvent("onMouseMove",function(i,n){var a=window.event||n,r=a.target||a.srcElement,s=t,l=s.isTooltip(r),o=s.isTooltipTarget&&s.isTooltipTarget(r);if(i||l||o){var d;if(i||s.tooltip.event_id){var h=e.getEvent(i)||e.getEvent(s.tooltip.event_id);if(!h)return;if(s.tooltip.event_id=h.id,d=e.templates.tooltip_text(h.start_date,h.end_date,h),!d)return s.hide()}o&&(d="");var _;if(_isIE){_={pageX:void 0,pageY:void 0,clientX:void 0,clientY:void 0,target:void 0,srcElement:void 0};for(var c in _)_[c]=a[c]}if(!e.callEvent("onBeforeTooltip",[i])||!d)return;s.delay(s.show,s,[_||a,d])}else s.delay(s.hide,s,[],s.config.timeout_to_hide)}),e.attachEvent("onBeforeDrag",function(){return t.hide(),!0}),e.attachEvent("onEventDeleted",function(){return t.hide(),!0})}()}),Scheduler.plugin(function(e){e.attachEvent("onTemplatesReady",function(){function t(e,t,i,n){for(var a=t.getElementsByTagName(e),r=i.getElementsByTagName(e),s=r.length-1;s>=0;s--){var i=r[s];if(n){var l=document.createElement("SPAN");l.className="dhx_text_disabled",l.innerHTML=n(a[s]),i.parentNode.insertBefore(l,i),i.parentNode.removeChild(i)}else i.disabled=!0,t.checked&&(i.checked=!0)}}var i=e.config.lightbox.sections.slice(),n=e.config.buttons_left.slice(),a=e.config.buttons_right.slice();e.attachEvent("onBeforeLightbox",function(t){if(this.config.readonly_form||this.getEvent(t).readonly){this.config.readonly_active=!0;for(var r=0;r<this.config.lightbox.sections.length;r++)this.config.lightbox.sections[r].focus=!1}else this.config.readonly_active=!1,e.config.lightbox.sections=i.slice(),e.config.buttons_left=n.slice(),e.config.buttons_right=a.slice();var s=this.config.lightbox.sections;if(this.config.readonly_active){for(var r=0;r<s.length;r++)if("recurring"==s[r].type){this.config.readonly_active&&s.splice(r,1);break}for(var l=["dhx_delete_btn","dhx_save_btn"],o=[e.config.buttons_left,e.config.buttons_right],r=0;r<l.length;r++)for(var d=l[r],h=0;h<o.length;h++){for(var _=o[h],c=-1,u=0;u<_.length;u++)if(_[u]==d){c=u;break}-1!=c&&_.splice(c,1)}}return this.resetLightbox(),!0});var r=e._fill_lightbox;e._fill_lightbox=function(){var i=this.getLightbox();this.config.readonly_active&&(i.style.visibility="hidden",i.style.display="block");var n=r.apply(this,arguments);if(this.config.readonly_active&&(i.style.visibility="",i.style.display="none"),this.config.readonly_active){var a=this.getLightbox(),l=this._lightbox_r=a.cloneNode(!0);l.id=e.uid(),t("textarea",a,l,function(e){return e.value}),t("input",a,l,!1),t("select",a,l,function(e){return e.options.length?e.options[Math.max(e.selectedIndex||0,0)].text:""}),a.parentNode.insertBefore(l,a),s.call(this,l),e._lightbox&&e._lightbox.parentNode.removeChild(e._lightbox),this._lightbox=l,e.config.drag_lightbox&&(l.firstChild.onmousedown=e._ready_to_dnd),this.setLightboxSize(),l.onclick=function(t){var i=t?t.target:event.srcElement;if(e._getClassName(i)||(i=i.previousSibling),i&&i.className)switch(e._getClassName(i)){case"dhx_cancel_btn":e.callEvent("onEventCancel",[e._lightbox_id]),e._edit_stop_event(e.getEvent(e._lightbox_id),!1),e.hide_lightbox()}},l.onkeydown=function(t){var i=t||window.event,n=t.target||t.srcElement,a=n.querySelector("[dhx_button]");switch(a||(a=n.parentNode.querySelector(".dhx_custom_button, .dhx_readonly")),(t||i).keyCode){case 32:if((t||i).shiftKey)return;a&&a.click&&a.click();break;case e.keys.edit_cancel:e.cancel_lightbox()}}}return n};var s=e.showCover;e.showCover=function(){this.config.readonly_active||s.apply(this,arguments)};var l=e.hide_lightbox;e.hide_lightbox=function(){return this._lightbox_r&&(this._lightbox_r.parentNode.removeChild(this._lightbox_r),this._lightbox_r=this._lightbox=null),l.apply(this,arguments)}})}),Scheduler.plugin(function(e){!function(){function t(e,t,i){var n=e+"="+i+(t?"; "+t:"");document.cookie=n}function i(e){var t=e+"=";if(document.cookie.length>0){var i=document.cookie.indexOf(t);if(-1!=i){i+=t.length;var n=document.cookie.indexOf(";",i);return-1==n&&(n=document.cookie.length),document.cookie.substring(i,n)}}return""}var n=!0;e.attachEvent("onBeforeViewChange",function(a,r,s,l){if(n&&e._get_url_nav){var o=e._get_url_nav();(o.date||o.mode||o.event)&&(n=!1)}var d=(e._obj.id||"scheduler")+"_settings";if(n){n=!1;var h=i(d);if(h){e._min_date||(e._min_date=l),h=unescape(h).split("@"),h[0]=this.templates.xml_date(h[0]);var _=this.isViewExists(h[1])?h[1]:s,c=isNaN(+h[0])?l:h[0];return window.setTimeout(function(){e.setCurrentView(c,_)},1),!1}}var u=escape(this.templates.xml_format(l||r)+"@"+(s||a));return t(d,"expires=Sun, 31 Jan 9999 22:00:00 GMT",u),!0});var a=e._load;e._load=function(){var t=arguments;if(e._date)a.apply(this,t);else{var i=this;window.setTimeout(function(){a.apply(i,t)},1)}}}()}),Scheduler.plugin(function(e){e._get_url_nav=function(){for(var e={},t=(document.location.hash||"").replace("#","").split(","),i=0;i<t.length;i++){var n=t[i].split("=");2==n.length&&(e[n[0]]=n[1])}return e},e.attachEvent("onTemplatesReady",function(){function t(t){r=t,e.getEvent(t)&&e.showEvent(t)}var i=!0,n=e.date.str_to_date("%Y-%m-%d"),a=e.date.date_to_str("%Y-%m-%d"),r=e._get_url_nav().event||null;e.attachEvent("onAfterEventDisplay",function(e){return r=null,!0}),e.attachEvent("onBeforeViewChange",function(s,l,o,d){if(i){i=!1;var h=e._get_url_nav();if(h.event)try{if(e.getEvent(h.event))return t(h.event),!1;var _=e.attachEvent("onXLE",function(){t(h.event),e.detachEvent(_)})}catch(c){}if(h.date||h.mode){try{this.setCurrentView(h.date?n(h.date):null,h.mode||null)}catch(c){this.setCurrentView(h.date?n(h.date):null,o)}return!1}}var u=["date="+a(d||l),"mode="+(o||s)];r&&u.push("event="+r);var f="#"+u.join(",");return document.location.hash=f,!0})})}),Scheduler.plugin(function(e){e.config.multisection=!0,e.config.multisection_shift_all=!0,e.config.section_delimiter=",",e.attachEvent("onSchedulerReady",function(){e._inited_multisection_copies||(e.attachEvent("onEventIdChange",function(e,t){var i=this._multisection_copies;if(i&&i[e]&&!i[t]){var n=i[e];delete i[e],i[t]=n}}),e._inited_multisection_copies=!0),e._register_copies_array=function(e){for(var t=0;t<e.length;t++)this._register_copy(e[t])},e._register_copy=function(e){this._multisection_copies[e.id]||(this._multisection_copies[e.id]={});var t=e[this._get_section_property()],i=this._multisection_copies[e.id];i[t]||(i[t]=e)},e._get_copied_event=function(t,i){if(!this._multisection_copies[t])return null;if(this._multisection_copies[t][i])return this._multisection_copies[t][i];var n=this._multisection_copies[t];if(e._drag_event&&e._drag_event._orig_section&&n[e._drag_event._orig_section])return n[e._drag_event._orig_section];var a=1/0,r=null;for(var s in n)n[s]._sorder<a&&(r=n[s],a=n[s]._sorder);return r},e._clear_copied_events=function(){this._multisection_copies={}},e._restore_render_flags=function(t){for(var i=this._get_section_property(),n=0;n<t.length;n++){var a=t[n],r=e._get_copied_event(a.id,a[i]);if(r)for(var s in r)0===s.indexOf("_")&&(a[s]=r[s])}};var t=e._update_unit_section;
e._update_unit_section=function(i){return e._update_sections(i,t)};var i=e._update_timeline_section;e._update_timeline_section=function(t){return e._update_sections(t,i)},e.isMultisectionEvent=function(e){if(e&&this._get_multisection_view()){var t=this._get_event_sections(e);return t.length>1}return!1},e._get_event_sections=function(e){var t=this._get_section_property(),i=e[t]||"";return this._parse_event_sections(i)},e._parse_event_sections=function(t){return t instanceof Array?t:t.toString().split(e.config.section_delimiter)},e._clear_copied_events(),e._split_events=function(t){var i=[],n=this._get_multisection_view(),a=this._get_section_property();if(n)for(var r=0;r<t.length;r++){var s=this._get_event_sections(t[r]);if(s.length>1){for(var l=0;l<s.length;l++)if("undefined"!=typeof n.order[s[l]]){var o=e._copy_event(t[r]);o[a]=s[l],i.push(o)}}else i.push(t[r])}else i=t;return i},e._get_multisection_view=function(){return this.config.multisection?e._get_section_view():!1};var n=e.get_visible_events;e.get_visible_events=function(e){this._clear_copied_events();var t=n.apply(this,arguments);if(this._get_multisection_view()){t=this._split_events(t);for(var i=0;i<t.length;i++)this.is_visible_events(t[i])||(t.splice(i,1),i--);this._register_copies_array(t)}return t},e._rendered_events={};var a=e.render_view_data;e.render_view_data=function(e,t){return this._get_multisection_view()&&e&&(e=this._split_events(e),this._restore_render_flags(e)),a.apply(this,[e,t])},e._update_sections=function(t,i){var n=t.view,a=t.event,r=t.pos;if(e.isMultisectionEvent(a)){if(e._drag_event._orig_section||(e._drag_event._orig_section=r.section),e._drag_event._orig_section!=r.section){var s=n.order[r.section]-n.order[e._drag_event._orig_section];if(s){var l=this._get_event_sections(a),o=[],d=!0;if(e.config.multisection_shift_all)for(var h=0;h<l.length;h++){var _=e._shift_sections(n,l[h],s);if(null===_){o=l,d=!1;break}o[h]=_}else for(var h=0;h<l.length;h++){if(l[h]==r.section){o=l,d=!1;break}if(l[h]==e._drag_event._orig_section){var _=e._shift_sections(n,l[h],s);if(null===_){o=l,d=!1;break}o[h]=_}else o[h]=l[h]}d&&(e._drag_event._orig_section=r.section),a[e._get_section_property()]=o.join(e.config.section_delimiter)}}}else i.apply(e,[t])},e._shift_sections=function(e,t,i){for(var n=null,a=e.y_unit||e.options,r=0;r<a.length;r++)if(a[r].key==t){n=r;break}var s=a[n+i];return s?s.key:null};var r=e._get_blocked_zones;e._get_blocked_zones=function(e,t,i,n,a){if(t&&this.config.multisection){t=this._parse_event_sections(t);for(var s=[],l=0;l<t.length;l++)s=s.concat(r.apply(this,[e,t[l],i,n,a]));return s}return r.apply(this,arguments)};var s=e._check_sections_collision;e._check_sections_collision=function(e,t){if(this.config.multisection&&this._get_section_view()){e=this._split_events([e]),t=this._split_events([t]);for(var i=!1,n=0,a=e.length;a>n&&!i;n++)for(var r=0,l=t.length;l>r;r++)if(s.apply(this,[e[n],t[r]])){i=!0;break}return i}return s.apply(this,arguments)}})}),"undefined"==typeof window.dhx4&&(window.dhx4={version:"4.0.3",skin:null,skinDetect:function(e){var t=document.createElement("DIV");t.className=e+"_skin_detect",document.body.firstChild?document.body.insertBefore(t,document.body.firstChild):document.body.appendChild(t);var i=t.offsetWidth;return t.parentNode.removeChild(t),t=null,{10:"dhx_skyblue",20:"dhx_web",30:"dhx_terrace"}[i]||null},lastId:1,newId:function(){return this.lastId++},zim:{data:{},step:5,first:function(){return 100},last:function(){var e=this.first();for(var t in this.data)e=Math.max(e,this.data[t]);return e},reserve:function(e){return this.data[e]=this.last()+this.step,this.data[e]},clear:function(e){null!=this.data[e]&&(this.data[e]=null,delete this.data[e])}},s2b:function(e){return 1==e||1==e||"true"==e||"1"==e||"yes"==e||"y"==e},trim:function(e){return String(e).replace(/^\s{1,}/,"").replace(/\s{1,}$/,"")},template:function(e,t,i){return e.replace(/#([a-zA-Z0-9_-]{1,})#/g,function(e,n){return n.length>0&&"undefined"!=typeof t[n]?1==i?window.dhx4.trim(t[n]):String(t[n]):""})},absLeft:function(e){return"string"==typeof e&&(e=document.getElementById(e)),this._aOfs(e).left},absTop:function(e){return"string"==typeof e&&(e=document.getElementById(e)),this._aOfs(e).top},_aOfsSum:function(e){for(var t=0,i=0;e;)t+=parseInt(e.offsetTop),i+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:i}},_aOfsRect:function(e){var t=e.getBoundingClientRect(),i=document.body,n=document.documentElement,a=window.pageYOffset||n.scrollTop||i.scrollTop,r=window.pageXOffset||n.scrollLeft||i.scrollLeft,s=n.clientTop||i.clientTop||0,l=n.clientLeft||i.clientLeft||0,o=t.top+a-s,d=t.left+r-l;return{top:Math.round(o),left:Math.round(d)}},_aOfs:function(e){return e.getBoundingClientRect?this._aOfsRect(e):this._aOfsSum(e)},_isObj:function(e){return null!=e&&"object"==typeof e&&"undefined"==typeof e.length},_copyObj:function(e){if(this._isObj(e)){var t={};for(var i in e)"object"==typeof e[i]&&null!=e[i]?t[i]=this._copyObj(e[i]):t[i]=e[i]}else for(var t=[],i=0;i<e.length;i++)"object"==typeof e[i]&&null!=e[i]?t[i]=this._copyObj(e[i]):t[i]=e[i];return t},screenDim:function(){var e=navigator.userAgent.indexOf("MSIE")>=0,t={};return t.left=document.body.scrollLeft,t.right=t.left+(window.innerWidth||document.body.clientWidth),t.top=Math.max((e?document.documentElement:document.getElementsByTagName("html")[0]).scrollTop,document.body.scrollTop),t.bottom=t.top+(e?Math.max(document.documentElement.clientHeight||0,document.documentElement.offsetHeight||0):window.innerHeight),t},selectTextRange:function(e,t,i){e="string"==typeof e?document.getElementById(e):e;var n=e.value.length;if(t=Math.max(Math.min(t,n),0),i=Math.min(i,n),e.setSelectionRange)try{e.setSelectionRange(t,i)}catch(a){}else if(e.createTextRange){var r=e.createTextRange();r.moveStart("character",t),r.moveEnd("character",i-n);try{r.select()}catch(a){}}},transData:null,transDetect:function(){if(null==this.transData){this.transData={transProp:!1,transEv:null};var e={MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"transitionend",transition:"transitionend"};for(var t in e)0==this.transData.transProp&&null!=document.documentElement.style[t]&&(this.transData.transProp=t,this.transData.transEv=e[t]);e=null}return this.transData}},window.dhx4.isIE=navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0,window.dhx4.isIE6=null==window.XMLHttpRequest&&navigator.userAgent.indexOf("MSIE")>=0,window.dhx4.isIE7=navigator.userAgent.indexOf("MSIE 7.0")>=0&&navigator.userAgent.indexOf("Trident")<0,window.dhx4.isOpera=navigator.userAgent.indexOf("Opera")>=0,window.dhx4.isChrome=navigator.userAgent.indexOf("Chrome")>=0,window.dhx4.isKHTML=navigator.userAgent.indexOf("Safari")>=0||navigator.userAgent.indexOf("Konqueror")>=0,window.dhx4.isFF=navigator.userAgent.indexOf("Firefox")>=0,window.dhx4.isIPad=navigator.userAgent.search(/iPad/gi)>=0),"undefined"==typeof window.dhx4.ajax&&(window.dhx4.ajax={cache:!1,method:"post",get:function(e,t){this._call("GET",e,null,!0,t)},getSync:function(e){return this._call("GET",e,null,!1)},post:function(e,t,i){1==arguments.length?t="":2!=arguments.length||"function"!=typeof t&&"function"!=typeof window[t]?t=String(t):(i=t,t=""),this._call("POST",e,t,!0,i)},postSync:function(e,t){return t=null==t?"":String(t),this._call("POST",e,t,!1)},getLong:function(e,t){this._call("GET",e,null,!0,t,{url:e})},postLong:function(e,t,i){2==arguments.length&&(i=t,t=""),this._call("POST",e,t,!0,i,{url:e,postData:t})},_call:function(e,t,i,n,a,r){var s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),l=null!=navigator.userAgent.match(/AppleWebKit/)&&null!=navigator.userAgent.match(/Qt/)&&null!=navigator.userAgent.match(/Safari/);return 1==n&&(s.onreadystatechange=function(){(4==s.readyState&&200==s.status||1==l&&3==s.readyState)&&window.setTimeout(function(){"function"==typeof a&&a.apply(window,[{xmlDoc:s}]),null!=r&&("undefined"!=typeof r.postData?dhx4.ajax.postLong(r.url,r.postData,a):dhx4.ajax.getLong(r.url,a)),a=null,s=null},1)}),"GET"==e&&1!=this.cache&&(t+=(t.indexOf("?")>=0?"&":"?")+"dhxr"+(new Date).getTime()),s.open(e,t,n),"POST"==e?(s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),1!=this.cache&&(i+=(i.length>0?"&":"")+"dhxr"+(new Date).getTime())):i=null,s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.send(i),n?void 0:{xmlDoc:s}}}),"undefined"==typeof window.dhx4._enableDataLoading&&(window.dhx4._enableDataLoading=function(obj,initObj,xmlToJson,xmlRootTag,mode){if("clear"==mode){for(var a in obj._dhxdataload)obj._dhxdataload[a]=null,delete obj._dhxdataload[a];return obj._loadData=null,obj._dhxdataload=null,obj.load=null,obj.loadStruct=null,void(obj=null)}if(obj._dhxdataload={initObj:initObj,xmlToJson:xmlToJson,xmlRootTag:xmlRootTag,onBeforeXLS:null},obj._loadData=function(data,loadParams,onLoad){2==arguments.length&&(onLoad=loadParams,loadParams=null);var obj=null;if(3==arguments.length&&(onLoad=arguments[2]),"string"==typeof data){var k=data.replace(/^\s{1,}/,"").replace(/\s{1,}$/,""),tag=new RegExp("^<"+this._dhxdataload.xmlRootTag);if(tag.test(k.replace(/^<\?xml[^\?]*\?>\s*/,""))&&(window.DOMParser?obj=(new window.DOMParser).parseFromString(data,"text/xml"):"undefined"!=typeof window.ActiveXObject&&(obj=new window.ActiveXObject("Microsoft.XMLDOM"),obj.async="false",obj.loadXML(data)),null!=obj&&(obj=this[this._dhxdataload.xmlToJson].apply(this,[obj]))),null==obj&&(null!=k.match(/^\{.*\}$/)||null!=k.match(/^\[.*\]$/))){try{eval("dhx4.temp="+k)}catch(e){dhx4.temp=null}obj=dhx4.temp,dhx4.temp=null}if(null==obj){this.callEvent("onXLS",[]);var params=[];if("function"==typeof this._dhxdataload.onBeforeXLS){var k=this._dhxdataload.onBeforeXLS.apply(this,[data]);if(null!=k&&"object"==typeof k&&(null!=k.url&&(data=k.url),null!=k.params))for(var a in k.params)params.push(a+"="+encodeURIComponent(k.params[a]))}var t=this,callBack=function(r){var obj=null;if((r.xmlDoc.getResponseHeader("Content-Type")||"").search(/xml/gi)>=0||null!=r.xmlDoc.responseText.replace(/^\s{1,}/,"").match(/^</))obj=t[t._dhxdataload.xmlToJson].apply(t,[r.xmlDoc.responseXML]);else{try{eval("dhx4.temp="+r.xmlDoc.responseText)}catch(e){dhx4.temp=null}obj=dhx4.temp,dhx4.temp=null}null!=obj&&t[t._dhxdataload.initObj].apply(t,[obj,data]),t.callEvent("onXLE",[]),null!=onLoad&&("function"==typeof onLoad?onLoad.apply(t,[]):"function"==typeof window[onLoad]&&window[onLoad].apply(t,[])),callBack=onLoad=null,obj=r=t=null};return params=params.join("&")+("string"==typeof loadParams?"&"+loadParams:""),void("post"==dhx4.ajax.method?dhx4.ajax.post(data,params,callBack):"get"==dhx4.ajax.method&&dhx4.ajax.get(data+(data.indexOf("?")>0,"")+params,callBack))}}else obj="object"==typeof data.documentElement||"undefined"!=typeof data.tagName&&"undefined"!=typeof data.getElementsByTagName&&data.getElementsByTagName(this._dhxdataload.xmlRootTag).length>0?this[this._dhxdataload.xmlToJson].apply(this,[data]):window.dhx4._copyObj(data);null!=obj&&this[this._dhxdataload.initObj].apply(this,[obj]),null!=onLoad&&("function"==typeof onLoad?onLoad.apply(this,[]):"function"==typeof window[onLoad]&&window[onLoad].apply(this,[]),onLoad=null)},null!=mode){var k={struct:"loadStruct",data:"load"};for(var a in mode)1==mode[a]&&(obj[k[a]]=function(){return this._loadData.apply(this,arguments)})}obj=null}),"undefined"==typeof window.dhx4._eventable&&(window.dhx4._eventable=function(e,t){return"clear"==t?(e.detachAllEvents(),e.dhxevs=null,e.attachEvent=null,e.detachEvent=null,e.checkEvent=null,e.callEvent=null,e.detachAllEvents=null,void(e=null)):(e.dhxevs={data:{}},e.attachEvent=function(e,t){e=String(e).toLowerCase(),this.dhxevs.data[e]||(this.dhxevs.data[e]={});var i=window.dhx4.newId();return this.dhxevs.data[e][i]=t,i},e.detachEvent=function(e){for(var t in this.dhxevs.data){var i=0;for(var n in this.dhxevs.data[t])n==e?(this.dhxevs.data[t][n]=null,delete this.dhxevs.data[t][n]):i++;0==i&&(this.dhxevs.data[t]=null,delete this.dhxevs.data[t])}},e.checkEvent=function(e){return e=String(e).toLowerCase(),null!=this.dhxevs.data[e]},e.callEvent=function(e,t){if(e=String(e).toLowerCase(),null==this.dhxevs.data[e])return!0;var i=!0;for(var n in this.dhxevs.data[e])i=this.dhxevs.data[e][n].apply(this,t)&&i;return i},e.detachAllEvents=function(){for(var e in this.dhxevs.data){for(var t in this.dhxevs.data[e])this.dhxevs.data[e][t]=null,delete this.dhxevs.data[e][t];this.dhxevs.data[e]=null,delete this.dhxevs.data[e]}},void(e=null))}),dhtmlx=function(e){for(var t in e)dhtmlx[t]=e[t];return dhtmlx},dhtmlx.extend_api=function(e,t,i){var n=window[e];n&&(window[e]=function(e){if(e&&"object"==typeof e&&!e.tagName){var i=n.apply(this,t._init?t._init(e):arguments);for(var a in dhtmlx)t[a]&&this[t[a]](dhtmlx[a]);for(var a in e)t[a]?this[t[a]](e[a]):0==a.indexOf("on")&&this.attachEvent(a,e[a])}else var i=n.apply(this,arguments);return t._patch&&t._patch(this),i||this},window[e].prototype=n.prototype,i&&dhtmlXHeir(window[e].prototype,i))},dhtmlxAjax={get:function(e,t){var i=new dtmlXMLLoaderObject(!0);return i.async=arguments.length<3,i.waitCall=t,i.loadXML(e),i},post:function(e,t,i){var n=new dtmlXMLLoaderObject(!0);return n.async=arguments.length<4,n.waitCall=i,n.loadXML(e,!0,t),n},getSync:function(e){return this.get(e,null,!0)},postSync:function(e,t){return this.post(e,t,null,!0)}},dtmlXMLLoaderObject.count=0,dtmlXMLLoaderObject.prototype.waitLoadFunction=function(e){var t=!0;return this.check=function(){if(e&&null!=e.onloadAction&&(!e.xmlDoc.readyState||4==e.xmlDoc.readyState)){if(!t)return;t=!1,dtmlXMLLoaderObject.count++,"function"==typeof e.onloadAction&&e.onloadAction(e.mainObject,null,null,null,e),e.waitCall&&(e.waitCall.call(this,e),e.waitCall=null)}},this.check},dtmlXMLLoaderObject.prototype.getXMLTopNode=function(e,t){if("undefined"==typeof this.xmlDoc.status||this.xmlDoc.status<400){if(this.xmlDoc.responseXML){var i=this.xmlDoc.responseXML.getElementsByTagName(e);if(0==i.length&&-1!=e.indexOf(":"))var i=this.xmlDoc.responseXML.getElementsByTagName(e.split(":")[1]);var n=i[0]}else var n=this.xmlDoc.documentElement;if(n)return this._retry=!1,n;if(!this._retry&&_isIE){this._retry=!0;var t=this.xmlDoc;return this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(e,t)}}return dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),document.createElement("DIV")},dtmlXMLLoaderObject.prototype.loadXMLString=function(e,t){if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(e);else{var i=new DOMParser;this.xmlDoc=i.parseFromString(e,"text/xml")}t||(this.onloadAction&&this.onloadAction(this.mainObject,null,null,null,this),this.waitCall&&(this.waitCall(),this.waitCall=null))},dtmlXMLLoaderObject.prototype.loadXML=function(e,t,i,n){this.rSeed&&(e+=(-1!=e.indexOf("?")?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf()),this.filePath=e,!_isIE&&window.XMLHttpRequest?this.xmlDoc=new XMLHttpRequest:this.xmlDoc=new ActiveXObject("Microsoft.XMLHTTP"),this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this)),this.xmlDoc.open(t?"POST":"GET",e,this.async),n?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type","text/xml")):t&&this.xmlDoc.setRequestHeader("Content-type",this.contenttype||"application/x-www-form-urlencoded"),this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xmlDoc.send(i),this.async||new this.waitLoadFunction(this)()},dtmlXMLLoaderObject.prototype.destructor=function(){return this._filterXPath=null,this._getAllNamedChilds=null,this._retry=null,this.async=null,this.rSeed=null,this.filePath=null,this.onloadAction=null,this.mainObject=null,this.xmlDoc=null,this.doXPath=null,this.doXPathOpera=null,this.doXSLTransToObject=null,this.doXSLTransToString=null,this.loadXML=null,this.loadXMLString=null,this.doSerialization=null,this.xmlNodeToJSON=null,this.getXMLTopNode=null,this.setXSLParamValue=null,null},dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(e){for(var t={},i=0;i<e.attributes.length;i++)t[e.attributes[i].name]=e.attributes[i].value;t._tagvalue=e.firstChild?e.firstChild.nodeValue:"";for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i].tagName;n&&(t[n]||(t[n]=[]),t[n].push(this.xmlNodeToJSON(e.childNodes[i])))}return t},dhtmlDragAndDropObject.prototype.removeDraggableItem=function(e){e.onmousedown=null,e.dragStarter=null,e.dragLanding=null},dhtmlDragAndDropObject.prototype.addDraggableItem=function(e,t){e.onmousedown=this.preCreateDragCopy,e.dragStarter=t,this.addDragLanding(e,t)},dhtmlDragAndDropObject.prototype.addDragLanding=function(e,t){e.dragLanding=t},dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){return!e&&!window.event||2!=(e||event).button?window.dhtmlDragAndDrop.waitDrag?(window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1):(window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(e),window.dhtmlDragAndDrop.waitDrag=1,window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup,window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove,window.dhtmlDragAndDrop.dragStartNode=this,window.dhtmlDragAndDrop.dragStartObject=this.dragStarter,document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy,document.body.onmousemove=window.dhtmlDragAndDrop.callDrag,window.dhtmlDragAndDrop.downtime=(new Date).valueOf(),e&&e.preventDefault?(e.preventDefault(),!1):!1):void 0},dhtmlDragAndDropObject.prototype.callDrag=function(e){if(e||(e=window.event),dragger=window.dhtmlDragAndDrop,!((new Date).valueOf()-dragger.downtime<100)){if(!dragger.dragNode){if(!dragger.waitDrag)return dragger.stopDrag(e,!0);if(dragger.dragNode=dragger.dragStartObject._createDragNode(dragger.dragStartNode,e),!dragger.dragNode)return dragger.stopDrag();dragger.dragNode.onselectstart=function(){return!1},dragger.gldragNode=dragger.dragNode,document.body.appendChild(dragger.dragNode),document.body.onmouseup=dragger.stopDrag,dragger.waitDrag=0,dragger.dragNode.pWindow=window,dragger.initFrameRoute()}if(dragger.dragNode.parentNode!=window.document.body&&dragger.gldragNode){var t=dragger.gldragNode;dragger.gldragNode.old&&(t=dragger.gldragNode.old),t.parentNode.removeChild(t);var i=dragger.dragNode.pWindow;if(t.pWindow&&t.pWindow.dhtmlDragAndDrop.lastLanding&&t.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(t.pWindow.dhtmlDragAndDrop.lastLanding),_isIE){var n=document.createElement("Div");n.innerHTML=dragger.dragNode.outerHTML,dragger.dragNode=n.childNodes[0]}else dragger.dragNode=dragger.dragNode.cloneNode(!0);dragger.dragNode.pWindow=window,dragger.gldragNode.old=dragger.dragNode,document.body.appendChild(dragger.dragNode),i.dhtmlDragAndDrop.dragNode=dragger.dragNode}if(dragger.dragNode.style.left=e.clientX+15+(dragger.fx?-1*dragger.fx:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px",dragger.dragNode.style.top=e.clientY+3+(dragger.fy?-1*dragger.fy:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px",e.srcElement)a=e.srcElement;else var a=e.target;dragger.checkLanding(a,e)}},dhtmlDragAndDropObject.prototype.calculateFramePosition=function(e){if(window.name){for(var t=parent.frames[window.name].frameElement.offsetParent,i=0,n=0;t;)i+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;if(parent.dhtmlDragAndDrop){var a=parent.dhtmlDragAndDrop.calculateFramePosition(1);i+=1*a.split("_")[0],n+=1*a.split("_")[1]}if(e)return i+"_"+n;this.fx=i,this.fy=n}return"0_0"},dhtmlDragAndDropObject.prototype.checkLanding=function(e,t){e&&e.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=e,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,t.clientX,t.clientY,t),this.lastLanding_scr=_isIE?t.srcElement:t.target):e&&"BODY"!=e.tagName?this.checkLanding(e.parentNode,t):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,t.clientX,t.clientY,t),this.lastLanding=0,this._onNotFound&&this._onNotFound())},dhtmlDragAndDropObject.prototype.stopDrag=function(e,t){if(dragger=window.dhtmlDragAndDrop,!t){dragger.stopFrameRoute();var i=dragger.lastLanding;dragger.lastLanding=null,i&&i.dragLanding._drag(dragger.dragStartNode,dragger.dragStartObject,i,_isIE?event.srcElement:e.target)}dragger.lastLanding=null,dragger.dragNode&&dragger.dragNode.parentNode==document.body&&dragger.dragNode.parentNode.removeChild(dragger.dragNode),dragger.dragNode=0,dragger.gldragNode=0,dragger.fx=0,dragger.fy=0,dragger.dragStartNode=0,dragger.dragStartObject=0,document.body.onmouseup=dragger.tempDOMU,document.body.onmousemove=dragger.tempDOMM,dragger.tempDOMU=null,dragger.tempDOMM=null,dragger.waitDrag=0},dhtmlDragAndDropObject.prototype.stopFrameRoute=function(e){e&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var t=0;t<window.frames.length;t++)try{window.frames[t]!=e&&window.frames[t].dhtmlDragAndDrop&&window.frames[t].dhtmlDragAndDrop.stopFrameRoute(window)}catch(i){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(i){}},dhtmlDragAndDropObject.prototype.initFrameRoute=function(e,t){e&&(window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=e.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=e.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=e.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=e.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&t&&(!_isFF||_FFrv<1.8)&&window.dhtmlDragAndDrop.calculateFramePosition());try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(i){}for(var n=0;n<window.frames.length;n++)try{window.frames[n]!=e&&window.frames[n].dhtmlDragAndDrop&&window.frames[n].dhtmlDragAndDrop.initFrameRoute(window,!e||t?1:0)}catch(i){}},_isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,(-1!=navigator.appVersion.indexOf("MSIE 8.0")||-1!=navigator.appVersion.indexOf("MSIE 9.0")||-1!=navigator.appVersion.indexOf("MSIE 10.0")||document.documentMode>7)&&"BackCompat"!=document.compatMode&&(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),dtmlXMLLoaderObject.prototype.doXPath=function(e,t,i,n){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(e,t);if(_isIE)return t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),null!=i&&t.setProperty("SelectionNamespaces","xmlns:xsl='"+i+"'"),"single"==n?t.selectSingleNode(e):t.selectNodes(e)||new Array(0);var a=t;t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),-1!=t.nodeName.indexOf("document")?a=t:(a=t,t=t.ownerDocument);var r=XPathResult.ANY_TYPE;"single"==n&&(r=XPathResult.FIRST_ORDERED_NODE_TYPE);var s=new Array,l=t.evaluate(e,a,function(e){return i},r,null);if(r==XPathResult.FIRST_ORDERED_NODE_TYPE)return l.singleNodeValue;for(var o=l.iterateNext();o;)s[s.length]=o,o=l.iterateNext();return s},_dhtmlxError.prototype.catchError=function(e,t){this.catches[e]=t},_dhtmlxError.prototype.throwError=function(e,t,i){return this.catches[e]?this.catches[e](e,t,i):this.catches.ALL?this.catches.ALL(e,t,i):(alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]),null)},window.dhtmlxError=new _dhtmlxError,dtmlXMLLoaderObject.prototype.doXPathOpera=function(e,t){var i=e.replace(/[\/]+/gi,"/").split("/"),n=null,a=1;if(!i.length)return[];if("."==i[0])n=[t];else{if(""!=i[0])return[];n=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(i[a].replace(/\[[^\]]*\]/g,"")),a++}for(a;a<i.length;a++)n=this._getAllNamedChilds(n,i[a]);return-1!=i[a-1].indexOf("[")&&(n=this._filterXPath(n,i[a-1])),n},dtmlXMLLoaderObject.prototype._filterXPath=function(e,t){for(var i=new Array,t=t.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),n=0;n<e.length;n++)e[n].getAttribute(t)&&(i[i.length]=e[n]);return i},dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(e,t){var i=new Array;_isKHTML&&(t=t.toUpperCase());for(var n=0;n<e.length;n++)for(var a=0;a<e[n].childNodes.length;a++)_isKHTML?e[n].childNodes[a].tagName&&e[n].childNodes[a].tagName.toUpperCase()==t&&(i[i.length]=e[n].childNodes[a]):e[n].childNodes[a].tagName==t&&(i[i.length]=e[n].childNodes[a]);return i},dtmlXMLLoaderObject.prototype.xslDoc=null,dtmlXMLLoaderObject.prototype.setXSLParamValue=function(e,t,i){i||(i=this.xslDoc),i.responseXML&&(i=i.responseXML);var n=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+e+"']",i,"http://www.w3.org/1999/XSL/Transform","single");null!=n&&(n.firstChild.nodeValue=t)},dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(e,t){if(e||(e=this.xslDoc),e.responseXML&&(e=e.responseXML),t||(t=this.xmlDoc),t.responseXML&&(t=t.responseXML),_isIE){var i=new ActiveXObject("Msxml2.DOMDocument.3.0");try{t.transformNodeToObject(e,i)}catch(n){i=t.transformNode(e)}}else{this.XSLProcessor||(this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(e));var i=this.XSLProcessor.transformToDocument(t)}return i},dtmlXMLLoaderObject.prototype.doXSLTransToString=function(e,t){var i=this.doXSLTransToObject(e,t);return"string"==typeof i?i:this.doSerialization(i)},dtmlXMLLoaderObject.prototype.doSerialization=function(e){if(e||(e=this.xmlDoc),e.responseXML&&(e=e.responseXML),_isIE)return e.xml;var t=new XMLSerializer;return t.serializeToString(e)},dhtmlxEventable=function(obj){obj.attachEvent=function(e,t,i){return e="ev_"+e.toLowerCase(),this[e]||(this[e]=new this.eventCatcher(i||this)),e+":"+this[e].addEvent(t)},obj.callEvent=function(e,t){return e="ev_"+e.toLowerCase(),this[e]?this[e].apply(this,t):!0},obj.checkEvent=function(e){return!!this["ev_"+e.toLowerCase()]},obj.eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var e=!0,t=0;t<dhx_catch.length;t++)if(null!=dhx_catch[t]){var i=dhx_catch[t].apply(obj,arguments);e=e&&i}return e};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),ev?dhx_catch.push(ev)-1:!1},z.removeEvent=function(e){dhx_catch[e]=null},z},obj.detachEvent=function(e){if(0!=e){var t=e.split(":");this[t[0]].removeEvent(t[1])}},obj.detachAllEvents=function(){for(var e in this)0==e.indexOf("ev_")&&(this.detachEvent(e),this[e]=null)},obj=null},dhtmlXMenuObject.prototype._init=function(){1!=this._isInited&&(this.conf.dload?(this._dhxdataload.onBeforeXLS=function(){var e={params:{}};for(var t in this.conf.dload_params)e.params[t]=this.conf.dload_params[t];return e},this.loadStruct(this.conf.dload_url)):(this._initTopLevelMenu(),this._isInited=!0))},dhtmlXMenuObject.prototype._countVisiblePolygonItems=function(e){var t=0;for(var i in this.itemPull){var n=this.itemPull[i].parent,a=this.itemPull[i].type;null!=this.idPull[i]&&(n!=e||"item"!=a&&"radio"!=a&&"checkbox"!=a||"none"==this.idPull[i].style.display||t++)}return t},dhtmlXMenuObject.prototype._redefineComplexState=function(e){if(this.idPrefix+this.topId!=e&&null!=this.idPull["polygon_"+e]&&null!=this.idPull[e]){var t=this._countVisiblePolygonItems(e);t>0&&!this.itemPull[e].complex&&this._updateItemComplexState(e,!0,!1),0==t&&this.itemPull[e].complex&&this._updateItemComplexState(e,!1,!1)}},dhtmlXMenuObject.prototype._updateItemComplexState=function(e,t,i){if(!this.conf.context&&"TopLevel"==this._getItemLevelType(e.replace(this.idPrefix,"")))return void(this.itemPull[e].complex=t);if(null!=this.idPull[e]&&null!=this.itemPull[e]&&(this.itemPull[e].complex=t,e!=this.idPrefix+this.topId)){var n=null,a=this.idPull[e].childNodes[this.conf.rtl?0:2];if(a.childNodes[0]&&0===String(a.childNodes[0].className).search("complex_arrow")&&(n=a.childNodes[0]),this.itemPull[e].complex){if(null==n){for(n=document.createElement("DIV"),n.className="complex_arrow",n.id="arrow_"+e;a.childNodes.length>0;)a.removeChild(a.childNodes[0]);a.appendChild(n)}return void(this.conf.dload&&"get"==this.itemPull[e].loaded&&this.conf.dload_icon?"complex_arrow_loading"!=n.className&&(n.className="complex_arrow_loading"):n.className="complex_arrow")}this.itemPull[e].complex||null==n||(a.removeChild(n),null!=this.itemPull[e].hotkey_backup&&this.setHotKey&&this.setHotKey(e.replace(this.idPrefix,""),this.itemPull[e].hotkey_backup))}},dhtmlXMenuObject.prototype._getItemLevelType=function(e){return this.itemPull[this.idPrefix+e].parent==this.idPrefix+this.topId?"TopLevel":"SubLevelArea"},dhtmlXMenuObject.prototype.setIconsPath=function(e){this.conf.icons_path=e},dhtmlXMenuObject.prototype._updateItemImage=function(e,t){e=this.idPrefix+e;var i=this.itemPull[e].parent==this.idPrefix+this.topId&&!this.conf.context,n=null;if(i)for(var a=0;a<this.idPull[e].childNodes.length;a++)try{"dhtmlxMenu_TopLevel_Item_Icon"==this.idPull[e].childNodes[a].className&&(n=this.idPull[e].childNodes[a])}catch(r){}else{try{var n=this.idPull[e].childNodes[this.conf.rtl?2:0].childNodes[0]}catch(r){}(null==n||"undefined"==typeof n.className||"sub_icon"!=n.className)&&(n=null)}if("radio"==this.itemPull[e].type)var s=this.itemPull[e]["enabled"==this.itemPull[e].state?"imgen":"imgdis"];else var s=this.itemPull[e]["enabled"==this.itemPull[e].state?"imgen":"imgdis"];if(s.length>0)if(null!=n)n.src=this.conf.icons_path+s;else if(i){var n=document.createElement("IMG");n.className="dhtmlxMenu_TopLevel_Item_Icon",n.src=this.conf.icons_path+s,n.border="0",n.id="image_"+e,!this.conf.rtl&&this.idPull[e].childNodes.length>0?this.idPull[e].insertBefore(n,this.idPull[e].childNodes[0]):this.idPull[e].appendChild(n)}else{var n=document.createElement("IMG");n.className="sub_icon",n.src=this.conf.icons_path+s,n.border="0",n.id="image_"+e;for(var l=this.idPull[e].childNodes[this.conf.rtl?2:0];l.childNodes.length>0;)l.removeChild(l.childNodes[0]);l.appendChild(n)}else if(null!=n){var o=n.parentNode;o.removeChild(n),o.innerHTML="&nbsp;",o=n=null}},dhtmlXMenuObject.prototype._getAllParents=function(e){var t=new Array;for(var i in this.itemPull)if(this.itemPull[i].parent==e&&(t[t.length]=this.itemPull[i].id,this.itemPull[i].complex))for(var n=this._getAllParents(this.itemPull[i].id),a=0;a<n.length;a++)t[t.length]=n[a];return t},dhtmlXMenuObject.prototype._autoDetectVisibleArea=function(){if(!this.conf.v_enabled){var e=window.dhx4.screenDim();this.conf.v.x1=e.left,this.conf.v.x2=e.right,this.conf.v.y1=e.top,this.conf.v.y2=e.bottom}},dhtmlXMenuObject.prototype.getItemPosition=function(e){e=this.idPrefix+e;var t=-1;if(null==this.itemPull[e])return t;for(var i=this.itemPull[e].parent,n=null!=this.idPull["polygon_"+i]?this.idPull["polygon_"+i].tbd:this.cont,a=0;a<n.childNodes.length;a++)(n.childNodes[a]==this.idPull["separator_"+e]||n.childNodes[a]==this.idPull[e])&&(t=a);return t},dhtmlXMenuObject.prototype.setItemPosition=function(e,t){if(e=this.idPrefix+e,null!=this.idPull[e]){var i=this.itemPull[e].parent==this.idPrefix+this.topId,n=this.idPull[e],a=this.getItemPosition(e.replace(this.idPrefix,"")),r=this.itemPull[e].parent,s=null!=this.idPull["polygon_"+r]?this.idPull["polygon_"+r].tbd:this.cont;
s.removeChild(s.childNodes[a]),0>t&&(t=0),i&&1>t&&(t=1),t<s.childNodes.length?s.insertBefore(n,s.childNodes[t]):s.appendChild(n)}},dhtmlXMenuObject.prototype.getParentId=function(e){return e=this.idPrefix+e,null==this.itemPull[e]?null:(null!=this.itemPull[e].parent?this.itemPull[e].parent:this.topId).replace(this.idPrefix,"")},dhtmlXMenuObject.prototype.hide=function(){this._clearAndHide()},dhtmlXMenuObject.prototype.clearAll=function(){this.removeItem(this.idPrefix+this.topId,!0),this._isInited=!1,this.idPrefix=this._genStr(12)+"_",this.itemPull={}},"undefined"==typeof dhtmlXMenuObject.prototype.liveInst&&(dhtmlXMenuObject.prototype.liveInst={}),dhtmlXMenuObject.prototype._redistribTopLevelSelection=function(e,t){var i=this._getSubItemToDeselectByPolygon("parent");this._removeSubItemFromSelected(-1,-1);for(var n=0;n<i.length;n++)i[n]!=e&&this._hidePolygon(i[n]),null!=this.idPull[i[n]]&&i[n]!=e&&(this.idPull[i[n]].className=this.idPull[i[n]].className.replace(/Selected/g,"Normal"));"enabled"==this.itemPull[this.idPrefix+e].state&&(this.idPull[this.idPrefix+e].className="dhtmlxMenu_"+this.conf.skin+"_TopLevel_Item_Selected",this._addSubItemToSelected(this.idPrefix+e,"parent"),this.conf.selected="win"==this.conf.mode?-1!=this.conf.selected?e:this.conf.selected:e,this.itemPull[this.idPrefix+e].complex&&-1!=this.conf.selected&&this._showPolygon(this.idPrefix+e,this.conf.dir_toplv))},dhtmlXMenuObject.prototype._initTopLevelMenu=function(){if(this.conf.dir_toplv="bottom",this.conf.dir_sublv=this.conf.rtl?"left":"right",this.conf.context)this.idPull[this.idPrefix+this.topId]=new Array(0,0),this._addSubMenuPolygon(this.idPrefix+this.topId,this.idPrefix+this.topId);else for(var e=this._getMenuNodes(this.idPrefix+this.topId),t=0;t<e.length;t++)"item"==this.itemPull[e[t]].type&&this._renderToplevelItem(e[t],null),"separator"==this.itemPull[e[t]].type&&this._renderSeparator(e[t],null)},dhtmlXMenuObject.prototype._renderToplevelItem=function(e,t){var i=this,n=document.createElement("DIV");if(n.id=e,"enabled"==this.itemPull[e].state&&null!=this.itemPull[e].cssNormal?n.className=this.itemPull[e].cssNormal:n.className="dhtmlxMenu_"+this.conf.skin+"_TopLevel_Item_"+("enabled"==this.itemPull[e].state?"Normal":"Disabled"),""!=this.itemPull[e].title){var a=document.createElement("DIV");a.className="top_level_text",a.innerHTML=this.itemPull[e].title,n.appendChild(a)}if(this.itemPull[e].tip.length>0&&(n.title=this.itemPull[e].tip),""!=this.itemPull[e].imgen||""!=this.itemPull[e].imgdis){var r=this.itemPull[e]["enabled"==this.itemPull[e].state?"imgen":"imgdis"];if(r){var s=document.createElement("IMG");s.border="0",s.id="image_"+e,s.src=this.conf.icons_path+r,s.className="dhtmlxMenu_TopLevel_Item_Icon",n.childNodes.length>0&&!this.conf.rtl?n.insertBefore(s,n.childNodes[0]):n.appendChild(s)}}n.onselectstart=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1},n.oncontextmenu=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1},this.cont||(this.cont=document.createElement("DIV"),this.cont.dir="ltr",this.cont.className="right"==this.conf.align?"align_right":"align_left",this.base.appendChild(this.cont)),null!=t&&(t++,0>t&&(t=0),t>this.cont.childNodes.length-1&&(t=null)),null!=t?this.cont.insertBefore(n,this.cont.childNodes[t]):this.cont.appendChild(n),this.idPull[n.id]=n,this.itemPull[e].complex&&!this.conf.dload&&this._addSubMenuPolygon(this.itemPull[e].id,this.itemPull[e].id),n.onmouseover=function(){"web"==i.conf.mode&&window.clearTimeout(i.conf.tm_handler);var e=i._getSubItemToDeselectByPolygon("parent");i._removeSubItemFromSelected(-1,-1);for(var t=0;t<e.length;t++)e[t]!=this.id&&i._hidePolygon(e[t]),null!=i.idPull[e[t]]&&e[t]!=this.id&&(null!=i.itemPull[e[t]].cssNormal?i.idPull[e[t]].className=i.itemPull[e[t]].cssNormal:("sub_item_selected"==i.idPull[e[t]].className&&(i.idPull[e[t]].className="sub_item"),i.idPull[e[t]].className=i.idPull[e[t]].className.replace(/Selected/g,"Normal")));if("enabled"==i.itemPull[this.id].state){if(this.className="dhtmlxMenu_"+i.conf.skin+"_TopLevel_Item_Selected",i._addSubItemToSelected(this.id,"parent"),i.conf.selected="win"==i.conf.mode?-1!=i.conf.selected?this.id:i.conf.selected:this.id,i.conf.dload){if("no"==i.itemPull[this.id].loaded){this._dynLoadTM=(new Date).getTime(),i.itemPull[this.id].loaded="get";var n=this.id.replace(i.idPrefix,"");i._dhxdataload.onBeforeXLS=function(){var e={params:{}};e.params[this.conf.dload_pid]=n;for(var t in this.conf.dload_params)e.params[t]=this.conf.dload_params[t];return e},i.loadStruct(i.conf.dload_url)}i.conf.top_mode&&"web"==i.conf.mode&&!i.conf.context&&(this._mouseOver=!0)}if((!i.conf.dload||i.conf.dload&&(!i.itemPull[this.id].loaded||"yes"==i.itemPull[this.id].loaded))&&i.itemPull[this.id].complex&&-1!=i.conf.selected)if(i.conf.top_mode&&"web"==i.conf.mode&&!i.conf.context){this._mouseOver=!0;var a=this.id;this._menuOpenTM=window.setTimeout(function(){i._showPolygon(a,i.conf.dir_toplv)},i.conf.top_tmtime)}else i._showPolygon(this.id,i.conf.dir_toplv)}i._doOnTouchMenu(this.id.replace(i.idPrefix,""))},n.onmouseout=function(){i.itemPull[this.id].complex&&-1!=i.conf.selected||"enabled"!=i.itemPull[this.id].state||(null!=i.itemPull[this.id].cssNormal?n.className=i.itemPull[this.id].cssNormal:n.className="dhtmlxMenu_"+i.conf.skin+"_TopLevel_Item_Normal"),"web"==i.conf.mode&&(window.clearTimeout(i.conf.tm_handler),i.conf.tm_handler=window.setTimeout(function(){i._clearAndHide()},i.conf.tm_sec,"JavaScript")),i.conf.top_mode&&"web"==i.conf.mode&&!i.conf.context&&(this._mouseOver=!1,window.clearTimeout(this._menuOpenTM))},n.onclick=function(e){if("web"==i.conf.mode&&window.clearTimeout(i.conf.tm_handler),"web"==i.conf.mode||"disabled"!=i.itemPull[this.id].state){if(e=e||event,e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,"win"==i.conf.mode&&i.itemPull[this.id].complex){if(i.conf.selected==this.id){i.conf.selected=-1;var t=!1}else{i.conf.selected=this.id;var t=!0}t?i._showPolygon(this.id,i.conf.dir_toplv):i._hidePolygon(this.id)}var n=i.itemPull[this.id].complex?"c":"-",a="enabled"!=i.itemPull[this.id].state?"d":"-",r={ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey};return i._doOnClick(this.id.replace(i.idPrefix,""),n+a+"t",r),!1}},"dhx_terrace"==this.conf.skin&&this._improveTerraceSkin()},dhtmlXMenuObject.prototype._addSubMenuPolygon=function(e,t){var i=(this._renderSublevelPolygon(e,t),this._getMenuNodes(t));for(n=0;n<i.length;n++)"separator"==this.itemPull[i[n]].type?this._renderSeparator(i[n],null):this._renderSublevelItem(i[n],null);if(e==t);else;for(var n=0;n<i.length;n++)this.itemPull[i[n]].complex&&this._addSubMenuPolygon(e,this.itemPull[i[n]].id)},dhtmlXMenuObject.prototype._renderSublevelPolygon=function(e,t){var i=document.createElement("DIV");i.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_Polygon "+(this.conf.rtl?"dir_right":""),i.dir="ltr",i.oncontextmenu=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,e.cancelBubble=!0,!1},i.id="polygon_"+t,i.onclick=function(e){e=e||event,e.cancelBubble=!0},i.style.display="none",document.body.insertBefore(i,document.body.firstChild),i.innerHTML='<div style="position:relative;"></div><div style="position: relative; overflow:hidden;"></div><div style="position:relative;"></div>';var n=document.createElement("TABLE");n.className="dhtmlxMebu_SubLevelArea_Tbl",n.cellSpacing=0,n.cellPadding=0,n.border=0;var a=document.createElement("TBODY");return n.appendChild(a),i.childNodes[1].appendChild(n),i.tbl=n,i.tbd=a,this.idPull[i.id]=i,null!=this.sxDacProc&&(this.idPull["sxDac_"+t]=new this.sxDacProc(i,i.className),window.dhx4.isIE?(this.idPull["sxDac_"+t]._setSpeed(this.dacSpeedIE),this.idPull["sxDac_"+t]._setCustomCycle(this.dacCyclesIE)):(this.idPull["sxDac_"+t]._setSpeed(this.dacSpeed),this.idPull["sxDac_"+t]._setCustomCycle(this.dacCycles))),i},dhtmlXMenuObject.prototype._renderSublevelItem=function(e,t){var i=this,n=document.createElement("TR");n.className="enabled"==this.itemPull[e].state?"sub_item":"sub_item_dis";var a=document.createElement("TD");a.className="sub_item_icon";var r=this.itemPull[e]["enabled"==this.itemPull[e].state?"imgen":"imgdis"];if(""!=r){var s=this.itemPull[e].type;if("checkbox"==s||"radio"==s){var l=document.createElement("DIV");l.id="image_"+this.itemPull[e].id,l.className="sub_icon "+r,a.appendChild(l)}if("checkbox"!=s&&"radio"!=s){var l=document.createElement("IMG");l.id="image_"+this.itemPull[e].id,l.className="sub_icon",l.src=this.conf.icons_path+r,a.appendChild(l)}}else a.innerHTML="&nbsp;";var o=document.createElement("TD");if(o.className="sub_item_text",""!=this.itemPull[e].title){var d=document.createElement("DIV");d.className="sub_item_text",d.innerHTML=this.itemPull[e].title,o.appendChild(d)}else o.innerHTML="&nbsp;";var h=document.createElement("TD");if(h.className="sub_item_hk",this.itemPull[e].complex){var _=document.createElement("DIV");_.className="complex_arrow",_.id="arrow_"+this.itemPull[e].id,h.appendChild(_)}else if(this.itemPull[e].hotkey.length>0&&!this.itemPull[e].complex){var c=document.createElement("DIV");c.className="sub_item_hk",c.innerHTML=this.itemPull[e].hotkey,h.appendChild(c)}else h.innerHTML="&nbsp;";n.appendChild(this.conf.rtl?h:a),n.appendChild(o),n.appendChild(this.conf.rtl?a:h),n.id=this.itemPull[e].id,n.parent=this.itemPull[e].parent,this.itemPull[e].tip.length>0&&(n.title=this.itemPull[e].tip),n.onselectstart=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1},n.onmouseover=function(e){i.conf.hide_tm[this.id]&&window.clearTimeout(i.conf.hide_tm[this.id]),"web"==i.conf.mode&&window.clearTimeout(i.conf.tm_handler),this._visible||i._redistribSubLevelSelection(this.id,this.parent),this._visible=!0},n.onmouseout=function(){"web"==i.conf.mode&&(i.conf.tm_handler&&window.clearTimeout(i.conf.tm_handler),i.conf.tm_handler=window.setTimeout(function(){i&&i._clearAndHide&&i._clearAndHide()},i.conf.tm_sec,"JavaScript"));var e=this;i.conf.hide_tm[this.id]&&window.clearTimeout(i.conf.hide_tm[this.id]),i.conf.hide_tm[this.id]=window.setTimeout(function(){e._visible=!1},50)},n.onclick=function(e){if(i.checkEvent("onClick")||!i.itemPull[this.id].complex){e=e||event,e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,tc=i.itemPull[this.id].complex?"c":"-",td="enabled"==i.itemPull[this.id].state?"-":"d";var t={ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey};switch(i.itemPull[this.id].type){case"checkbox":i._checkboxOnClickHandler(this.id.replace(i.idPrefix,""),tc+td+"n",t);break;case"radio":i._radioOnClickHandler(this.id.replace(i.idPrefix,""),tc+td+"n",t);break;case"item":i._doOnClick(this.id.replace(i.idPrefix,""),tc+td+"n",t)}return!1}};var u=this.idPull["polygon_"+this.itemPull[e].parent];null!=t&&(t++,0>t&&(t=0),t>u.tbd.childNodes.length-1&&(t=null)),null!=t&&null!=u.tbd.childNodes[t]?u.tbd.insertBefore(n,u.tbd.childNodes[t]):u.tbd.appendChild(n),this.idPull[n.id]=n},dhtmlXMenuObject.prototype._renderSeparator=function(e,t){var i=this.conf.context?"SubLevelArea":this.itemPull[e].parent==this.idPrefix+this.topId?"TopLevel":"SubLevelArea";if("TopLevel"!=i||!this.conf.context){var n=this;if("TopLevel"!=i){var a=document.createElement("TR");a.className="sub_sep";var r=document.createElement("TD");r.colSpan="3",a.appendChild(r)}var s=document.createElement("DIV");if(s.id="separator_"+e,s.className="TopLevel"==i?"top_sep":"sub_sep",s.onselectstart=function(e){e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1},s.onclick=function(e){e=e||event,e.cancelBubble=!0;var t={ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey};n._doOnClick(this.id.replace("separator_"+n.idPrefix,""),"--s",t)},"TopLevel"==i){if(null!=t)t++,0>t&&(t=0),null!=this.cont.childNodes[t]?this.cont.insertBefore(s,this.cont.childNodes[t]):this.cont.appendChild(s);else{var l=this.cont.childNodes[this.cont.childNodes.length-1];-1==String(l).search("TopLevel_Text")?this.cont.appendChild(s):this.cont.insertBefore(s,l)}this.idPull[s.id]=s}else{var o=this.idPull["polygon_"+this.itemPull[e].parent];null!=t&&(t++,0>t&&(t=0),t>o.tbd.childNodes.length-1&&(t=null)),null!=t&&null!=o.tbd.childNodes[t]?o.tbd.insertBefore(a,o.tbd.childNodes[t]):o.tbd.appendChild(a),r.appendChild(s),this.idPull[s.id]=a}}},dhtmlXMenuObject.prototype.addNewSeparator=function(e,t){t=this.idPrefix+(null!=t?t:this._genStr(24));var i=this.idPrefix+this.getParentId(e);this._addItemIntoGlobalStrorage(t,i,"","separator",!1,"",""),this._renderSeparator(t,this.getItemPosition(e))},dhtmlXMenuObject.prototype._initObj=function(e,t,i){e instanceof Array||(i=e.parentId,null!=i&&0!==String(i).indexOf(this.idPrefix)&&(i=this.idPrefix+String(i)),e=e.items);for(var n=0;n<e.length;n++){("undefined"==typeof e[n].id||null==e[n].id)&&(e[n].id=this._genStr(24)),0!==String(e[n].id).indexOf(this.idPrefix)&&(e[n].id=this.idPrefix+String(e[n].id));var a={type:"item",tip:"",hotkey:"",state:"enabled",imgen:"",imgdis:""};for(var r in a)"undefined"==typeof e[n][r]&&(e[n][r]=a[r]);if(""==e[n].imgen&&null!=e[n].img&&(e[n].imgen=e[n].img),""==e[n].imgdis&&null!=e[n].img_disabled&&(e[n].imgdis=e[n].img_disabled),null==e[n].title&&null!=e[n].text&&(e[n].title=e[n].text),null!=e[n].href&&(null!=e[n].href.link&&(e[n].href_link=e[n].href.link),null!=e[n].href.target&&(e[n].href_target=e[n].href.target)),null!=e[n].userdata)for(var r in e[n].userdata)this.userData[e[n].id+"_"+r]=e[n].userdata[r];"undefined"!=typeof e[n].enabled&&0==window.dhx4.s2b(e[n].enabled)?e[n].state="disabled":"undefined"!=typeof e[n].disabled&&1==window.dhx4.s2b(e[n].disabled)&&(e[n].state="disabled"),"undefined"==typeof e[n].parent&&(e[n].parent=null!=i?i:this.idPrefix+this.topId),"checkbox"==e[n].type&&(e[n].checked=window.dhx4.s2b(e[n].checked),e[n].imgen=e[n].imgdis="chbx_"+(e[n].checked?"1":"0")),"radio"==e[n].type&&(e[n].checked=window.dhx4.s2b(e[n].checked),e[n].imgen=e[n].imgdis="rdbt_"+(e[n].checked?"1":"0"),("undefined"==typeof e[n].group||null==e[n].group)&&(e[n].group=this._genStr(24)),null==this.radio[e[n].group]&&(this.radio[e[n].group]=[]),this.radio[e[n].group].push(e[n].id)),this.itemPull[e[n].id]=e[n],null!=e[n].items&&e[n].items.length>0?(this.itemPull[e[n].id].complex=!0,this._initObj(e[n].items,!0,e[n].id)):this.conf.dload&&1==e[n].complex&&(this.itemPull[e[n].id].loaded="no"),this.itemPull[e[n].id].items=null}if(t!==!0)if(1==this.conf.dload)if(null==i)this._initTopLevelMenu();else{if(this._addSubMenuPolygon(i,i),this.conf.selected==i){var s=this.itemPull[i].parent==this.idPrefix+this.topId,l=s&&!this.conf.context?this.conf.dir_toplv:this.conf.dir_sublv,o=!1;if(s&&this.conf.top_mode&&"web"==this.conf.mode&&!this.conf.context){var d=this.idPull[i];if(1==d._mouseOver){var h=this.conf.top_tmtime-((new Date).getTime()-d._dynLoadTM);if(h>1){var _=i,c=this;d._menuOpenTM=window.setTimeout(function(){c._showPolygon(_,l),c=_=null},h),o=!0}}}o||this._showPolygon(i,l)}this.itemPull[i].loaded="yes",1==this.conf.dload_icon&&this._updateLoaderIcon(i,!1)}else this._init()},dhtmlXMenuObject.prototype._xmlToJson=function(e,t){var i=[];if(null==t){var n=e.getElementsByTagName(this.conf.tags.root);if(null==n||0==n.length)return data;n=n[0]}else n=e;null!=n.getAttribute("parentId")&&(t=this.idPrefix+n.getAttribute("parentId"));for(var a=0;a<n.childNodes.length;a++)if("undefined"!=typeof n.childNodes[a].tagName&&String(n.childNodes[a].tagName).toLowerCase()==this.conf.tags.item){var r=n.childNodes[a],s={id:this.idPrefix+(r.getAttribute("id")||this._genStr(24)),title:r.getAttribute("text")||"",imgen:r.getAttribute("img")||"",imgdis:r.getAttribute("imgdis")||"",tip:"",hotkey:"",type:r.getAttribute("type")||"item"};if(null!=r.getAttribute("cssNormal")&&(s.cssNormal=r.getAttribute("cssNormal")),"checkbox"==s.type&&(s.checked=r.getAttribute("checked")),"radio"==s.type&&(s.checked=r.getAttribute("checked"),s.group=r.getAttribute("group")),s.state="enabled",null!=r.getAttribute("enabled")&&0==window.dhx4.s2b(r.getAttribute("enabled"))?s.state="disabled":null!=r.getAttribute("disabled")&&1==window.dhx4.s2b(r.getAttribute("disabled"))&&(s.state="disabled"),s.parent=null!=t?t:this.idPrefix+this.topId,this.conf.dload)s.complex=null!=r.getAttribute("complex"),s.complex&&(s.loaded="no");else{var l=this._xmlToJson(r,s.id);s.items=l.items,s.complex=s.items.length>0}for(var o=0;o<r.childNodes.length;o++)if("undefined"!=typeof r.childNodes[o].tagName){var d=String(r.childNodes[o].tagName||"").toLowerCase();if(d==this.conf.tags.userdata){var h=r.childNodes[o];null!=h.getAttribute("name")&&(this.userData[s.id+"_"+h.getAttribute("name")]=null!=h.firstChild&&null!=h.firstChild.nodeValue?h.firstChild.nodeValue:"")}d==this.conf.tags.text_ext&&(s.title=r.childNodes[o].firstChild.nodeValue),d==this.conf.tags.tooltip&&(s.tip=r.childNodes[o].firstChild.nodeValue),d==this.conf.tags.hotkey&&(s.hotkey=r.childNodes[o].firstChild.nodeValue),d==this.conf.tags.href&&"item"==s.type&&(s.href_link=r.childNodes[o].firstChild.nodeValue,null!=r.childNodes[o].getAttribute("target")&&(s.href_target=r.childNodes[o].getAttribute("target")))}i.push(s)}var r={parentId:t,items:i};return r},dhtmlXMenuObject.prototype.enableDynamicLoading=function(e,t){this.conf.dload=!0,this.conf.dload_url=e,this.conf.dload_sign=-1==String(this.conf.dload_url).search(/\?/)?"?":"&",this.conf.dload_icon=t,this._init()},dhtmlXMenuObject.prototype._updateLoaderIcon=function(e,t){if(null!=this.idPull[e]&&!(String(this.idPull[e].className).search("TopLevel_Item")>=0)){var i=this.conf.rtl?0:2;if(this.idPull[e].childNodes[i]&&this.idPull[e].childNodes[i].childNodes[0]){var n=this.idPull[e].childNodes[i].childNodes[0];0===String(n.className).search("complex_arrow")&&(n.className="complex_arrow"+(t?"_loading":""))}}},dhtmlXMenuObject.prototype.addNewSibling=function(e,t,i,n,a,r){var s=this.idPrefix+(null!=t?t:this._genStr(24)),l=this.idPrefix+(null!=e?this.getParentId(e):this.topId);this._addItemIntoGlobalStrorage(s,l,i,"item",n,a,r),l!=this.idPrefix+this.topId||this.conf.context?this._renderSublevelItem(s,this.getItemPosition(e)):this._renderToplevelItem(s,this.getItemPosition(e))},dhtmlXMenuObject.prototype.addNewChild=function(e,t,i,n,a,r,s){if(null==e){if(!this.conf.context)return this.addNewSibling(e,i,n,a,r,s),void(null!=t&&this.setItemPosition(i,t));e=this.topId}i=this.idPrefix+(null!=i?i:this._genStr(24)),this.setHotKey&&this.setHotKey(e,""),e=this.idPrefix+e,this._addItemIntoGlobalStrorage(i,e,n,"item",a,r,s),null==this.idPull["polygon_"+e]&&this._renderSublevelPolygon(e,e),this._renderSublevelItem(i,t-1),this._redefineComplexState(e)},dhtmlXMenuObject.prototype.removeItem=function(e,t,i){t||(e=this.idPrefix+e);var n=null;if(e!=this.idPrefix+this.topId){if(null==this.itemPull[e])return;this.idPull["polygon_"+e]&&this.idPull["polygon_"+e]._tmShow&&window.clearTimeout(this.idPull["polygon_"+e]._tmShow);var a=this.itemPull[e].type;if("separator"==a){var r=this.idPull["separator_"+e];this.itemPull[e].parent==this.idPrefix+this.topId?(r.onclick=null,r.onselectstart=null,r.id=null,r.parentNode.removeChild(r)):(r.childNodes[0].childNodes[0].onclick=null,r.childNodes[0].childNodes[0].onselectstart=null,r.childNodes[0].childNodes[0].id=null,r.childNodes[0].removeChild(r.childNodes[0].childNodes[0]),r.removeChild(r.childNodes[0]),r.parentNode.removeChild(r)),this.idPull["separator_"+e]=null,this.itemPull[e]=null,delete this.idPull["separator_"+e],delete this.itemPull[e],r=null}else{n=this.itemPull[e].parent;var r=this.idPull[e];for(r.onclick=null,r.oncontextmenu=null,r.onmouseover=null,r.onmouseout=null,r.onselectstart=null,r.id=null;r.childNodes.length>0;)r.removeChild(r.childNodes[0]);r.parentNode.removeChild(r),this.idPull[e]=null,this.itemPull[e]=null,delete this.idPull[e],delete this.itemPull[e],r=null}a=null}for(var s in this.itemPull)this.itemPull[s].parent==e&&this.removeItem(s,!0,!0);var l=new Array(e);null==n||i||null!=this.idPull["polygon_"+n]&&0==this.idPull["polygon_"+n].tbd.childNodes.length&&(l.push(n),this._updateItemComplexState(n,!1,!1));for(var o=0;o<l.length;o++)if(this.idPull["polygon_"+l[o]]){var d=this.idPull["polygon_"+l[o]];if(d.onclick=null,d.oncontextmenu=null,d.tbl.removeChild(d.tbd),d.tbd=null,d.childNodes[1].removeChild(d.tbl),d.tbl=null,d.id=null,d.parentNode.removeChild(d),d=null,window.dhx4.isIE6){var h="polygon_"+l[o]+"_ie6cover";null!=this.idPull[h]&&(document.body.removeChild(this.idPull[h]),delete this.idPull[h])}null!=this.idPull["arrowup_"+e]&&this._removeArrow&&this._removeArrow("arrowup_"+e),null!=this.idPull["arrowdown_"+e]&&this._removeArrow&&this._removeArrow("arrowdown_"+e),this.idPull["polygon_"+l[o]]=null,delete this.idPull["polygon_"+l[o]]}l=null,"dhx_terrace"==this.conf.skin&&1==arguments.length&&this._improveTerraceSkin()},dhtmlXMenuObject.prototype._addItemIntoGlobalStrorage=function(e,t,i,n,a,r,s){var l={id:e,title:i,imgen:null!=r?r:"",imgdis:null!=s?s:"",type:n,state:1==a?"disabled":"enabled",parent:t,complex:!1,hotkey:"",tip:""};this.itemPull[l.id]=l},dhtmlXMenuObject.prototype.renderAsContextMenu=function(){this.conf.context=!0,1==this.base._autoSkinUpdate&&(this.base.className=this.base.className.replace("dhtmlxMenu_"+this.conf.skin+"_Middle",""),this.base._autoSkinUpdate=!1),null!=this.conf.ctx_baseid&&this.addContextZone(this.conf.ctx_baseid)},dhtmlXMenuObject.prototype.addContextZone=function(e){if(e==document.body){e="document.body."+this.idPrefix;var t=document.body}else var t=document.getElementById(e);var i=!1;for(var n in this.conf.ctx_zones)i=i||n==e||this.conf.ctx_zones[n]==t;if(1==i)return!1;this.conf.ctx_zones[e]=t;var a=this;window.dhx4.isOpera?(this.operaContext=function(e){a._doOnContextMenuOpera(e,a)},t.addEventListener("mouseup",this.operaContext,!1)):(null==t.oncontextmenu||t._oldContextMenuHandler||(t._oldContextMenuHandler=t.oncontextmenu),t.oncontextmenu=function(e){for(var t in dhtmlXMenuObject.prototype.liveInst)t!=a.conf.live_id&&dhtmlXMenuObject.prototype.liveInst[t].context&&dhtmlXMenuObject.prototype.liveInst[t]._hideContextMenu();return e=e||event,e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,a._doOnContextBeforeCall(e,this),!1})},dhtmlXMenuObject.prototype._doOnContextMenuOpera=function(e,t){for(var i in dhtmlXMenuObject.prototype.liveInst)i!=t.conf.live_id&&dhtmlXMenuObject.prototype.liveInst[i].context&&dhtmlXMenuObject.prototype.liveInst[i]._hideContextMenu();return e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,0==e.button&&1==e.ctrlKey&&t._doOnContextBeforeCall(e,this),!1},dhtmlXMenuObject.prototype.removeContextZone=function(e){if(!this.isContextZone(e))return!1;e==document.body&&(e="document.body."+this.idPrefix);var t=this.conf.ctx_zones[e];window.dhx4.isOpera?t.removeEventListener("mouseup",this.operaContext,!1):(t.oncontextmenu=null!=t._oldContextMenuHandler?t._oldContextMenuHandler:null,t._oldContextMenuHandler=null);try{this.conf.ctx_zones[e]=null,delete this.conf.ctx_zones[e]}catch(i){}return!0},dhtmlXMenuObject.prototype.isContextZone=function(e){if(e==document.body&&null!=this.conf.ctx_zones["document.body."+this.idPrefix])return!0;var t=!1;return null!=this.conf.ctx_zones[e]&&this.conf.ctx_zones[e]==document.getElementById(e)&&(t=!0),t},dhtmlXMenuObject.prototype._isContextMenuVisible=function(){return null==this.idPull["polygon_"+this.idPrefix+this.topId]?!1:""==this.idPull["polygon_"+this.idPrefix+this.topId].style.display},dhtmlXMenuObject.prototype._showContextMenu=function(e,t,i){return this._clearAndHide(),null==this.idPull["polygon_"+this.idPrefix+this.topId]?!1:(window.clearTimeout(this.conf.tm_handler),this.idPull[this.idPrefix+this.topId]=new Array(e,t),this._showPolygon(this.idPrefix+this.topId,"bottom"),void this.callEvent("onContextMenu",[i]))},dhtmlXMenuObject.prototype._hideContextMenu=function(){return null==this.idPull["polygon_"+this.idPrefix+this.topId]?!1:(this._clearAndHide(),void this._hidePolygon(this.idPrefix+this.topId))},dhtmlXMenuObject.prototype._doOnContextBeforeCall=function(e,t){this.conf.ctx_zoneid=t.id,this._clearAndHide(),this._hideContextMenu();var i=e.srcElement||e.target,n=window.dhx4.isIE||window.dhx4.isOpera||window.dhx4.isKHTML?e.offsetX:e.layerX,a=window.dhx4.isIE||window.dhx4.isOpera||window.dhx4.isKHTML?e.offsetY:e.layerY,r=window.dhx4.absLeft(i)+n,s=window.dhx4.absTop(i)+a;this.checkEvent("onBeforeContextMenu")?this.callEvent("onBeforeContextMenu",[t.id,e])&&this.conf.ctx_autoshow&&(this._showContextMenu(r,s,t.id),this.callEvent("onAfterContextMenu",[t.id,e])):this.conf.ctx_autoshow&&(this._showContextMenu(r,s,t.id),this.callEvent("onAfterContextMenu",[t.id]))},dhtmlXMenuObject.prototype.showContextMenu=function(e,t){this._showContextMenu(e,t,!1)},dhtmlXMenuObject.prototype.hideContextMenu=function(){this._hideContextMenu()},dhtmlXMenuObject.prototype.setAutoShowMode=function(e){this.conf.ctx_autoshow=1==e?!0:!1},dhtmlXMenuObject.prototype.setAutoHideMode=function(e){this.conf.ctx_autohide=1==e?!0:!1},dhtmlXMenuObject.prototype.setContextMenuHideAllMode=function(e){this.conf.ctx_hideall=1==e?!0:!1},dhtmlXMenuObject.prototype.getContextMenuHideAllMode=function(){return this.conf.ctx_hideall},dhtmlXMenuObject.prototype._improveTerraceSkin=function(){for(var e in this.itemPull)if(this.itemPull[e].parent==this.idPrefix+this.topId&&null!=this.idPull[e]){var t=!1,i=!1;this.idPull[e].parentNode.firstChild==this.idPull[e]&&(t=!0),this.idPull[e].parentNode.lastChild==this.idPull[e]&&(i=!0);for(var n in this.itemPull)"separator"==this.itemPull[n].type&&this.itemPull[n].parent==this.idPrefix+this.topId&&(this.idPull[e].nextSibling==this.idPull["separator_"+n]&&(i=!0),this.idPull[e].previousSibling==this.idPull["separator_"+n]&&(t=!0));this.idPull[e].style.borderLeftWidth=t?"1px":"0px",this.idPull[e].style.borderTopLeftRadius=this.idPull[e].style.borderBottomLeftRadius=t?"3px":"0px",this.idPull[e].style.borderTopRightRadius=this.idPull[e].style.borderBottomRightRadius=i?"3px":"0px",this.idPull[e]._bl=t,this.idPull[e]._br=i}},dhtmlXMenuObject.prototype._improveTerraceButton=function(e,t){t?(this.idPull[e].style.borderBottomLeftRadius=this.idPull[e]._bl?"3px":"0px",this.idPull[e].style.borderBottomRightRadius=this.idPull[e]._br?"3px":"0px"):(this.idPull[e].style.borderBottomLeftRadius="0px",this.idPull[e].style.borderBottomRightRadius="0px")},dhtmlXMenuObject.prototype.setItemEnabled=function(e){this._changeItemState(e,"enabled",this._getItemLevelType(e))},dhtmlXMenuObject.prototype.setItemDisabled=function(e){this._changeItemState(e,"disabled",this._getItemLevelType(e))},dhtmlXMenuObject.prototype.isItemEnabled=function(e){return null!=this.itemPull[this.idPrefix+e]?"enabled"==this.itemPull[this.idPrefix+e].state:!1},dhtmlXMenuObject.prototype._changeItemState=function(e,t,i){var n=!1,a=this.idPrefix+e;return null!=this.itemPull[a]&&null!=this.idPull[a]&&this.itemPull[a].state!=t&&(this.itemPull[a].state=t,this.itemPull[a].parent!=this.idPrefix+this.topId||this.conf.context?this.idPull[a].className="sub_item"+("enabled"==this.itemPull[a].state?"":"_dis"):this.idPull[a].className="dhtmlxMenu_"+this.conf.skin+"_TopLevel_Item_"+("enabled"==this.itemPull[a].state?"Normal":"Disabled"),this._updateItemComplexState(this.idPrefix+e,this.itemPull[this.idPrefix+e].complex,!1),this._updateItemImage(e,i),this.idPrefix+this.conf.last_click==a&&"TopLevel"!=i&&this._redistribSubLevelSelection(a,this.itemPull[a].parent),"TopLevel"==i&&!this.conf.context),n},dhtmlXMenuObject.prototype.getItemText=function(e){return null!=this.itemPull[this.idPrefix+e]?this.itemPull[this.idPrefix+e].title:""},dhtmlXMenuObject.prototype.setItemText=function(e,t){if(e=this.idPrefix+e,null!=this.itemPull[e]&&null!=this.idPull[e])if(this._clearAndHide(),this.itemPull[e].title=t,this.itemPull[e].parent!=this.idPrefix+this.topId||this.conf.context){for(var i=null,n=0;n<this.idPull[e].childNodes[1].childNodes.length;n++)"sub_item_text"==String(this.idPull[e].childNodes[1].childNodes[n].className||"")&&(i=this.idPull[e].childNodes[1].childNodes[n]);""==String(this.itemPull[e].title).length||null==this.itemPull[e].title?i&&(i.parentNode.removeChild(i),i=null,this.idPull[e].childNodes[1].innerHTML="&nbsp;"):(i||(i=document.createElement("DIV"),i.className="sub_item_text",this.idPull[e].childNodes[1].innerHTML="",this.idPull[e].childNodes[1].appendChild(i)),i.innerHTML=this.itemPull[e].title)}else{for(var i=null,n=0;n<this.idPull[e].childNodes.length;n++)try{"top_level_text"==this.idPull[e].childNodes[n].className&&(i=this.idPull[e].childNodes[n])}catch(a){}""==String(this.itemPull[e].title).length||null==this.itemPull[e].title?null!=i&&i.parentNode.removeChild(i):(i||(i=document.createElement("DIV"),i.className="top_level_text",this.conf.rtl&&this.idPull[e].childNodes.length>0?this.idPull[e].insertBefore(i,this.idPull[e].childNodes[0]):this.idPull[e].appendChild(i)),i.innerHTML=this.itemPull[e].title)}},dhtmlXMenuObject.prototype.loadFromHTML=function(e,t,i){var n=this.conf.tags.item;this.conf.tags.item="div";var a="string"==typeof e?document.getElementById(e):e,r=this._xmlToJson(a,this.idPrefix+this.topId);this._initObj(r),this.conf.tags.item=n,t&&a.parentNode.removeChild(a),a=objOd=null,null!=onload&&("function"==typeof i?i():"function"==typeof window[i]&&window[i]())},dhtmlXMenuObject.prototype.hideItem=function(e){this._changeItemVisible(e,!1)},dhtmlXMenuObject.prototype.showItem=function(e){this._changeItemVisible(e,!0)},dhtmlXMenuObject.prototype.isItemHidden=function(e){var t=null;return null!=this.idPull[this.idPrefix+e]&&(t="none"==this.idPull[this.idPrefix+e].style.display),t},dhtmlXMenuObject.prototype._changeItemVisible=function(e,t){var i=this.idPrefix+e;null!=this.itemPull[i]&&("separator"==this.itemPull[i].type&&(i="separator_"+i),null!=this.idPull[i]&&(this.idPull[i].style.display=t?"":"none",this._redefineComplexState(this.itemPull[this.idPrefix+e].parent)))},dhtmlXMenuObject.prototype.setUserData=function(e,t,i){this.userData[this.idPrefix+e+"_"+t]=i},dhtmlXMenuObject.prototype.getUserData=function(e,t){return null!=this.userData[this.idPrefix+e+"_"+t]?this.userData[this.idPrefix+e+"_"+t]:null},dhtmlXMenuObject.prototype.setOpenMode=function(e){this.conf.mode="win"==e?"win":"web"},dhtmlXMenuObject.prototype.setWebModeTimeout=function(e){this.conf.tm_sec=isNaN(e)?400:e},dhtmlXMenuObject.prototype.getItemImage=function(e){var t=new Array(null,null);return e=this.idPrefix+e,"item"==this.itemPull[e].type&&(t[0]=this.itemPull[e].imgen,t[1]=this.itemPull[e].imgdis),t},dhtmlXMenuObject.prototype.setItemImage=function(e,t,i){"item"==this.itemPull[this.idPrefix+e].type&&(this.itemPull[this.idPrefix+e].imgen=t,this.itemPull[this.idPrefix+e].imgdis=i,this._updateItemImage(e,this._getItemLevelType(e)))},dhtmlXMenuObject.prototype.clearItemImage=function(e){this.setItemImage(e,"","")},dhtmlXMenuObject.prototype.setVisibleArea=function(e,t,i,n){this.conf.v_enabled=!0,this.conf.v.x1=e,this.conf.v.x2=t,this.conf.v.y1=i,this.conf.v.y2=n},dhtmlXMenuObject.prototype.setTooltip=function(e,t){e=this.idPrefix+e,null!=this.itemPull[e]&&null!=this.idPull[e]&&(this.idPull[e].title=t.length>0?t:null,this.itemPull[e].tip=t)},dhtmlXMenuObject.prototype.getTooltip=function(e){return null==this.itemPull[this.idPrefix+e]?null:this.itemPull[this.idPrefix+e].tip},dhtmlXMenuObject.prototype.setTopText=function(e){this.conf.context||(null==this._topText&&(this._topText=document.createElement("DIV"),this._topText.className="dhtmlxMenu_TopLevel_Text_"+(this.conf.rtl?"left":"left"==this.conf.align?"right":"left"),this.base.appendChild(this._topText)),this._topText.innerHTML=e)},dhtmlXMenuObject.prototype.setAlign=function(e){this.conf.align!=e&&("left"==e||"right"==e)&&(this.conf.align=e,this.cont&&(this.cont.className="right"==this.conf.align?"align_right":"align_left"),null!=this._topText&&(this._topText.className="dhtmlxMenu_TopLevel_Text_"+("left"==this.conf.align?"right":"left")))},dhtmlXMenuObject.prototype.setHref=function(e,t,i){null!=this.itemPull[this.idPrefix+e]&&(this.itemPull[this.idPrefix+e].href_link=t,
null!=i&&(this.itemPull[this.idPrefix+e].href_target=i))},dhtmlXMenuObject.prototype.clearHref=function(e){null!=this.itemPull[this.idPrefix+e]&&(delete this.itemPull[this.idPrefix+e].href_link,delete this.itemPull[this.idPrefix+e].href_target)},dhtmlXMenuObject.prototype.getCircuit=function(e){for(var t=new Array(e);this.getParentId(e)!=this.topId;)e=this.getParentId(e),t[t.length]=e;return t.reverse()},dhtmlXMenuObject.prototype._getCheckboxState=function(e){return null==this.itemPull[this.idPrefix+e]?null:this.itemPull[this.idPrefix+e].checked},dhtmlXMenuObject.prototype._setCheckboxState=function(e,t){null!=this.itemPull[this.idPrefix+e]&&(this.itemPull[this.idPrefix+e].checked=t)},dhtmlXMenuObject.prototype._updateCheckboxImage=function(e){if(null!=this.idPull[this.idPrefix+e]){this.itemPull[this.idPrefix+e].imgen="chbx_"+(this._getCheckboxState(e)?"1":"0"),this.itemPull[this.idPrefix+e].imgdis=this.itemPull[this.idPrefix+e].imgen;try{this.idPull[this.idPrefix+e].childNodes[this.conf.rtl?2:0].childNodes[0].className="sub_icon "+this.itemPull[this.idPrefix+e].imgen}catch(t){}}},dhtmlXMenuObject.prototype._checkboxOnClickHandler=function(e,t,i){if("d"!=t.charAt(1)&&null!=this.itemPull[this.idPrefix+e]){var n=this._getCheckboxState(e);this.checkEvent("onCheckboxClick")?this.callEvent("onCheckboxClick",[e,n,this.conf.ctx_zoneid,i])&&this.setCheckboxState(e,!n):this.setCheckboxState(e,!n),this.checkEvent("onClick")&&this.callEvent("onClick",[e])}},dhtmlXMenuObject.prototype.setCheckboxState=function(e,t){this._setCheckboxState(e,t),this._updateCheckboxImage(e)},dhtmlXMenuObject.prototype.getCheckboxState=function(e){return this._getCheckboxState(e)},dhtmlXMenuObject.prototype.addCheckbox=function(e,t,i,n,a,r,s){if(this.conf.context&&t==this.topId);else{if(null==this.itemPull[this.idPrefix+t])return;if("child"==e&&"item"!=this.itemPull[this.idPrefix+t].type)return}var l="chbx_"+(r?"1":"0"),o=l;if("sibling"==e){var d=this.idPrefix+(null!=n?n:this._genStr(24)),h=this.idPrefix+this.getParentId(t);this._addItemIntoGlobalStrorage(d,h,a,"checkbox",s,l,o),this.itemPull[d].checked=r,this._renderSublevelItem(d,this.getItemPosition(t))}else{var d=this.idPrefix+(null!=n?n:this._genStr(24)),h=this.idPrefix+t;this._addItemIntoGlobalStrorage(d,h,a,"checkbox",s,l,o),this.itemPull[d].checked=r,null==this.idPull["polygon_"+h]&&this._renderSublevelPolygon(h,h),this._renderSublevelItem(d,i-1),this._redefineComplexState(h)}},dhtmlXMenuObject.prototype.setHotKey=function(e,t){if(e=this.idPrefix+e,null!=this.itemPull[e]&&null!=this.idPull[e]&&(this.itemPull[e].parent!=this.idPrefix+this.topId||this.conf.context)&&!this.itemPull[e].complex){var i=this.itemPull[e].type;if("item"==i||"checkbox"==i||"radio"==i){var n=null;try{"sub_item_hk"==this.idPull[e].childNodes[this.conf.rtl?0:2].childNodes[0].className&&(n=this.idPull[e].childNodes[this.conf.rtl?0:2].childNodes[0])}catch(a){}if(0==t.length)this.itemPull[e].hotkey_backup=this.itemPull[e].hotkey,this.itemPull[e].hotkey="",null!=n&&n.parentNode.removeChild(n);else{if(this.itemPull[e].hotkey=t,this.itemPull[e].hotkey_backup=null,null==n){n=document.createElement("DIV"),n.className="sub_item_hk";for(var r=this.idPull[e].childNodes[this.conf.rtl?0:2];r.childNodes.length>0;)r.removeChild(r.childNodes[0]);r.appendChild(n)}n.innerHTML=t}}}},dhtmlXMenuObject.prototype.getHotKey=function(e){return null==this.itemPull[this.idPrefix+e]?null:this.itemPull[this.idPrefix+e].hotkey},dhtmlXMenuObject.prototype._clearAllSelectedSubItemsInPolygon=function(e){for(var t=this._getSubItemToDeselectByPolygon(e),i=0;i<this.conf.opened_poly.length;i++)this.conf.opened_poly[i]!=e&&this._hidePolygon(this.conf.opened_poly[i]);for(var i=0;i<t.length;i++)null!=this.idPull[t[i]]&&"enabled"==this.itemPull[t[i]].state&&(this.idPull[t[i]].className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_Item_Normal")},dhtmlXMenuObject.prototype._checkArrowsState=function(e){var t=this.idPull["polygon_"+e].childNodes[1],i=this.idPull["arrowup_"+e],n=this.idPull["arrowdown_"+e];0==t.scrollTop?i.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowUp_Disabled":i.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowUp"+(i.over?"_Over":""),t.scrollTop+t.offsetHeight<t.scrollHeight?n.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowDown"+(n.over?"_Over":""):n.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowDown_Disabled",t=i=n=null},dhtmlXMenuObject.prototype._addUpArrow=function(e){var t=this,i=document.createElement("DIV");i.pId=this.idPrefix+e,i.id="arrowup_"+this.idPrefix+e,i.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowUp",i.over=!1,i.onselectstart=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1},i.oncontextmenu=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1},i.onmouseover=function(){"web"==t.conf.mode&&window.clearTimeout(t.conf.tm_handler),t._clearAllSelectedSubItemsInPolygon(this.pId),this.className!="dhtmlxMenu_"+t.conf.skin+"_SubLevelArea_ArrowUp_Disabled"&&(this.className="dhtmlxMenu_"+t.conf.skin+"_SubLevelArea_ArrowUp_Over",this.over=!0,t._canScrollUp=!0,t._doScrollUp(this.pId,!0))},i.onmouseout=function(){"web"==t.conf.mode&&(window.clearTimeout(t.conf.tm_handler),t.conf.tm_handler=window.setTimeout(function(){t._clearAndHide()},t.conf.tm_sec,"JavaScript")),this.over=!1,t._canScrollUp=!1,this.className!="dhtmlxMenu_"+t.conf.skin+"_SubLevelArea_ArrowUp_Disabled"&&(this.className="dhtmlxMenu_"+t.conf.skin+"_SubLevelArea_ArrowUp",window.clearTimeout(t.conf.of_utm))},i.onclick=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,e.cancelBubble=!0,!1};var n=this.idPull["polygon_"+this.idPrefix+e];n.childNodes[0].appendChild(i),this.idPull[i.id]=i,n=i=null},dhtmlXMenuObject.prototype._addDownArrow=function(e){var t=this,i=document.createElement("DIV");i.pId=this.idPrefix+e,i.id="arrowdown_"+this.idPrefix+e,i.className="dhtmlxMenu_"+this.conf.skin+"_SubLevelArea_ArrowDown",i.over=!1,i.onselectstart=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1},i.oncontextmenu=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,!1},i.onmouseover=function(){"web"==t.conf.mode&&window.clearTimeout(t.conf.tm_handler),t._clearAllSelectedSubItemsInPolygon(this.pId),this.className!="dhtmlxMenu_"+t.conf.skin+"_SubLevelArea_ArrowDown_Disabled"&&(this.className="dhtmlxMenu_"+t.conf.skin+"_SubLevelArea_ArrowDown_Over",this.over=!0,t._canScrollDown=!0,t._doScrollDown(this.pId,!0))},i.onmouseout=function(){"web"==t.conf.mode&&(window.clearTimeout(t.conf.tm_handler),t.conf.tm_handler=window.setTimeout(function(){t._clearAndHide()},t.conf.tm_sec,"JavaScript")),this.over=!1,t._canScrollDown=!1,this.className!="dhtmlxMenu_"+t.conf.skin+"_SubLevelArea_ArrowDown_Disabled"&&(this.className="dhtmlxMenu_"+t.conf.skin+"_SubLevelArea_ArrowDown",window.clearTimeout(t.conf.of_dtm))},i.onclick=function(e){return e=e||event,e.preventDefault?e.preventDefault():e.returnValue=!1,e.cancelBubble=!0,!1};var n=this.idPull["polygon_"+this.idPrefix+e];n.childNodes[2].appendChild(i),this.idPull[i.id]=i,n=i=null},dhtmlXMenuObject.prototype._removeUpArrow=function(e){var t="arrowup_"+this.idPrefix+e;this._removeArrow(t)},dhtmlXMenuObject.prototype._removeDownArrow=function(e){var t="arrowdown_"+this.idPrefix+e;this._removeArrow(t)},dhtmlXMenuObject.prototype._removeArrow=function(e){var t=this.idPull[e];t.onselectstart=null,t.oncontextmenu=null,t.onmouseover=null,t.onmouseout=null,t.onclick=null,t.parentNode&&t.parentNode.removeChild(t),t=null,this.idPull[e]=null;try{delete this.idPull[e]}catch(i){}},dhtmlXMenuObject.prototype._isArrowExists=function(e){return null!=this.idPull["arrowup_"+e]&&null!=this.idPull["arrowdown_"+e]?!0:!1},dhtmlXMenuObject.prototype._doScrollUp=function(e,t){var i=this.idPull["polygon_"+e].childNodes[1];if(this._canScrollUp&&i.scrollTop>0){var n=!1,a=i.scrollTop-this.conf.of_ustep;if(0>a&&(n=!0,a=0),i.scrollTop=a,n)t=!0;else{var r=this;this.conf.of_utm=window.setTimeout(function(){r._doScrollUp(e,!1),r=null},this.conf.of_utime)}}else this._canScrollUp=!1,this._checkArrowsState(e);t&&this._checkArrowsState(e)},dhtmlXMenuObject.prototype._doScrollDown=function(e,t){var i=this.idPull["polygon_"+e].childNodes[1];if(this._canScrollDown&&i.scrollTop+i.offsetHeight<=i.scrollHeight){var n=!1,a=i.scrollTop+this.conf.of_dstep;if(a+i.offsetHeight>=i.scrollHeight&&(n=!0,a=i.scrollHeight-i.offsetHeight),i.scrollTop=a,n)t=!0;else{var r=this;this.conf.of_dtm=window.setTimeout(function(){r._doScrollDown(e,!1),r=null},this.conf.of_dtime)}}else this._canScrollDown=!1,this._checkArrowsState(e);t&&this._checkArrowsState(e)},dhtmlXMenuObject.prototype._countPolygonItems=function(e){var t=0;for(var i in this.itemPull){var n=this.itemPull[i].parent,a=this.itemPull[i].type;n!=this.idPrefix+e||"item"!=a&&"radio"!=a&&"checkbox"!=a||t++}return t},dhtmlXMenuObject.prototype.setOverflowHeight=function(e){if("auto"===e)return this.conf.overflow_limit=0,void(this.conf.auto_overflow=!0);if(!(0==this.conf.overflow_limit&&0>=e)){if(this._clearAndHide(),this.conf.overflow_limit>=0&&e>0)return void(this.conf.overflow_limit=e);if(this.conf.overflow_limit>0&&0>=e){for(var t in this.itemPull)if(this._isArrowExists(t)){var i=String(t).replace(this.idPrefix,"");this._removeUpArrow(i),this._removeDownArrow(i),this.idPull["polygon_"+t].childNodes[1].style.height=""}return void(this.conf.overflow_limit=0)}}},dhtmlXMenuObject.prototype._getRadioImgObj=function(e){try{var t=this.idPull[this.idPrefix+e].childNodes[this.conf.rtl?2:0].childNodes[0]}catch(i){var t=null}return t},dhtmlXMenuObject.prototype._setRadioState=function(e,t){var i=this._getRadioImgObj(e);if(null!=i){var n=this.itemPull[this.idPrefix+e];n.checked=t,n.imgen="rdbt_"+(n.checked?"1":"0"),n.imgdis=n.imgen,i.className="sub_icon "+n.imgen}},dhtmlXMenuObject.prototype._radioOnClickHandler=function(e,t,i){if("d"!=t.charAt(1)&&null!=this.itemPull[this.idPrefix+e].group){var n=this.itemPull[this.idPrefix+e].group;this.checkEvent("onRadioClick")?this.callEvent("onRadioClick",[n,this.getRadioChecked(n),e,this.conf.ctx_zoneid,i])&&this.setRadioChecked(n,e):this.setRadioChecked(n,e),this.checkEvent("onClick")&&this.callEvent("onClick",[e])}},dhtmlXMenuObject.prototype.getRadioChecked=function(e){for(var t=null,i=0;i<this.radio[e].length;i++){var n=this.radio[e][i].replace(this.idPrefix,""),a=this._getRadioImgObj(n);if(null!=a){var r=a.className.match(/rdbt_1$/gi);null!=r&&(t=n)}}return t},dhtmlXMenuObject.prototype.setRadioChecked=function(e,t){if(null!=this.radio[e])for(var i=0;i<this.radio[e].length;i++){var n=this.radio[e][i].replace(this.idPrefix,"");this._setRadioState(n,n==t)}},dhtmlXMenuObject.prototype.addRadioButton=function(e,t,i,n,a,r,s,l){if(this.conf.context&&t==this.topId);else{if(null==this.itemPull[this.idPrefix+t])return;if("child"==e&&"item"!=this.itemPull[this.idPrefix+t].type)return}var o=this.idPrefix+(null!=n?n:this._genStr(24)),d="rdbt_"+(s?"1":"0"),h=d;if("sibling"==e){var _=this.idPrefix+this.getParentId(t);this._addItemIntoGlobalStrorage(o,_,a,"radio",l,d,h),this._renderSublevelItem(o,this.getItemPosition(t))}else{var _=this.idPrefix+t;this._addItemIntoGlobalStrorage(o,_,a,"radio",l,d,h),null==this.idPull["polygon_"+_]&&this._renderSublevelPolygon(_,_),this._renderSublevelItem(o,i-1),this._redefineComplexState(_)}var c=null!=r?r:this._genStr(24);this.itemPull[o].group=c,null==this.radio[c]&&(this.radio[c]=new Array),this.radio[c][this.radio[c].length]=o,1==s&&this.setRadioChecked(c,String(o).replace(this.idPrefix,""))},dhtmlXMenuObject.prototype.serialize=function(){var e="<menu>"+this._readLevel(this.idPrefix+this.topId)+"</menu>";return e},dhtmlXMenuObject.prototype._readLevel=function(e){var t="";for(var i in this.itemPull)if(this.itemPull[i].parent==e){var n="",a="",r="",s=String(this.itemPull[i].id).replace(this.idPrefix,""),l="",o=""!=this.itemPull[i].title?' text="'+this.itemPull[i].title+'"':"",d="";"item"==this.itemPull[i].type&&(""!=this.itemPull[i].imgen&&(n=' img="'+this.itemPull[i].imgen+'"'),""!=this.itemPull[i].imgdis&&(a=' imgdis="'+this.itemPull[i].imgdis+'"'),""!=this.itemPull[i].hotkey&&(r="<hotkey>"+this.itemPull[i].hotkey+"</hotkey>")),"separator"==this.itemPull[i].type?l=' type="separator"':"disabled"==this.itemPull[i].state&&(d=' enabled="false"'),"checkbox"==this.itemPull[i].type&&(l=' type="checkbox"'+(this.itemPull[i].checked?' checked="true"':"")),"radio"==this.itemPull[i].type&&(l=' type="radio" group="'+this.itemPull[i].group+'" '+(this.itemPull[i].checked?' checked="true"':"")),t+="<item id='"+s+"'"+o+l+n+a+d+">",t+=r,this.itemPull[i].complex&&(t+=this._readLevel(i)),t+="</item>"}return t},dhtmlXMenuObject.prototype.enableEffect=function(e,t,i){this._menuEffect="opacity"==e||"slide"==e||"slide+"==e?e:!1,this._pOpStyleIE=navigator.userAgent.search(/MSIE\s[678]\.0/gi)>=0;for(var n in this.idPull)0===n.search(/polygon/)&&(this._pOpacityApply(n,this._pOpStyleIE?100:1),this.idPull[n].style.height="");this._pOpMax=("undefined"==typeof t?100:t)/(this._pOpStyleIE?1:100),this._pOpStyleName=this._pOpStyleIE?"filter":"opacity",this._pOpStyleValue=this._pOpStyleIE?"progid:DXImageTransform.Microsoft.Alpha(Opacity=#)":"#",this._pSlSteps=this._pOpStyleIE?10:20,this._pSlTMTimeMax=i||50},dhtmlXMenuObject.prototype._showPolygonEffect=function(e){this._pShowHide(e,!0)},dhtmlXMenuObject.prototype._hidePolygonEffect=function(e){this._pShowHide(e,!1)},dhtmlXMenuObject.prototype._pOpacityApply=function(e,t){this.idPull[e].style[this._pOpStyleName]=String(this._pOpStyleValue).replace("#",t||this.idPull[e]._op)},dhtmlXMenuObject.prototype._pShowHide=function(e,t){if(this.idPull){if(null!=this.idPull[e]._tmShow){if(this.idPull[e]._step_h>0&&1==t||this.idPull[e]._step_h<0&&0==t)return;window.clearTimeout(this.idPull[e]._tmShow),this.idPull[e]._tmShow=null,this.idPull[e]._max_h=null}if(0!=t||"hidden"!=this.idPull[e].style.visibility&&"none"!=this.idPull[e].style.display){if(1==t&&"none"==this.idPull[e].style.display&&(this.idPull[e].style.visibility="hidden",this.idPull[e].style.display=""),null==this.idPull[e]._max_h){if(this.idPull[e]._max_h=parseInt(this.idPull[e].offsetHeight),this.idPull[e]._h=1==t?0:this.idPull[e]._max_h,this.idPull[e]._step_h=Math.round(this.idPull[e]._max_h/this._pSlSteps)*(1==t?1:-1),0==this.idPull[e]._step_h)return;this.idPull[e]._step_tm=Math.round(this._pSlTMTimeMax/this._pSlSteps),"slide+"==this._menuEffect||"opacity"==this._menuEffect?(this.idPull[e].op_tm=this.idPull[e]._step_tm,this.idPull[e].op_step=this._pOpMax/this._pSlSteps*(1==t?1:-1),this._pOpStyleIE&&(this.idPull[e].op_step=Math.round(this.idPull[e].op_step)),this.idPull[e]._op=1==t?0:this._pOpMax,this._pOpacityApply(e)):(this.idPull[e]._op=this._pOpStyleIE?100:1,this._pOpacityApply(e)),0===this._menuEffect.search(/slide/)&&(this.idPull[e].style.height="0px"),this.idPull[e].style.visibility="visible"}this._pEffectSet(e,this.idPull[e]._h+this.idPull[e]._step_h)}}},dhtmlXMenuObject.prototype._pEffectSet=function(e,t){if(this.idPull)if(this.idPull[e]._tmShow&&window.clearTimeout(this.idPull[e]._tmShow),this.idPull[e]._h=Math.max(0,Math.min(t,this.idPull[e]._max_h)),0===this._menuEffect.search(/slide/)&&(this.idPull[e].style.height=this.idPull[e]._h+"px"),t+=this.idPull[e]._step_h,("slide+"==this._menuEffect||"opacity"==this._menuEffect)&&(this.idPull[e]._op=Math.max(0,Math.min(this._pOpMax,this.idPull[e]._op+this.idPull[e].op_step)),this._pOpacityApply(e)),this.idPull[e]._step_h>0&&t<=this.idPull[e]._max_h||this.idPull[e]._step_h<0&&t>=0){var i=this;this.idPull[e]._tmShow=window.setTimeout(function(){i._pEffectSet(e,t)},this.idPull[e]._step_tm)}else 0===this._menuEffect.search(/slide/)&&(this.idPull[e].style.height=""),this.idPull[e]._step_h<0&&(this.idPull[e].style.visibility="hidden"),("slide+"==this._menuEffect||"opacity"==this._menuEffect)&&(this.idPull[e]._op=this.idPull[e]._step_h<0?this._pOpStyleIE?100:1:this._pOpMax,this._pOpacityApply(e)),this.idPull[e]._tmShow=null,this.idPull[e]._h=null,this.idPull[e]._max_h=null,this.idPull[e]._step_tm=null};