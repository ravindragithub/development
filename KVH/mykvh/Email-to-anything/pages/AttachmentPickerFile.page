<apex:page controller="ortoo_e2a.TemporaryAttachmentController" sidebar="false" showHeader="false" tabStyle="ortoo_e2a__User_Settings__c">

    <script>
      function notifyParent()
      {
        var winMain = window.opener;
        if (null == winMain)
        {
          winMain = window.parent.opener;
        }
        winMain.attachRefresh();
      }
      
      function closeWindow()
      {
        var winMain=window.opener;
        if (null==winMain)
        {
          winMain=window.parent.opener;
        }
        winMain.closePopup();
      }
    </script>

    <table style="height:50px;background-color:#612144;vertical-align:middle" cellspacing="4" >
        <tr>
            <td><h1 style="color:white;vertical-align:middle">Attachments</h1></td>
            <td width="100%">&nbsp;</td>
        </tr>
    </table>
    <apex:form id="attachment_dialog_file">
        <table>
            <tr>
                <td class="spacercolumn"></td>
                <td class="labelcolumn"><apex:outputLabel value="Location"/></td>
                <td><apex:selectList value="{!AttachmentSearchSelection}" size="1">
                        <apex:selectOptions value="{!AttachmentSearchOptions}"/>
                        <apex:actionSupport event="onchange" action="{!SearchSelectionPage}"/>
                    </apex:selectList>
                </td>
            </tr>
            <tr>
                <td>&nbsp;</td>
            </tr>
        </table>
        <apex:pagemessages />
        <apex:pageBlock title="Files" id="file_list"> 
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton value="Attach" action="{!AttachFiles}" oncomplete="notifyParent()" reRender="file_list, attachment_list"/>
                <apex:commandButton value="Click to Complete!" onclick="closeWindow()" reRender="none"/>
            </apex:pageBlockButtons>
            <apex:outputPanel layout="block">
                <apex:outputText value="Folder:"/>&nbsp;&nbsp;
                <apex:selectList value="{!fileSelectedId}" size="1">
                    <apex:selectOptions value="{!FileFolderOptions}"/>
                    <apex:actionSupport event="onchange" action="{!FileFolderReselect}" reRender="file_list,library_list"/>
                </apex:selectList>&nbsp;&nbsp;
                <apex:outputPanel id="library_list" rendered="{!fileSelectedId=='Library'}" >
                    <apex:outputText value="Search In:"/>&nbsp;&nbsp;
                    <apex:selectList value="{!librarySelectedId}" size="1">
                        <apex:selectOptions value="{!LibraryFolderOptions}"/>
                        <apex:actionSupport event="onchange" action="{!FileFolderReselect}" reRender="file_list,library_list"/>
                    </apex:selectList>
                </apex:outputPanel>
                
            </apex:outputPanel>
            
            <apex:outputPanel layout="block" style="height:3px"/>
            <apex:outputPanel layout="block">
                <apex:outputText value="Search:"/>&nbsp;
                <apex:inputText value="{!DocumentFolderSearchString}"/>
                <apex:commandButton action="{!FileFolderReselect}" id="go_file_search" value="Go!" reRender="file_table,no_files_msg"/>
                <apex:inputText style="display:none" />  <!-- To deal with the problem of pressing enter -->
            </apex:outputPanel>
            <apex:outputPanel layout="block" style="height:2px"/>
            <apex:pageBlockTable value="{!FileList}" var="DO" id="file_table">
                <apex:column >
                    <apex:inputCheckbox value="{!DO.Selected}"/>
                </apex:column>
                <apex:column value="{!DO.SObj['Title']}">
                    <apex:facet name="header">
                        <apex:outputLabel value="Name" rendered="{!FileExist}"/>
                    </apex:facet>
                </apex:column> 
                <apex:column value="{!DO.SObj['ContentSize']}">
                    <apex:facet name="header">
                        <apex:outputLabel value="Size" rendered="{!FileExist}"/>
                    </apex:facet>
                </apex:column>                
            </apex:pageBlockTable>
            <apex:outputPanel id="no_files_msg">
                <apex:outputText value="no files" rendered="{!FilesDoNotExist}"/>
            </apex:outputPanel>
        </apex:pageBlock>
        <apex:pageBlock title="Attachments" id="attachment_list">
            <apex:pageBlockTable value="{!EmailAttachmentsList}" var="AT">
                <apex:column value="{!AT.Name}">
                    <apex:facet name="header">
                        <apex:outputLabel value="File" rendered="{!EmailAttachmentsExist}"/>
                    </apex:facet>
                </apex:column>
                <apex:column value="{!AT.Size}">
                    <apex:facet name="header">
                        <apex:outputLabel value="Size" rendered="{!EmailAttachmentsExist}"/>
                    </apex:facet>
                </apex:column>
            </apex:pageBlockTable>
            <apex:outputText value="no attachments" rendered="{!EmailAttachmentsDoNotExist}"/>
        </apex:pageBlock>
    </apex:form>
</apex:page>